2025/12/30 23:29:52 [ReadPump] 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 在房间 global 的消息
2025/12/30 23:29:52 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:29:52 [Register] 全局连接已注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 当前全局在线用户数: 1
2025/12/30 23:29:52 [ReadPump] 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 在房间 global 的消息
2025/12/30 23:29:52 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:29:52 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的旧连接，准备替换 - 旧连接: 0x1400068e4e0, 新连接: 0x14000300d20
2025/12/30 23:29:52 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的旧连接
2025/12/30 23:29:52 [Register] 全局连接已注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 当前全局在线用户数: 1
2025/12/30 23:29:52 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global): websocket: close 1001 (going away)
2025/12/30 23:29:52 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:30:01 [ReadPump] 开始监听用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 在房间 global 的消息
2025/12/30 23:30:01 [Register] 新客户端注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global
2025/12/30 23:30:01 [Register] 全局连接已注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 当前全局在线用户数: 2
2025/12/30 23:30:01 [ReadPump] 开始监听用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 在房间 global 的消息
2025/12/30 23:30:01 [Register] 新客户端注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global
2025/12/30 23:30:01 [Register] 检测到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 的旧连接，准备替换 - 旧连接: 0x14000301500, 新连接: 0x1400068f140
2025/12/30 23:30:01 [Register] 已从 GlobalClients 中移除用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 的旧连接
2025/12/30 23:30:01 [Register] 全局连接已注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 当前全局在线用户数: 2
2025/12/30 23:30:01 [ReadPump] 开始监听用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 在房间 global 的消息
2025/12/30 23:30:01 [Register] 新客户端注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global
2025/12/30 23:30:01 [Register] 检测到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 的旧连接，准备替换 - 旧连接: 0x1400068f140, 新连接: 0x140004a6120
2025/12/30 23:30:01 [Register] 已从 GlobalClients 中移除用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 的旧连接
2025/12/30 23:30:01 [Register] 全局连接已注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 当前全局在线用户数: 2
2025/12/30 23:30:01 [ReadPump] 开始监听用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 在房间 global 的消息
2025/12/30 23:30:01 [Register] 新客户端注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global
2025/12/30 23:30:01 [Register] 检测到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 的旧连接，准备替换 - 旧连接: 0x140004a6120, 新连接: 0x140001006c0
2025/12/30 23:30:01 [Register] 已从 GlobalClients 中移除用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 的旧连接
2025/12/30 23:30:01 [Register] 全局连接已注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 当前全局在线用户数: 2
2025/12/30 23:30:01 [Register] 新客户端注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: e84a0cfe-9765-45a5-b51d-74f44db32fec
2025/12/30 23:30:01 [Register] 检测到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 的旧连接，准备替换 - 旧连接: 0x140001006c0, 新连接: 0x14000301e00
2025/12/30 23:30:01 [Register] 已从 GlobalClients 中移除用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 的旧连接
2025/12/30 23:30:01 [ReadPump] 开始监听用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 在房间 e84a0cfe-9765-45a5-b51d-74f44db32fec 的消息
2025/12/30 23:30:52 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global): websocket: close 1005 (no status)
2025/12/30 23:31:04 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: e84a0cfe-9765-45a5-b51d-74f44db32fec): websocket: close 1005 (no status)
2025/12/30 23:31:04 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global): websocket: close 1005 (no status)
2025/12/30 23:31:04 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global): websocket: close 1005 (no status)
2025/12/30 23:31:04 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global): websocket: close 1005 (no status)
2025/12/30 23:31:04 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global): websocket: close 1005 (no status)
2025/12/30 23:37:13 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:37:13 [ReadPump] 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 在房间 global 的消息
2025/12/30 23:37:13 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:37:13 [Register] 全局连接已注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 当前全局在线用户数: 1
2025/12/30 23:37:13 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:37:13 [ReadPump] 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 在房间 global 的消息
2025/12/30 23:37:13 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:37:13 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的旧连接，准备替换 - 旧连接: 0x1400023d200, 新连接: 0x1400023d5c0
2025/12/30 23:37:13 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的旧连接
2025/12/30 23:37:13 [Register] 全局连接已注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 当前全局在线用户数: 1
2025/12/30 23:37:13 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global): websocket: close 1001 (going away)
2025/12/30 23:37:13 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:37:13 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:38:13 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global): websocket: close 1005 (no status)
2025/12/30 23:38:13 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:38:13 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:38:13 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43
2025/12/30 23:38:13 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43
2025/12/30 23:40:49 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:40:49 [ReadPump] 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 在房间 global 的消息
2025/12/30 23:40:49 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:40:49 [Register] 全局连接已注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 当前全局在线用户数: 1
2025/12/30 23:40:50 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:40:50 [ReadPump] 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 在房间 global 的消息
2025/12/30 23:40:50 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:40:50 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的旧连接，准备替换 - 旧连接: 0x14000300780, 新连接: 0x14000301320
2025/12/30 23:40:50 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的旧连接
2025/12/30 23:40:50 [Register] 全局连接已注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 当前全局在线用户数: 1
2025/12/30 23:40:50 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global): websocket: close 1001 (going away)
2025/12/30 23:40:50 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:40:50 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:46:09 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global): websocket: close 1001 (going away)
2025/12/30 23:46:09 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:46:09 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:46:09 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43
2025/12/30 23:46:09 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43
2025/12/30 23:49:03 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:49:03 [ReadPump] 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 在房间 global 的消息
2025/12/30 23:49:03 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:49:03 [Register] 全局连接已注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 当前全局在线用户数: 1
2025/12/30 23:49:03 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:49:03 [ReadPump] 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 在房间 global 的消息
2025/12/30 23:49:03 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:49:03 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的旧连接，准备替换 - 旧连接: 0x140000ac660, 新连接: 0x140000acde0
2025/12/30 23:49:03 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的旧连接
2025/12/30 23:49:03 [Register] 全局连接已注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 当前全局在线用户数: 1
2025/12/30 23:49:03 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global): websocket: close 1001 (going away)
2025/12/30 23:49:03 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:49:03 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:51:08 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:51:08 [ReadPump] 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 在房间 global 的消息
2025/12/30 23:51:08 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:51:08 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的旧连接，准备替换 - 旧连接: 0x140000acde0, 新连接: 0x1400018e120
2025/12/30 23:51:08 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的旧连接
2025/12/30 23:51:08 [Register] 全局连接已注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 当前全局在线用户数: 1
2025/12/30 23:51:08 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:51:08 [ReadPump] 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 在房间 global 的消息
2025/12/30 23:51:08 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:51:08 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的旧连接，准备替换 - 旧连接: 0x1400018e120, 新连接: 0x14000300180
2025/12/30 23:51:08 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的旧连接
2025/12/30 23:51:08 [Register] 全局连接已注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 当前全局在线用户数: 1
2025/12/30 23:51:08 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global): websocket: close 1001 (going away)
2025/12/30 23:51:08 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:51:08 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:51:40 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的原始消息: {"type":"1v1_match_request"}
2025/12/30 23:51:40 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的消息类型为 '1v1_match_request'
2025/12/30 23:51:40 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的 1v1 匹配请求，准备加入匹配队列
2025/12/30 23:51:40 [ReadPump] ✅ 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的匹配请求来自最新连接，发送到匹配队列
2025/12/30 23:52:07 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 房间ID: global
2025/12/30 23:52:07 [ReadPump] 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 在房间 global 的消息
2025/12/30 23:52:07 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 房间ID: global
2025/12/30 23:52:07 [Register] 全局连接已注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 当前全局在线用户数: 2
2025/12/30 23:52:07 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 房间ID: global
2025/12/30 23:52:07 [ReadPump] 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 在房间 global 的消息
2025/12/30 23:52:07 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 房间ID: global
2025/12/30 23:52:07 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 的旧连接，准备替换 - 旧连接: 0x14000300480, 新连接: 0x1400023d920
2025/12/30 23:52:07 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 的旧连接
2025/12/30 23:52:07 [Register] 全局连接已注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 当前全局在线用户数: 2
2025/12/30 23:52:07 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 房间ID: global): websocket: close 1001 (going away)
2025/12/30 23:52:07 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 房间ID: global
2025/12/30 23:52:07 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 房间ID: global
2025/12/30 23:52:08 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 房间ID: global
2025/12/30 23:52:08 [ReadPump] 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 在房间 global 的消息
2025/12/30 23:52:08 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 房间ID: global
2025/12/30 23:52:08 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 的旧连接，准备替换 - 旧连接: 0x1400023d920, 新连接: 0x14000300fc0
2025/12/30 23:52:08 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 的旧连接
2025/12/30 23:52:08 [Register] 全局连接已注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 当前全局在线用户数: 2
2025/12/30 23:52:08 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 房间ID: global
2025/12/30 23:52:08 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 的旧连接，准备替换 - 旧连接: 0x14000300fc0, 新连接: 0x14000301440
2025/12/30 23:52:08 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 房间ID: global
2025/12/30 23:52:08 [ReadPump] 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 在房间 global 的消息
2025/12/30 23:52:08 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 的旧连接
2025/12/30 23:52:08 [Register] 全局连接已注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 当前全局在线用户数: 2
2025/12/30 23:52:08 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 房间ID: global): websocket: close 1001 (going away)
2025/12/30 23:52:08 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 房间ID: global
2025/12/30 23:52:08 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 房间ID: global
2025/12/30 23:52:09 [ReadPump] 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 的原始消息: {"type":"1v1_match_request"}
2025/12/30 23:52:09 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 的消息类型为 '1v1_match_request'
2025/12/30 23:52:09 [ReadPump] 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 的 1v1 匹配请求，准备加入匹配队列
2025/12/30 23:52:09 [ReadPump] ✅ 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 的匹配请求来自最新连接，发送到匹配队列
2025/12/30 23:52:17 [ReadPump] ========== ReadPump 启动 ========== 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global
2025/12/30 23:52:17 [ReadPump] 开始监听用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 在房间 global 的消息
2025/12/30 23:52:17 [ReadPump] 收到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 的原始消息: {"type":"1v1_match_request"}
2025/12/30 23:52:17 [ReadPump] 解析用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 的消息类型为 '1v1_match_request'
2025/12/30 23:52:17 [ReadPump] 收到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 的 1v1 匹配请求，准备加入匹配队列
2025/12/30 23:52:17 [ReadPump] ⚠️ 警告：用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 的匹配请求来自旧连接，当前最新连接: 0x0, 请求连接: 0x140000accc0
2025/12/30 23:52:17 [Register] 新客户端注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global
2025/12/30 23:52:17 [Register] 全局连接已注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 当前全局在线用户数: 3
2025/12/30 23:52:17 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global): websocket: close 1005 (no status)
2025/12/30 23:52:17 [ReadPump] ========== ReadPump 退出 ========== 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global
2025/12/30 23:52:17 [Unregister] 客户端注销 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global
2025/12/30 23:52:17 [Unregister] 已从 GlobalClients 中移除用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7
2025/12/30 23:52:17 [Unregister] 已从 GlobalByUserID 中移除用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7
2025/12/30 23:52:17 [Register] 新客户端注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global
2025/12/30 23:52:17 [ReadPump] ========== ReadPump 启动 ========== 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global
2025/12/30 23:52:17 [ReadPump] 开始监听用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 在房间 global 的消息
2025/12/30 23:52:17 [Register] 全局连接已注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 当前全局在线用户数: 3
2025/12/30 23:52:17 [Register] 新客户端注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global
2025/12/30 23:52:17 [Register] 检测到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 的旧连接，准备替换 - 旧连接: 0x1400018e780, 新连接: 0x1400058e4e0
2025/12/30 23:52:17 [Register] 已从 GlobalClients 中移除用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 的旧连接
2025/12/30 23:52:17 [ReadPump] ========== ReadPump 启动 ========== 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global
2025/12/30 23:52:17 [Register] 全局连接已注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 当前全局在线用户数: 3
2025/12/30 23:52:17 [ReadPump] 开始监听用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 在房间 global 的消息
2025/12/30 23:52:17 [Register] 新客户端注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: e84a0cfe-9765-45a5-b51d-74f44db32fec
2025/12/30 23:52:17 [Register] 检测到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 的旧连接，准备替换 - 旧连接: 0x1400058e4e0, 新连接: 0x1400058e720
2025/12/30 23:52:17 [ReadPump] ========== ReadPump 启动 ========== 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: e84a0cfe-9765-45a5-b51d-74f44db32fec
2025/12/30 23:52:17 [ReadPump] 开始监听用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 在房间 e84a0cfe-9765-45a5-b51d-74f44db32fec 的消息
2025/12/30 23:52:17 [Register] 已从 GlobalClients 中移除用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 的旧连接
2025/12/30 23:52:18 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global): websocket: close 1005 (no status)
2025/12/30 23:52:18 [ReadPump] ========== ReadPump 退出 ========== 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global
2025/12/30 23:52:46 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global): websocket: close 1005 (no status)
2025/12/30 23:52:46 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/30 23:52:49 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 房间ID: global): websocket: close 1005 (no status)
2025/12/30 23:52:49 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 房间ID: global
2025/12/30 23:53:17 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global): websocket: close 1005 (no status)
2025/12/30 23:53:17 [ReadPump] ========== ReadPump 退出 ========== 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: global
2025/12/30 23:53:17 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: e84a0cfe-9765-45a5-b51d-74f44db32fec): websocket: close 1005 (no status)
2025/12/30 23:53:17 [ReadPump] ========== ReadPump 退出 ========== 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 房间ID: e84a0cfe-9765-45a5-b51d-74f44db32fec
2025/12/30 23:54:09 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global): websocket: close 1001 (going away)
2025/12/30 23:54:09 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 房间ID: global
2025/12/31 00:02:03 [Register] 新客户端注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 用户名: 小南, 房间ID: global
2025/12/31 00:02:03 [Register] ✅ 全局连接已成功注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 用户名: 小南, 当前全局在线用户数: 1, 连接指针: 0x140002811a0
2025/12/31 00:02:03 [ReadPump] ========== ReadPump 启动 ========== 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 用户名: 小南, 房间ID: global, 连接指针: 0x140002811a0
2025/12/31 00:02:03 [ReadPump] ✅ 开始监听用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 在房间 global 的消息，连接指针: 0x140002811a0
2025/12/31 00:02:18 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x1400060a5a0
2025/12/31 00:02:18 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x1400060a5a0
2025/12/31 00:02:18 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 00:02:18 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 2, 连接指针: 0x1400060a5a0
2025/12/31 00:02:18 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x1400060a960
2025/12/31 00:02:18 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 00:02:18 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x1400060a5a0, 新连接: 0x1400060a960
2025/12/31 00:02:18 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2025/12/31 00:02:18 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 2, 连接指针: 0x1400060a960
2025/12/31 00:02:18 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x1400060a960
2025/12/31 00:02:18 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 00:02:18 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x1400060a5a0
2025/12/31 00:02:18 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 00:02:51 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000aa420
2025/12/31 00:02:51 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000aa420
2025/12/31 00:02:51 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 00:02:51 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 3, 连接指针: 0x140000aa420
2025/12/31 00:02:51 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 00:02:51 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000aa420
2025/12/31 00:02:51 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 00:02:51 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2025/12/31 00:02:51 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2025/12/31 00:02:51 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ac180
2025/12/31 00:02:51 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000ac180
2025/12/31 00:02:51 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 00:02:51 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 3, 连接指针: 0x140000ac180
2025/12/31 00:03:16 [ReadPump] ========== ReadPump 启动 ========== 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 用户名: 小南, 房间ID: global, 连接指针: 0x1400019cd20
2025/12/31 00:03:16 [ReadPump] ✅ 开始监听用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 在房间 global 的消息，连接指针: 0x1400019cd20
2025/12/31 00:03:16 [Register] 新客户端注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 用户名: 小南, 房间ID: global
2025/12/31 00:03:16 [Register] 检测到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的旧连接，准备替换 - 旧连接: 0x140002811a0, 新连接: 0x1400019cd20
2025/12/31 00:03:16 [Register] 已从 GlobalClients 中移除用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的旧连接
2025/12/31 00:03:16 [Register] ✅ 全局连接已成功注册 - 用户ID: d94bd664-2a3b-4b27-a25c-2b4185b873b7, 用户名: 小南, 当前全局在线用户数: 3, 连接指针: 0x1400019cd20
2025/12/31 00:03:27 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000aaba0
2025/12/31 00:03:27 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000aaba0
2025/12/31 00:03:27 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 00:03:27 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140000ac180, 新连接: 0x140000aaba0
2025/12/31 00:03:27 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 00:03:27 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 3, 连接指针: 0x140000aaba0
2025/12/31 00:03:27 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000aaf60
2025/12/31 00:03:27 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000aaf60
2025/12/31 00:03:27 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 00:03:27 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140000aaba0, 新连接: 0x140000aaf60
2025/12/31 00:03:27 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 00:03:27 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 3, 连接指针: 0x140000aaf60
2025/12/31 00:03:28 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 00:03:28 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000aaba0
2025/12/31 00:03:28 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 00:03:39 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 00:03:39 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 '1v1_match_request'
2025/12/31 00:03:39 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 00:03:39 [ReadPump] ✅ 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 00:03:46 [ReadPump] 收到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 00:03:46 [ReadPump] 解析用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的消息类型为 '1v1_match_request'
2025/12/31 00:03:46 [ReadPump] 收到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 00:03:46 [ReadPump] ✅ 用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 00:04:11 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 00:04:11 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x1400060a960, 新连接: 0x140000ac5a0
2025/12/31 00:04:11 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000ac5a0
2025/12/31 00:04:11 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2025/12/31 00:04:11 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 3, 连接指针: 0x140000ac5a0
2025/12/31 00:04:11 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140000ac5a0
2025/12/31 00:04:11 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 00:04:11 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000ac5a0
2025/12/31 00:04:11 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 00:04:11 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 00:04:11 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 00:04:11 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 00:04:11 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 3, 连接指针: 0x140000aa720
2025/12/31 00:04:11 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000aa720
2025/12/31 00:04:11 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140000aa720
2025/12/31 00:04:12 [ReadPump] 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 00:04:12 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 '1v1_match_request'
2025/12/31 00:04:12 [ReadPump] 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 00:04:12 [ReadPump] ✅ 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 00:05:22 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 00:05:22 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 '1v1_match_request'
2025/12/31 00:05:22 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 00:05:22 [ReadPump] ✅ 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 00:05:25 [ReadPump] 收到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 00:05:25 [ReadPump] 解析用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的消息类型为 '1v1_match_request'
2025/12/31 00:05:25 [ReadPump] 收到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 00:05:25 [ReadPump] ✅ 用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 00:05:39 [ReadPump] 收到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 00:05:39 [ReadPump] 解析用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的消息类型为 '1v1_match_request'
2025/12/31 00:05:39 [ReadPump] 收到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 00:05:39 [ReadPump] ✅ 用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 00:05:44 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 00:05:44 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 '1v1_match_request'
2025/12/31 00:05:44 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 00:05:44 [ReadPump] ✅ 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 00:05:51 [ReadPump] 收到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 00:05:51 [ReadPump] 解析用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的消息类型为 '1v1_match_request'
2025/12/31 00:05:51 [ReadPump] 收到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 00:05:51 [ReadPump] ✅ 用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 00:05:53 [ReadPump] 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 00:05:53 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 '1v1_match_request'
2025/12/31 00:05:53 [ReadPump] 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 00:05:53 [ReadPump] ✅ 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 00:05:58 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1005 (no status)
2025/12/31 00:05:58 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000aa720
2025/12/31 00:05:58 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 00:05:58 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 00:05:58 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 00:06:02 [ReadPump] 收到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 00:06:02 [ReadPump] 解析用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的消息类型为 '1v1_match_request'
2025/12/31 00:06:02 [ReadPump] 收到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 00:06:02 [ReadPump] ✅ 用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 00:06:03 [ReadPump] 收到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的原始消息: {"type":"1v1_match_cancel"}
2025/12/31 00:06:03 [ReadPump] 解析用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的消息类型为 '1v1_match_cancel'
2025/12/31 00:06:03 [ReadPump] 收到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的 1v1 匹配取消请求
2025/12/31 00:06:05 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 00:06:05 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 '1v1_match_request'
2025/12/31 00:06:05 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 00:06:05 [ReadPump] ✅ 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 00:06:13 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 00:06:13 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 '1v1_match_request'
2025/12/31 00:06:13 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 00:06:13 [ReadPump] ✅ 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 00:06:15 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000ace40
2025/12/31 00:06:15 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 00:06:15 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 3, 连接指针: 0x140000ace40
2025/12/31 00:06:15 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140000ace40
2025/12/31 00:06:15 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 00:06:15 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000ace40
2025/12/31 00:06:15 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 00:06:15 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 00:06:15 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 00:06:15 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000aa060
2025/12/31 00:06:15 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 00:06:15 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 3, 连接指针: 0x140000aa060
2025/12/31 00:06:15 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140000aa060
2025/12/31 00:06:16 [ReadPump] 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 00:06:16 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 '1v1_match_request'
2025/12/31 00:06:16 [ReadPump] 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 00:06:16 [ReadPump] ✅ 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 05:13:41 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 05:13:41 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 '1v1_match_request'
2025/12/31 05:13:41 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 05:13:41 [ReadPump] ✅ 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 05:13:53 [ReadPump] 收到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 05:13:53 [ReadPump] 解析用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的消息类型为 '1v1_match_request'
2025/12/31 05:13:53 [ReadPump] 收到用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 05:13:53 [ReadPump] ✅ 用户 d94bd664-2a3b-4b27-a25c-2b4185b873b7 (小南) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 05:14:02 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 05:14:02 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 '1v1_match_request'
2025/12/31 05:14:02 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 05:14:02 [ReadPump] ✅ 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 05:14:06 [ReadPump] 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息: {"type":"1v1_match_request"}
2025/12/31 05:14:06 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 '1v1_match_request'
2025/12/31 05:14:06 [ReadPump] 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 05:14:06 [ReadPump] ✅ 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 05:14:11 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1005 (no status)
2025/12/31 05:14:11 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000aa060
2025/12/31 05:14:11 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 05:14:11 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 05:14:11 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 05:14:13 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 05:14:13 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 3, 连接指针: 0x1400019d560
2025/12/31 05:14:13 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x1400019d560
2025/12/31 05:14:13 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x1400019d560
2025/12/31 05:14:15 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1005 (no status)
2025/12/31 05:14:15 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x1400019d560
2025/12/31 05:14:15 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 05:14:15 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 05:14:15 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 05:14:23 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000aa540
2025/12/31 05:14:23 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140000aa540
2025/12/31 05:14:23 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 05:14:23 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000aa540
2025/12/31 05:14:23 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 05:14:23 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 3, 连接指针: 0x140000aa540
2025/12/31 05:14:23 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 05:14:23 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 05:14:23 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 05:14:23 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000280180
2025/12/31 05:14:23 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000280180
2025/12/31 05:14:23 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 05:14:23 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 3, 连接指针: 0x14000280180
2025/12/31 05:14:27 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1005 (no status)
2025/12/31 05:14:27 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000280180
2025/12/31 05:14:27 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 05:14:27 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 05:14:27 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 05:14:28 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000aa5a0
2025/12/31 05:14:28 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140000aa5a0
2025/12/31 05:14:28 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 05:14:28 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 3, 连接指针: 0x140000aa5a0
2025/12/31 05:14:28 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 05:14:28 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000aa5a0
2025/12/31 05:14:28 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 05:14:28 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 05:14:28 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 05:14:29 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000acf60
2025/12/31 05:14:29 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140000acf60
2025/12/31 05:14:29 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 05:14:29 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 3, 连接指针: 0x140000acf60
2025/12/31 05:14:31 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1005 (no status)
2025/12/31 05:14:31 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000acf60
2025/12/31 05:14:31 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 05:14:31 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 05:14:31 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 05:16:01 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2025/12/31 05:16:01 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000aaf60
2025/12/31 05:16:01 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 05:16:01 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2025/12/31 05:16:01 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2025/12/31 05:16:20 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 483d3979-643a-4632-80f6-ab27f93d426e
2025/12/31 05:16:20 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 483d3979-643a-4632-80f6-ab27f93d426e, 连接指针: 0x140000aa960
2025/12/31 05:16:20 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 483d3979-643a-4632-80f6-ab27f93d426e 的消息，连接指针: 0x140000aa960
2025/12/31 05:16:21 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"483d3979-643a-4632-80f6-ab27f93d426e"}
2025/12/31 05:16:21 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 10:12:54 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 10:12:54 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140003028a0
2025/12/31 10:12:54 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003028a0
2025/12/31 10:12:54 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140003028a0
2025/12/31 10:12:54 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 10:12:54 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140003028a0, 新连接: 0x1400017f740
2025/12/31 10:12:54 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 10:12:54 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400017f740
2025/12/31 10:12:54 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400017f740
2025/12/31 10:12:54 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400017f740
2025/12/31 10:12:54 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 10:12:54 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003028a0
2025/12/31 10:12:54 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 10:12:59 [broadcastToRoom] 📢 向房间 global 的 2 个客户端广播消息类型: room_created (发送者: 无)
2025/12/31 10:12:59 [broadcastToRoom] ✅ 消息已发送给用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2025/12/31 10:12:59 [broadcastToRoom] ✅ 消息已发送给用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2025/12/31 10:12:59 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2025/12/31 10:12:59 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 99e87925-2d4f-4383-a19e-e358d973a267, 连接指针: 0x14000482e40
2025/12/31 10:12:59 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 99e87925-2d4f-4383-a19e-e358d973a267 的消息，连接指针: 0x14000482e40
2025/12/31 10:12:59 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 99e87925-2d4f-4383-a19e-e358d973a267
2025/12/31 10:12:59 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x1400017f740, 新连接: 0x14000482e40
2025/12/31 10:12:59 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 10:13:00 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"99e87925-2d4f-4383-a19e-e358d973a267"}
2025/12/31 10:13:00 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 10:23:14 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ac360
2025/12/31 10:23:14 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000ac360
2025/12/31 10:23:14 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 10:23:14 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000ac360
2025/12/31 10:23:14 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140001c1740
2025/12/31 10:23:14 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140001c1740
2025/12/31 10:23:14 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 10:23:14 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140000ac360, 新连接: 0x140001c1740
2025/12/31 10:23:14 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 10:23:14 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140001c1740
2025/12/31 10:23:14 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 10:23:14 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ac360
2025/12/31 10:23:14 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 10:23:18 [broadcastToRoom] 📢 向房间 global 的 2 个客户端广播消息类型: room_created (发送者: 无)
2025/12/31 10:23:18 [broadcastToRoom] ✅ 消息已发送给用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2025/12/31 10:23:18 [broadcastToRoom] ✅ 消息已发送给用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2025/12/31 10:23:18 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2025/12/31 10:23:18 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 11651b6f-89f9-4eb9-91ad-f8d43ba47806
2025/12/31 10:23:18 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140001c1740, 新连接: 0x14000682a80
2025/12/31 10:23:18 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 11651b6f-89f9-4eb9-91ad-f8d43ba47806, 连接指针: 0x14000682a80
2025/12/31 10:23:18 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 11651b6f-89f9-4eb9-91ad-f8d43ba47806 的消息，连接指针: 0x14000682a80
2025/12/31 10:23:18 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 10:23:19 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"11651b6f-89f9-4eb9-91ad-f8d43ba47806"}
2025/12/31 10:23:19 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 10:38:32 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2025/12/31 10:38:32 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140001c1740
2025/12/31 10:38:32 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2025/12/31 10:41:18 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:49206: write: broken pipe
2025/12/31 11:06:44 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ac6c0
2025/12/31 11:06:44 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000ac6c0
2025/12/31 11:06:44 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 11:06:44 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000ac6c0
2025/12/31 11:06:44 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000accc0
2025/12/31 11:06:44 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000accc0
2025/12/31 11:06:44 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 11:06:44 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140000ac6c0, 新连接: 0x140000accc0
2025/12/31 11:06:44 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 11:06:44 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000accc0
2025/12/31 11:06:44 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 11:06:44 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ac6c0
2025/12/31 11:06:44 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 11:06:46 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: ac71d3b7-9ba4-4f8e-aa35-cfc3251bebca
2025/12/31 11:06:46 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140000accc0, 新连接: 0x140000adbc0
2025/12/31 11:06:46 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 11:06:46 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: ac71d3b7-9ba4-4f8e-aa35-cfc3251bebca, 连接指针: 0x140000adbc0
2025/12/31 11:06:46 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 ac71d3b7-9ba4-4f8e-aa35-cfc3251bebca 的消息，连接指针: 0x140000adbc0
2025/12/31 11:06:47 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 11:06:47 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"ac71d3b7-9ba4-4f8e-aa35-cfc3251bebca"}
2025/12/31 11:06:47 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 11:07:38 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2025/12/31 11:09:28 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:65169: write: broken pipe
2025/12/31 13:29:39 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 13:29:39 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000accc0
2025/12/31 13:29:50 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2025/12/31 13:51:38 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2025/12/31 13:51:38 [broadcastToRoom] ⚠️ 房间 global 不存在，无法广播消息类型: room_created
2025/12/31 13:51:38 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2025/12/31 13:51:38 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 418f809c-a4ab-4dfe-a34b-0bab15dc5251, 连接指针: 0x1400007cf00
2025/12/31 13:51:38 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 418f809c-a4ab-4dfe-a34b-0bab15dc5251 的消息，连接指针: 0x1400007cf00
2025/12/31 13:51:38 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 418f809c-a4ab-4dfe-a34b-0bab15dc5251
2025/12/31 13:51:38 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 13:51:38 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"418f809c-a4ab-4dfe-a34b-0bab15dc5251"}
2025/12/31 13:51:38 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 14:19:30 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140004b4420
2025/12/31 14:19:30 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140004b4420
2025/12/31 14:19:30 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 14:19:30 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x140004b4420
2025/12/31 14:19:30 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 14:19:30 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x140004b4420, 新连接: 0x140004084e0
2025/12/31 14:19:30 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2025/12/31 14:19:30 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x140004084e0
2025/12/31 14:19:30 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140004084e0
2025/12/31 14:19:30 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140004084e0
2025/12/31 14:19:30 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 14:19:30 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140004b4420
2025/12/31 14:19:30 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 14:19:31 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 418f809c-a4ab-4dfe-a34b-0bab15dc5251, 连接指针: 0x140004b4720
2025/12/31 14:19:31 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 418f809c-a4ab-4dfe-a34b-0bab15dc5251 的消息，连接指针: 0x140004b4720
2025/12/31 14:19:31 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 418f809c-a4ab-4dfe-a34b-0bab15dc5251
2025/12/31 14:19:31 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x140004084e0, 新连接: 0x140004b4720
2025/12/31 14:19:31 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2025/12/31 14:19:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 14:19:50 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"418f809c-a4ab-4dfe-a34b-0bab15dc5251"}
2025/12/31 14:19:50 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 14:19:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 14:19:50 [ReadPump] 房间ID: 418f809c-a4ab-4dfe-a34b-0bab15dc5251, 准备广播给房间内其他成员
2025/12/31 14:19:50 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 14:19:50 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 14:19:50 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 14:19:50 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 14:19:50 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 14:19:50 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 14:19:50 [ReadPump] 准备调用 broadcastToRoom，房间ID: 418f809c-a4ab-4dfe-a34b-0bab15dc5251
2025/12/31 14:20:24 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2025/12/31 14:21:18 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 14:21:18 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140004084e0
2025/12/31 14:22:12 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2025/12/31 14:22:13 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:59712: write: broken pipe
2025/12/31 14:45:04 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2025/12/31 14:45:04 [broadcastToRoom] ⚠️ 房间 global 不存在，无法广播消息类型: room_created
2025/12/31 14:45:04 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2025/12/31 14:45:04 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 14:45:04 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 连接指针: 0x14000258300
2025/12/31 14:45:04 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 d4a5d2fd-c874-4ee0-a740-97f31108093c 的消息，连接指针: 0x14000258300
2025/12/31 14:45:05 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 14:45:05 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"d4a5d2fd-c874-4ee0-a740-97f31108093c"}
2025/12/31 14:45:05 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 14:52:17 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 14:52:17 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 连接指针: 0x140000adbc0
2025/12/31 14:52:17 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 d4a5d2fd-c874-4ee0-a740-97f31108093c 的消息，连接指针: 0x140000adbc0
2025/12/31 14:52:46 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 14:52:46 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"d4a5d2fd-c874-4ee0-a740-97f31108093c"}
2025/12/31 14:52:46 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 14:52:46 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 14:52:46 [ReadPump] 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 准备广播给房间内其他成员
2025/12/31 14:52:46 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 14:52:46 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 14:52:46 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 14:52:46 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 14:52:46 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 14:52:46 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 14:52:46 [ReadPump] 准备调用 broadcastToRoom，房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 15:37:56 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 15:37:56 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x140000a7980
2025/12/31 15:37:56 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000a7980
2025/12/31 15:37:56 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140000a7980
2025/12/31 15:37:56 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 15:37:56 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000a7980
2025/12/31 15:37:56 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 15:37:56 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 15:37:56 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 15:37:56 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000a7ce0
2025/12/31 15:37:56 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140000a7ce0
2025/12/31 15:37:56 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 15:37:56 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x140000a7ce0
2025/12/31 15:38:05 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 15:38:05 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x140000a7ce0, 新连接: 0x14000100900
2025/12/31 15:38:05 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2025/12/31 15:38:05 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 连接指针: 0x14000100900
2025/12/31 15:38:05 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 d4a5d2fd-c874-4ee0-a740-97f31108093c 的消息，连接指针: 0x14000100900
2025/12/31 15:38:11 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 15:38:11 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"d4a5d2fd-c874-4ee0-a740-97f31108093c"}
2025/12/31 15:38:11 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 15:38:11 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 15:38:11 [ReadPump] 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 准备广播给房间内其他成员
2025/12/31 15:38:11 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 15:38:11 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 15:38:11 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 15:38:11 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 15:38:11 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 15:38:11 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 15:38:11 [ReadPump] 准备调用 broadcastToRoom，房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 15:38:50 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2025/12/31 15:58:23 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 15:58:23 [broadcastToRoom] ENTER | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c type=member_update
2025/12/31 15:58:23 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 连接指针: 0x1400007d0e0
2025/12/31 15:58:23 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 d4a5d2fd-c874-4ee0-a740-97f31108093c 的消息，连接指针: 0x1400007d0e0
2025/12/31 15:58:28 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 15:58:28 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"d4a5d2fd-c874-4ee0-a740-97f31108093c"}
2025/12/31 15:58:28 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 15:58:28 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 15:58:28 [ReadPump] 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 准备广播给房间内其他成员
2025/12/31 15:58:28 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 15:58:28 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 15:58:28 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 15:58:28 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 15:58:28 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 15:58:28 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 15:58:28 [ReadPump] 准备调用 broadcastToRoom，房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 15:58:28 [broadcastToRoom] ENTER | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c type=mic_request
2025/12/31 17:13:13 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:13:13 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 连接指针: 0x140000acf00
2025/12/31 17:13:13 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 d4a5d2fd-c874-4ee0-a740-97f31108093c 的消息，连接指针: 0x140000acf00
2025/12/31 17:13:18 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 17:13:18 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"d4a5d2fd-c874-4ee0-a740-97f31108093c"}
2025/12/31 17:13:18 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 17:13:18 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 17:13:18 [ReadPump] 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 准备广播给房间内其他成员
2025/12/31 17:13:18 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 17:13:18 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 17:13:18 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 17:13:18 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:13:18 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:13:18 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:13:18 [ReadPump] 准备调用 broadcastToRoom，房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:16:50 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:16:50 [broadcastToRoom] ENTER | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c type=member_update
2025/12/31 17:16:50 [broadcastToRoom] 准备获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:16:50 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 连接指针: 0x14000696660
2025/12/31 17:16:50 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 d4a5d2fd-c874-4ee0-a740-97f31108093c 的消息，连接指针: 0x14000696660
2025/12/31 17:16:55 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 17:16:55 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"d4a5d2fd-c874-4ee0-a740-97f31108093c"}
2025/12/31 17:16:55 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 17:16:55 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 17:16:55 [ReadPump] 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 准备广播给房间内其他成员
2025/12/31 17:16:55 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 17:16:55 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 17:16:55 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 17:16:55 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:16:55 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:16:55 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:16:55 [ReadPump] 准备调用 broadcastToRoom，房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:16:55 [broadcastToRoom] ENTER | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c type=mic_request
2025/12/31 17:16:55 [broadcastToRoom] 准备获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:19:57 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:19:57 [broadcastToRoom] ENTER | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c type=member_update
2025/12/31 17:19:57 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 连接指针: 0x1400041ce40
2025/12/31 17:19:57 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 d4a5d2fd-c874-4ee0-a740-97f31108093c 的消息，连接指针: 0x1400041ce40
2025/12/31 17:19:57 [broadcastToRoom] 准备获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:19:57 [broadcastToRoom] 已获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:19:57 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c roomSize=1
2025/12/31 17:19:57 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:19:57 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:19:59 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 17:19:59 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"d4a5d2fd-c874-4ee0-a740-97f31108093c"}
2025/12/31 17:19:59 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 17:19:59 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 17:19:59 [ReadPump] 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 准备广播给房间内其他成员
2025/12/31 17:19:59 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 17:19:59 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 17:19:59 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 17:19:59 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:19:59 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:19:59 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:19:59 [ReadPump] 准备调用 broadcastToRoom，房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:19:59 [broadcastToRoom] ENTER | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c type=mic_request
2025/12/31 17:19:59 [broadcastToRoom] 准备获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:19:59 [broadcastToRoom] 已获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:19:59 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c roomSize=1
2025/12/31 17:19:59 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:19:59 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:19:59 [ReadPump] ✅ 连麦申请已广播给房间 d4a5d2fd-c874-4ee0-a740-97f31108093c 的其他成员
2025/12/31 17:20:45 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c): websocket: close 1005 (no status)
2025/12/31 17:20:45 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 连接指针: 0x1400041ce40
2025/12/31 17:20:45 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:20:45 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 17:20:45 [broadcastToRoom] ENTER | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c type=member_update
2025/12/31 17:20:45 [broadcastToRoom] 准备获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:20:45 [broadcastToRoom] 已获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:20:45 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:20:45 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2025/12/31 17:20:56 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 连接指针: 0x14000589380
2025/12/31 17:20:56 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 d4a5d2fd-c874-4ee0-a740-97f31108093c 的消息，连接指针: 0x14000589380
2025/12/31 17:20:58 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 17:20:58 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"d4a5d2fd-c874-4ee0-a740-97f31108093c"}
2025/12/31 17:20:58 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 17:20:58 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 17:20:58 [ReadPump] 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 准备广播给房间内其他成员
2025/12/31 17:20:58 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 17:20:58 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 17:20:58 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 17:20:58 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:20:58 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:20:58 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:20:58 [ReadPump] 准备调用 broadcastToRoom，房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:20:58 [broadcastToRoom] ENTER | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c type=mic_request
2025/12/31 17:20:58 [broadcastToRoom] 准备获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:23:38 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:57194: write: broken pipe
2025/12/31 17:24:40 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:40 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 连接指针: 0x140001190e0
2025/12/31 17:24:40 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 d4a5d2fd-c874-4ee0-a740-97f31108093c 的消息，连接指针: 0x140001190e0
2025/12/31 17:24:40 [broadcastToRoom] ENTER | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c type=member_update
2025/12/31 17:24:40 [broadcastToRoom] 准备获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:40 [broadcastToRoom] 已获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:40 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c roomSize=1
2025/12/31 17:24:40 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:40 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:46 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 17:24:46 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"d4a5d2fd-c874-4ee0-a740-97f31108093c"}
2025/12/31 17:24:46 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 17:24:46 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 17:24:46 [ReadPump] 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 准备广播给房间内其他成员
2025/12/31 17:24:46 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 17:24:46 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 17:24:46 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 17:24:46 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:24:46 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:24:46 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:24:46 [ReadPump] 准备调用 broadcastToRoom，房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:46 [broadcastToRoom] ENTER | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c type=mic_request
2025/12/31 17:24:46 [broadcastToRoom] 准备获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:46 [broadcastToRoom] 已获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:46 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c roomSize=1
2025/12/31 17:24:46 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:46 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:46 [ReadPump] ✅ 连麦申请已广播给房间 d4a5d2fd-c874-4ee0-a740-97f31108093c 的其他成员
2025/12/31 17:24:56 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c): websocket: close 1005 (no status)
2025/12/31 17:24:56 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c, 连接指针: 0x140001190e0
2025/12/31 17:24:56 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:56 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 17:24:56 [broadcastToRoom] ENTER | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c type=member_update
2025/12/31 17:24:56 [broadcastToRoom] 准备获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:56 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2025/12/31 17:24:56 [broadcastToRoom] 已获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:56 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:56 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:56 [broadcastToRoom] ENTER | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c type=room_deleted
2025/12/31 17:24:56 [broadcastToRoom] 准备获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:56 [broadcastToRoom] 已获取 RLock | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:56 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=d4a5d2fd-c874-4ee0-a740-97f31108093c
2025/12/31 17:24:56 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2025/12/31 17:25:13 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: b24c0fd7-3534-4dee-b64f-765d8f8e0e66
2025/12/31 17:25:13 [broadcastToRoom] ENTER | roomID=b24c0fd7-3534-4dee-b64f-765d8f8e0e66 type=member_update
2025/12/31 17:25:13 [broadcastToRoom] 准备获取 RLock | roomID=b24c0fd7-3534-4dee-b64f-765d8f8e0e66
2025/12/31 17:25:13 [broadcastToRoom] 已获取 RLock | roomID=b24c0fd7-3534-4dee-b64f-765d8f8e0e66
2025/12/31 17:25:13 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=b24c0fd7-3534-4dee-b64f-765d8f8e0e66 roomSize=1
2025/12/31 17:25:13 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=b24c0fd7-3534-4dee-b64f-765d8f8e0e66
2025/12/31 17:25:13 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=b24c0fd7-3534-4dee-b64f-765d8f8e0e66
2025/12/31 17:25:13 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: b24c0fd7-3534-4dee-b64f-765d8f8e0e66, 连接指针: 0x140004ce4e0
2025/12/31 17:25:13 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 b24c0fd7-3534-4dee-b64f-765d8f8e0e66 的消息，连接指针: 0x140004ce4e0
2025/12/31 17:25:16 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: b24c0fd7-3534-4dee-b64f-765d8f8e0e66): websocket: close 1005 (no status)
2025/12/31 17:25:16 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: b24c0fd7-3534-4dee-b64f-765d8f8e0e66, 连接指针: 0x140004ce4e0
2025/12/31 17:25:16 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: b24c0fd7-3534-4dee-b64f-765d8f8e0e66
2025/12/31 17:25:16 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 17:25:16 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2025/12/31 17:25:16 [broadcastToRoom] ENTER | roomID=b24c0fd7-3534-4dee-b64f-765d8f8e0e66 type=member_update
2025/12/31 17:25:16 [broadcastToRoom] 准备获取 RLock | roomID=b24c0fd7-3534-4dee-b64f-765d8f8e0e66
2025/12/31 17:25:16 [broadcastToRoom] 已获取 RLock | roomID=b24c0fd7-3534-4dee-b64f-765d8f8e0e66
2025/12/31 17:25:16 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=b24c0fd7-3534-4dee-b64f-765d8f8e0e66
2025/12/31 17:25:16 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: b24c0fd7-3534-4dee-b64f-765d8f8e0e66
2025/12/31 17:25:16 [broadcastToRoom] ENTER | roomID=b24c0fd7-3534-4dee-b64f-765d8f8e0e66 type=room_deleted
2025/12/31 17:25:16 [broadcastToRoom] 准备获取 RLock | roomID=b24c0fd7-3534-4dee-b64f-765d8f8e0e66
2025/12/31 17:25:16 [broadcastToRoom] 已获取 RLock | roomID=b24c0fd7-3534-4dee-b64f-765d8f8e0e66
2025/12/31 17:25:16 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=b24c0fd7-3534-4dee-b64f-765d8f8e0e66
2025/12/31 17:25:16 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2025/12/31 17:28:19 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2025/12/31 17:28:19 [broadcastToRoom] ENTER | roomID=global type=room_created
2025/12/31 17:28:19 [broadcastToRoom] 准备获取 RLock | roomID=global
2025/12/31 17:28:19 [broadcastToRoom] 已获取 RLock | roomID=global
2025/12/31 17:28:19 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=global
2025/12/31 17:28:19 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2025/12/31 17:28:19 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:19 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=member_update
2025/12/31 17:28:19 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:19 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:19 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 17:28:19 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:19 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:19 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 连接指针: 0x14000101ec0
2025/12/31 17:28:19 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的消息，连接指针: 0x14000101ec0
2025/12/31 17:28:20 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:28:20 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:28:20 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:28:20 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:28:20 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:20 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:20 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 17:28:20 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:20 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:20 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:28:20 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:28:20 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:28:20 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:28:20 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:20 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:20 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 17:28:20 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:20 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:23 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:23 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=member_update
2025/12/31 17:28:23 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:23 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:23 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:28:23 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:23 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: member_update
2025/12/31 17:28:23 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 连接指针: 0x14000024420
2025/12/31 17:28:23 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的消息，连接指针: 0x14000024420
2025/12/31 17:28:24 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:28:24 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:28:24 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:28:24 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:28:24 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:24 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:24 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:28:24 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:24 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_on
2025/12/31 17:28:24 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:28:24 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:28:24 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:28:24 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:28:24 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:24 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:24 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:28:24 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:24 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_on
2025/12/31 17:28:24 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 17:28:24 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:28:24 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 17:28:24 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 17:28:24 [ReadPump] 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 准备广播给房间内其他成员
2025/12/31 17:28:24 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 17:28:24 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 17:28:24 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 17:28:24 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:28:24 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:28:24 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:28:24 [ReadPump] 准备调用 broadcastToRoom，房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:24 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_request
2025/12/31 17:28:24 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:24 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:24 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:28:24 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:24 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_request
2025/12/31 17:28:24 [ReadPump] ✅ 连麦申请已广播给房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的其他成员
2025/12/31 17:28:33 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:28:33 [ReadPump] 消息内容: {"type":"mic_approve","target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:28:33 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2025/12/31 17:28:40 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e): websocket: close 1005 (no status)
2025/12/31 17:28:40 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 连接指针: 0x14000024420
2025/12/31 17:28:40 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:40 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 17:28:40 [Unregister] 房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2025/12/31 17:28:40 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2025/12/31 17:28:40 [Unregister] 房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 保留（还有 1 个在线成员）
2025/12/31 17:28:40 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=member_update
2025/12/31 17:28:40 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:40 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:40 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 17:28:40 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:40 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: member_update
2025/12/31 17:28:40 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:28:40 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:28:40 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:28:40 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:28:40 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:40 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:40 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 17:28:40 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:40 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:40 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:28:40 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:28:40 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:28:40 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:28:40 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:40 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:40 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 17:28:40 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:40 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:49 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:49 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=member_update
2025/12/31 17:28:49 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:49 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 连接指针: 0x14000602c00
2025/12/31 17:28:49 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的消息，连接指针: 0x14000602c00
2025/12/31 17:28:49 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:49 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:28:49 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:49 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: member_update
2025/12/31 17:28:49 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:28:49 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:28:49 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:28:49 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:28:49 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:49 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:49 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:28:49 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:49 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_on
2025/12/31 17:28:50 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:28:50 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:28:50 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:28:50 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:28:50 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:50 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:50 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:28:50 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:50 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_on
2025/12/31 17:28:58 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 17:28:58 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:28:58 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 17:28:58 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 17:28:58 [ReadPump] 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 准备广播给房间内其他成员
2025/12/31 17:28:58 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 17:28:58 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 17:28:58 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 17:28:58 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:28:58 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:28:58 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:28:58 [ReadPump] 准备调用 broadcastToRoom，房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:58 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_request
2025/12/31 17:28:58 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:58 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:58 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:28:58 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:28:58 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_request
2025/12/31 17:28:58 [ReadPump] ✅ 连麦申请已广播给房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的其他成员
2025/12/31 17:29:02 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:29:02 [ReadPump] 消息内容: {"type":"mic_reject","target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:29:02 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_reject'
2025/12/31 17:29:25 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e): websocket: close 1005 (no status)
2025/12/31 17:29:25 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 连接指针: 0x14000602c00
2025/12/31 17:29:25 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:25 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 17:29:25 [Unregister] 房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2025/12/31 17:29:25 [Unregister] 房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 保留（还有 1 个在线成员）
2025/12/31 17:29:25 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=member_update
2025/12/31 17:29:25 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:25 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:25 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 17:29:25 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:25 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: member_update
2025/12/31 17:29:25 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2025/12/31 17:29:26 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:29:26 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:29:26 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:29:26 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:29:26 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:26 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:26 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 17:29:26 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:26 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:26 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:29:26 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:29:26 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:29:26 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:29:26 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:26 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:26 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 17:29:26 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:26 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:26 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 连接指针: 0x14000602ae0
2025/12/31 17:29:26 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的消息，连接指针: 0x14000602ae0
2025/12/31 17:29:26 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:26 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=member_update
2025/12/31 17:29:26 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:26 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:26 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:29:26 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:26 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: member_update
2025/12/31 17:29:27 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:29:27 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:29:27 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:29:27 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:29:27 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:27 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:27 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:29:27 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:27 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_on
2025/12/31 17:29:27 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:29:27 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:29:27 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:29:27 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:29:27 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:27 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:27 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:29:27 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:27 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_on
2025/12/31 17:29:28 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 17:29:28 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:29:28 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 17:29:28 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 17:29:28 [ReadPump] 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 准备广播给房间内其他成员
2025/12/31 17:29:28 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 17:29:28 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 17:29:28 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 17:29:28 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:29:28 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:29:28 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:29:28 [ReadPump] 准备调用 broadcastToRoom，房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:28 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_request
2025/12/31 17:29:28 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:28 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:28 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:29:28 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:28 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_request
2025/12/31 17:29:28 [ReadPump] ✅ 连麦申请已广播给房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的其他成员
2025/12/31 17:29:32 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:29:32 [ReadPump] 消息内容: {"type":"mic_approve","target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:29:32 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2025/12/31 17:29:45 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e): websocket: close 1005 (no status)
2025/12/31 17:29:45 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 连接指针: 0x14000602ae0
2025/12/31 17:29:45 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:45 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 17:29:45 [Unregister] 房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2025/12/31 17:29:45 [Unregister] 房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 保留（还有 1 个在线成员）
2025/12/31 17:29:45 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=member_update
2025/12/31 17:29:45 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:45 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:45 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 17:29:45 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:45 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: member_update
2025/12/31 17:29:45 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2025/12/31 17:29:46 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:29:46 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:29:46 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:29:46 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:29:46 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:46 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:46 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 17:29:46 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:46 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:46 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:29:46 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:29:46 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:29:46 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:29:46 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:46 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:46 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 17:29:46 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:46 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:46 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:46 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 连接指针: 0x14000301020
2025/12/31 17:29:46 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的消息，连接指针: 0x14000301020
2025/12/31 17:29:46 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=member_update
2025/12/31 17:29:46 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:46 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:46 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:29:46 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:46 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: member_update
2025/12/31 17:29:47 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:29:47 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:29:47 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:29:47 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:29:47 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:47 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:47 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:29:47 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:47 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_on
2025/12/31 17:29:47 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:29:47 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:29:47 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:29:47 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:29:47 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:47 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:47 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:29:47 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:47 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_on
2025/12/31 17:29:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 17:29:50 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:29:50 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 17:29:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 17:29:50 [ReadPump] 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 准备广播给房间内其他成员
2025/12/31 17:29:50 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 17:29:50 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 17:29:50 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 17:29:50 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:29:50 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:29:50 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:29:50 [ReadPump] 准备调用 broadcastToRoom，房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:50 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_request
2025/12/31 17:29:50 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:50 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:50 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:29:50 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:29:50 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_request
2025/12/31 17:29:50 [ReadPump] ✅ 连麦申请已广播给房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的其他成员
2025/12/31 17:35:50 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:35:50 [ReadPump] 消息内容: {"type":"mic_approve","target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:35:50 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2025/12/31 17:39:25 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e): websocket: close 1005 (no status)
2025/12/31 17:39:25 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 连接指针: 0x14000301020
2025/12/31 17:39:25 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:25 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 17:39:25 [Unregister] 房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2025/12/31 17:39:25 [Unregister] 房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 保留（还有 1 个在线成员）
2025/12/31 17:39:25 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2025/12/31 17:39:25 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=member_update
2025/12/31 17:39:25 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:25 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:25 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 17:39:25 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:25 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: member_update
2025/12/31 17:39:26 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:39:26 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:39:26 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:39:26 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:39:26 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:26 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:26 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 17:39:26 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:26 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:26 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:26 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=member_update
2025/12/31 17:39:26 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:26 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:26 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:39:26 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:26 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: member_update
2025/12/31 17:39:26 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 连接指针: 0x14000300b40
2025/12/31 17:39:26 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的消息，连接指针: 0x14000300b40
2025/12/31 17:39:26 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:39:26 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:39:26 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:39:26 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:39:26 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:26 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:26 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:39:26 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:26 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_on
2025/12/31 17:39:28 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:39:28 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:39:28 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:39:28 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:39:28 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:28 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:28 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:39:28 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:28 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_on
2025/12/31 17:39:28 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 17:39:28 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:39:28 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 17:39:28 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 17:39:28 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:28 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:28 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:39:28 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:28 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_on
2025/12/31 17:39:28 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 17:39:28 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 17:39:28 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 17:39:28 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 17:39:28 [ReadPump] 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 准备广播给房间内其他成员
2025/12/31 17:39:28 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 17:39:28 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 17:39:28 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 17:39:28 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:39:28 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:39:28 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 17:39:28 [ReadPump] 准备调用 broadcastToRoom，房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:28 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_request
2025/12/31 17:39:28 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:28 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:28 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 17:39:28 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 17:39:28 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_request
2025/12/31 17:39:28 [ReadPump] ✅ 连麦申请已广播给房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的其他成员
2025/12/31 21:52:12 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 21:52:12 [ReadPump] 消息内容: {"type":"mic_approve","target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 21:52:12 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2025/12/31 22:06:42 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e): websocket: close 1005 (no status)
2025/12/31 22:06:42 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 连接指针: 0x14000300b40
2025/12/31 22:06:42 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:42 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 22:06:42 [Unregister] 房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2025/12/31 22:06:42 [Unregister] 房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 保留（还有 1 个在线成员）
2025/12/31 22:06:42 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2025/12/31 22:06:42 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=member_update
2025/12/31 22:06:42 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:42 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:42 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 22:06:42 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:42 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: member_update
2025/12/31 22:06:43 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:06:43 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 22:06:43 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:06:43 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 22:06:43 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:43 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:43 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 22:06:43 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:43 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:43 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:06:43 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 22:06:43 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:06:43 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 22:06:43 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:43 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:43 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 22:06:43 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:43 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:45 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:45 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=member_update
2025/12/31 22:06:45 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:45 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:45 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 22:06:45 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:45 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: member_update
2025/12/31 22:06:45 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 连接指针: 0x14000526540
2025/12/31 22:06:45 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的消息，连接指针: 0x14000526540
2025/12/31 22:06:45 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:06:45 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 22:06:45 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:06:45 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 22:06:45 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:45 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:45 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 22:06:45 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:45 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_on
2025/12/31 22:06:45 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:06:45 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 22:06:45 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:06:45 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_on
2025/12/31 22:06:45 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:45 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:45 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 22:06:45 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:45 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_on
2025/12/31 22:06:48 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:06:48 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 22:06:48 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 22:06:48 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 22:06:48 [ReadPump] 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 准备广播给房间内其他成员
2025/12/31 22:06:48 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 22:06:48 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 22:06:48 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 22:06:48 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:06:48 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:06:48 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:06:48 [ReadPump] 准备调用 broadcastToRoom，房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:48 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_request
2025/12/31 22:06:48 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:48 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:48 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=2
2025/12/31 22:06:48 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:06:48 [broadcastToRoom] 📢 向房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的 1 个客户端广播消息类型: mic_request
2025/12/31 22:06:48 [ReadPump] ✅ 连麦申请已广播给房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的其他成员
2025/12/31 22:06:51 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:06:51 [ReadPump] 消息内容: {"type":"mic_approve","target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 22:06:51 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2025/12/31 22:10:50 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000421a40
2025/12/31 22:10:50 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000421a40
2025/12/31 22:10:50 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 22:10:50 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x14000421a40
2025/12/31 22:10:50 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000a7200
2025/12/31 22:10:50 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140000a7200
2025/12/31 22:10:50 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 22:10:50 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x14000421a40, 新连接: 0x140000a7200
2025/12/31 22:10:50 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2025/12/31 22:10:50 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x140000a7200
2025/12/31 22:10:50 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 22:10:50 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000421a40
2025/12/31 22:10:50 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 22:10:51 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:10:51 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x140000a7200, 新连接: 0x140000a7a40
2025/12/31 22:10:51 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2025/12/31 22:10:51 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=member_update
2025/12/31 22:10:51 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:10:51 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:10:51 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 22:10:51 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:10:51 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:10:51 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 连接指针: 0x140000a7a40
2025/12/31 22:10:51 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的消息，连接指针: 0x140000a7a40
2025/12/31 22:10:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:10:54 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"c74e1ccb-fb51-4434-9288-cd4ce1ebad6e"}
2025/12/31 22:10:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 22:10:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 22:10:54 [ReadPump] 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 准备广播给房间内其他成员
2025/12/31 22:10:54 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 22:10:54 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 22:10:54 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 22:10:54 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:10:54 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:10:54 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:10:54 [ReadPump] 准备调用 broadcastToRoom，房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:10:54 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=mic_request
2025/12/31 22:10:54 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:10:54 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:10:54 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e roomSize=1
2025/12/31 22:10:54 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:10:54 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:10:54 [ReadPump] ✅ 连麦申请已广播给房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 的其他成员
2025/12/31 22:11:33 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000210de0
2025/12/31 22:11:33 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000210de0
2025/12/31 22:11:33 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 22:11:33 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000210de0
2025/12/31 22:11:33 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140001a1140
2025/12/31 22:11:33 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140001a1140
2025/12/31 22:11:33 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 22:11:33 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x14000210de0, 新连接: 0x140001a1140
2025/12/31 22:11:33 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 22:11:33 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140001a1140
2025/12/31 22:11:33 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 22:11:33 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000210de0
2025/12/31 22:11:33 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 22:11:38 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2025/12/31 22:11:38 [broadcastToRoom] ENTER | roomID=global type=room_created
2025/12/31 22:11:38 [broadcastToRoom] 准备获取 RLock | roomID=global
2025/12/31 22:11:38 [broadcastToRoom] 已获取 RLock | roomID=global
2025/12/31 22:11:38 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=global roomSize=4
2025/12/31 22:11:38 [broadcastToRoom] 已释放 RLock，recipients=4 | roomID=global
2025/12/31 22:11:38 [broadcastToRoom] 📢 向房间 global 的 4 个客户端广播消息类型: room_created
2025/12/31 22:11:38 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2025/12/31 22:11:38 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 获取写入器失败: websocket: close sent
2025/12/31 22:11:38 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2025/12/31 22:11:38 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5, 连接指针: 0x140000a65a0
2025/12/31 22:11:38 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 的消息，连接指针: 0x140000a65a0
2025/12/31 22:11:38 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:38 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140001a1140, 新连接: 0x140000a65a0
2025/12/31 22:11:38 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 22:11:38 [broadcastToRoom] ENTER | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 type=member_update
2025/12/31 22:11:38 [broadcastToRoom] 准备获取 RLock | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:38 [broadcastToRoom] 已获取 RLock | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:38 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 roomSize=1
2025/12/31 22:11:38 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:38 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:39 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:11:39 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5"}
2025/12/31 22:11:39 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:11:39 [broadcastToRoom] ENTER | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 type=mic_on
2025/12/31 22:11:39 [broadcastToRoom] 准备获取 RLock | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:39 [broadcastToRoom] 已获取 RLock | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:39 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 roomSize=1
2025/12/31 22:11:39 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:39 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:39 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:11:39 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5"}
2025/12/31 22:11:39 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:11:39 [broadcastToRoom] ENTER | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 type=mic_on
2025/12/31 22:11:39 [broadcastToRoom] 准备获取 RLock | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:39 [broadcastToRoom] 已获取 RLock | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:39 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 roomSize=1
2025/12/31 22:11:39 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:39 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:42 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 22:11:42 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000a7200
2025/12/31 22:11:42 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 22:11:42 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e): websocket: close 1001 (going away)
2025/12/31 22:11:42 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e, 连接指针: 0x140000a7a40
2025/12/31 22:11:42 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:11:42 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 22:11:42 [Unregister] 房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 清理客户端后，剩余成员数: 0, shouldDeleteRoom: true
2025/12/31 22:11:42 [Unregister] 房间 c74e1ccb-fb51-4434-9288-cd4ce1ebad6e 已删除（没有在线成员）
2025/12/31 22:11:42 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=member_update
2025/12/31 22:11:42 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:11:42 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:11:42 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:11:42 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2025/12/31 22:11:42 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 获取写入器失败: websocket: close sent
2025/12/31 22:11:42 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:11:42 [broadcastToRoom] ENTER | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e type=room_deleted
2025/12/31 22:11:42 [broadcastToRoom] 准备获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:11:42 [broadcastToRoom] 已获取 RLock | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:11:42 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=c74e1ccb-fb51-4434-9288-cd4ce1ebad6e
2025/12/31 22:11:42 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2025/12/31 22:11:44 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000641140
2025/12/31 22:11:44 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000641140
2025/12/31 22:11:44 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 22:11:44 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x14000641140
2025/12/31 22:11:44 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 22:11:44 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x14000641140, 新连接: 0x1400024f800
2025/12/31 22:11:44 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2025/12/31 22:11:44 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x1400024f800
2025/12/31 22:11:44 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x1400024f800
2025/12/31 22:11:44 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x1400024f800
2025/12/31 22:11:45 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 22:11:45 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000641140
2025/12/31 22:11:45 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 22:11:46 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:46 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x1400024f800, 新连接: 0x140005ad800
2025/12/31 22:11:46 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2025/12/31 22:11:46 [broadcastToRoom] ENTER | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 type=member_update
2025/12/31 22:11:46 [broadcastToRoom] 准备获取 RLock | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:46 [broadcastToRoom] 已获取 RLock | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:46 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 roomSize=2
2025/12/31 22:11:46 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:46 [broadcastToRoom] 📢 向房间 31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 的 1 个客户端广播消息类型: member_update
2025/12/31 22:11:46 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5, 连接指针: 0x140005ad800
2025/12/31 22:11:46 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 的消息，连接指针: 0x140005ad800
2025/12/31 22:11:46 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:11:46 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5"}
2025/12/31 22:11:46 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:11:46 [broadcastToRoom] ENTER | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 type=mic_on
2025/12/31 22:11:46 [broadcastToRoom] 准备获取 RLock | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:46 [broadcastToRoom] 已获取 RLock | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:46 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 roomSize=2
2025/12/31 22:11:46 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:46 [broadcastToRoom] 📢 向房间 31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 的 1 个客户端广播消息类型: mic_on
2025/12/31 22:11:46 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:11:46 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5"}
2025/12/31 22:11:46 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:11:46 [broadcastToRoom] ENTER | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 type=mic_on
2025/12/31 22:11:46 [broadcastToRoom] 准备获取 RLock | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:46 [broadcastToRoom] 已获取 RLock | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:46 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 roomSize=2
2025/12/31 22:11:46 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:46 [broadcastToRoom] 📢 向房间 31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 的 1 个客户端广播消息类型: mic_on
2025/12/31 22:11:48 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:11:48 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5"}
2025/12/31 22:11:48 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 22:11:48 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 22:11:48 [ReadPump] 房间ID: 31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5, 准备广播给房间内其他成员
2025/12/31 22:11:48 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 22:11:48 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 22:11:48 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 22:11:48 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:11:48 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:11:48 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:11:48 [ReadPump] 准备调用 broadcastToRoom，房间ID: 31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:48 [broadcastToRoom] ENTER | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 type=mic_request
2025/12/31 22:11:48 [broadcastToRoom] 准备获取 RLock | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:48 [broadcastToRoom] 已获取 RLock | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:48 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 roomSize=2
2025/12/31 22:11:48 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5
2025/12/31 22:11:48 [broadcastToRoom] 📢 向房间 31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 的 1 个客户端广播消息类型: mic_request
2025/12/31 22:11:48 [ReadPump] ✅ 连麦申请已广播给房间 31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5 的其他成员
2025/12/31 22:11:58 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:11:58 [ReadPump] 消息内容: {"type":"mic_approve","target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"31c40d74-6b3f-4a7a-8f64-1a0e4f738aa5"}
2025/12/31 22:11:58 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2025/12/31 22:12:38 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2025/12/31 22:17:25 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000280600
2025/12/31 22:17:25 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000280600
2025/12/31 22:17:25 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 22:17:25 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000280600
2025/12/31 22:17:25 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400048c060
2025/12/31 22:17:25 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400048c060
2025/12/31 22:17:25 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 22:17:25 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x14000280600, 新连接: 0x1400048c060
2025/12/31 22:17:25 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 22:17:25 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400048c060
2025/12/31 22:17:25 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 22:17:25 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000280600
2025/12/31 22:17:25 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 22:17:30 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2025/12/31 22:17:30 [broadcastToRoom] ENTER | roomID=global type=room_created
2025/12/31 22:17:30 [broadcastToRoom] 准备获取 RLock | roomID=global
2025/12/31 22:17:30 [broadcastToRoom] 已获取 RLock | roomID=global
2025/12/31 22:17:30 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=global roomSize=2
2025/12/31 22:17:30 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=global
2025/12/31 22:17:30 [broadcastToRoom] 📢 向房间 global 的 2 个客户端广播消息类型: room_created
2025/12/31 22:17:30 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2025/12/31 22:17:30 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2025/12/31 22:17:30 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:30 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x1400048c060, 新连接: 0x1400048d5c0
2025/12/31 22:17:30 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 22:17:30 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=member_update
2025/12/31 22:17:30 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:30 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb, 连接指针: 0x1400048d5c0
2025/12/31 22:17:30 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 3af835f6-f73a-45a0-b64e-c621cf744deb 的消息，连接指针: 0x1400048d5c0
2025/12/31 22:17:30 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:30 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb roomSize=1
2025/12/31 22:17:30 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:30 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:31 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:17:31 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"3af835f6-f73a-45a0-b64e-c621cf744deb"}
2025/12/31 22:17:31 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:17:31 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=mic_on
2025/12/31 22:17:31 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:31 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:31 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb roomSize=1
2025/12/31 22:17:31 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:31 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:31 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:17:31 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"3af835f6-f73a-45a0-b64e-c621cf744deb"}
2025/12/31 22:17:31 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:17:31 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=mic_on
2025/12/31 22:17:31 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:31 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:31 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb roomSize=1
2025/12/31 22:17:31 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:31 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:36 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:36 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=member_update
2025/12/31 22:17:36 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb, 连接指针: 0x1400044a180
2025/12/31 22:17:36 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 3af835f6-f73a-45a0-b64e-c621cf744deb 的消息，连接指针: 0x1400044a180
2025/12/31 22:17:36 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:36 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:36 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb roomSize=2
2025/12/31 22:17:36 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:36 [broadcastToRoom] 📢 向房间 3af835f6-f73a-45a0-b64e-c621cf744deb 的 1 个客户端广播消息类型: member_update
2025/12/31 22:17:37 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:17:37 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"3af835f6-f73a-45a0-b64e-c621cf744deb"}
2025/12/31 22:17:37 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:17:37 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=mic_on
2025/12/31 22:17:37 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:37 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:37 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb roomSize=2
2025/12/31 22:17:37 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:37 [broadcastToRoom] 📢 向房间 3af835f6-f73a-45a0-b64e-c621cf744deb 的 1 个客户端广播消息类型: mic_on
2025/12/31 22:17:37 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:17:37 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"3af835f6-f73a-45a0-b64e-c621cf744deb"}
2025/12/31 22:17:37 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:17:37 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=mic_on
2025/12/31 22:17:37 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:37 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:37 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb roomSize=2
2025/12/31 22:17:37 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:37 [broadcastToRoom] 📢 向房间 3af835f6-f73a-45a0-b64e-c621cf744deb 的 1 个客户端广播消息类型: mic_on
2025/12/31 22:17:46 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:17:46 [ReadPump] 消息内容: {"type":"mic_request","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"3af835f6-f73a-45a0-b64e-c621cf744deb"}
2025/12/31 22:17:46 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 22:17:46 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 22:17:46 [ReadPump] 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb, 准备广播给房间内其他成员
2025/12/31 22:17:46 [ReadPump] Data 字段为 nil，已初始化为空 map
2025/12/31 22:17:46 [ReadPump] 已添加 user_id 到 Data: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 22:17:46 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 22:17:46 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:17:46 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:17:46 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:17:46 [ReadPump] 准备调用 broadcastToRoom，房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:46 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=mic_request
2025/12/31 22:17:46 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:46 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:46 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb roomSize=2
2025/12/31 22:17:46 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:17:46 [broadcastToRoom] 📢 向房间 3af835f6-f73a-45a0-b64e-c621cf744deb 的 1 个客户端广播消息类型: mic_request
2025/12/31 22:17:46 [ReadPump] ✅ 连麦申请已广播给房间 3af835f6-f73a-45a0-b64e-c621cf744deb 的其他成员
2025/12/31 22:17:50 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:17:50 [ReadPump] 消息内容: {"type":"mic_approve","target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"3af835f6-f73a-45a0-b64e-c621cf744deb"}
2025/12/31 22:17:50 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2025/12/31 22:17:50 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2025/12/31 22:17:50 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:3af835f6-f73a-45a0-b64e-c621cf744deb UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:<nil> Timestamp:1767190670}
2025/12/31 22:17:50 [ReadPump] message.Data 类型: <nil>, 值: <nil>
2025/12/31 22:17:50 [ReadPump] ⚠️ message.Data 不是 map[string]interface{} 类型，无法解析
2025/12/31 22:21:07 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb): websocket: close 1001 (going away)
2025/12/31 22:21:07 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb, 连接指针: 0x1400044a180
2025/12/31 22:21:07 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:07 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 22:21:07 [Unregister] 房间 3af835f6-f73a-45a0-b64e-c621cf744deb 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2025/12/31 22:21:07 [Unregister] 房间 3af835f6-f73a-45a0-b64e-c621cf744deb 保留（还有 1 个在线成员）
2025/12/31 22:21:07 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=member_update
2025/12/31 22:21:07 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:07 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:07 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb roomSize=1
2025/12/31 22:21:07 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:07 [broadcastToRoom] 📢 向房间 3af835f6-f73a-45a0-b64e-c621cf744deb 的 1 个客户端广播消息类型: member_update
2025/12/31 22:21:07 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2025/12/31 22:21:07 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:21:07 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"3af835f6-f73a-45a0-b64e-c621cf744deb"}
2025/12/31 22:21:07 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:21:07 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=mic_on
2025/12/31 22:21:07 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:07 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:07 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb roomSize=1
2025/12/31 22:21:07 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:07 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:07 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:21:07 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"3af835f6-f73a-45a0-b64e-c621cf744deb"}
2025/12/31 22:21:07 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:21:07 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=mic_on
2025/12/31 22:21:07 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:07 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:07 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb roomSize=1
2025/12/31 22:21:07 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:07 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:08 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x1400048da40
2025/12/31 22:21:08 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x1400048da40
2025/12/31 22:21:08 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 22:21:08 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x1400048da40
2025/12/31 22:21:08 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140001637a0
2025/12/31 22:21:08 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140001637a0
2025/12/31 22:21:08 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 22:21:08 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x1400048da40, 新连接: 0x140001637a0
2025/12/31 22:21:08 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 22:21:08 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x1400048da40
2025/12/31 22:21:08 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2025/12/31 22:21:08 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x140001637a0
2025/12/31 22:21:08 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 22:21:09 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:09 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x140001637a0, 新连接: 0x140000ac660
2025/12/31 22:21:09 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2025/12/31 22:21:09 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=member_update
2025/12/31 22:21:09 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb, 连接指针: 0x140000ac660
2025/12/31 22:21:09 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 3af835f6-f73a-45a0-b64e-c621cf744deb 的消息，连接指针: 0x140000ac660
2025/12/31 22:21:09 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:09 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:09 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb roomSize=2
2025/12/31 22:21:09 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:09 [broadcastToRoom] 📢 向房间 3af835f6-f73a-45a0-b64e-c621cf744deb 的 1 个客户端广播消息类型: member_update
2025/12/31 22:21:10 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:21:10 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"3af835f6-f73a-45a0-b64e-c621cf744deb"}
2025/12/31 22:21:10 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:21:10 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=mic_on
2025/12/31 22:21:10 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:10 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:10 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb roomSize=2
2025/12/31 22:21:10 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:10 [broadcastToRoom] 📢 向房间 3af835f6-f73a-45a0-b64e-c621cf744deb 的 1 个客户端广播消息类型: mic_on
2025/12/31 22:21:10 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:21:10 [ReadPump] 消息内容: {"type":"mic_on","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"3af835f6-f73a-45a0-b64e-c621cf744deb"}
2025/12/31 22:21:10 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:21:10 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=mic_on
2025/12/31 22:21:10 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:10 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:10 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb roomSize=2
2025/12/31 22:21:10 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:10 [broadcastToRoom] 📢 向房间 3af835f6-f73a-45a0-b64e-c621cf744deb 的 1 个客户端广播消息类型: mic_on
2025/12/31 22:21:12 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:21:12 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"3af835f6-f73a-45a0-b64e-c621cf744deb"}}
2025/12/31 22:21:12 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 22:21:12 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 22:21:12 [ReadPump] 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb, 准备广播给房间内其他成员
2025/12/31 22:21:12 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 22:21:12 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:21:12 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:21:12 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:21:12 [ReadPump] 准备调用 broadcastToRoom，房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:12 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=mic_request
2025/12/31 22:21:12 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:12 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:12 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb roomSize=2
2025/12/31 22:21:12 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:12 [broadcastToRoom] 📢 向房间 3af835f6-f73a-45a0-b64e-c621cf744deb 的 1 个客户端广播消息类型: mic_request
2025/12/31 22:21:12 [ReadPump] ✅ 连麦申请已广播给房间 3af835f6-f73a-45a0-b64e-c621cf744deb 的其他成员
2025/12/31 22:21:14 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:21:14 [ReadPump] 消息内容: {"type":"mic_approve","target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"3af835f6-f73a-45a0-b64e-c621cf744deb"}
2025/12/31 22:21:14 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2025/12/31 22:21:14 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2025/12/31 22:21:14 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:3af835f6-f73a-45a0-b64e-c621cf744deb UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:<nil> Timestamp:1767190874}
2025/12/31 22:21:14 [ReadPump] message.Data 类型: <nil>, 值: <nil>
2025/12/31 22:21:14 [ReadPump] ⚠️ message.Data 不是 map[string]interface{} 类型，无法解析
2025/12/31 22:21:23 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb): websocket: close 1005 (no status)
2025/12/31 22:21:23 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb, 连接指针: 0x1400048d5c0
2025/12/31 22:21:23 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:23 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2025/12/31 22:21:23 [Unregister] 房间 3af835f6-f73a-45a0-b64e-c621cf744deb 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2025/12/31 22:21:23 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): Hub 关闭了发送通道
2025/12/31 22:21:23 [Unregister] 房间 3af835f6-f73a-45a0-b64e-c621cf744deb 保留（还有 1 个在线成员）
2025/12/31 22:21:23 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=member_update
2025/12/31 22:21:23 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:23 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:23 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb roomSize=1
2025/12/31 22:21:23 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:23 [broadcastToRoom] 📢 向房间 3af835f6-f73a-45a0-b64e-c621cf744deb 的 1 个客户端广播消息类型: member_update
2025/12/31 22:21:28 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2025/12/31 22:21:28 [broadcastToRoom] ENTER | roomID=global type=room_created
2025/12/31 22:21:28 [broadcastToRoom] 准备获取 RLock | roomID=global
2025/12/31 22:21:28 [broadcastToRoom] 已获取 RLock | roomID=global
2025/12/31 22:21:28 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=global roomSize=4
2025/12/31 22:21:28 [broadcastToRoom] 已释放 RLock，recipients=4 | roomID=global
2025/12/31 22:21:28 [broadcastToRoom] 📢 向房间 global 的 4 个客户端广播消息类型: room_created
2025/12/31 22:21:28 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2025/12/31 22:21:28 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 获取写入器失败: websocket: close sent
2025/12/31 22:21:28 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:28 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=member_update
2025/12/31 22:21:28 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:28 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682, 连接指针: 0x14000281800
2025/12/31 22:21:28 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 673c92a1-608a-43c4-aaf9-7fb04f498682 的消息，连接指针: 0x14000281800
2025/12/31 22:21:28 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:28 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=1
2025/12/31 22:21:28 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:28 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:28 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:21:28 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:28 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:21:28 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=mic_on
2025/12/31 22:21:28 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:28 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:28 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=1
2025/12/31 22:21:28 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:28 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:28 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:21:28 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:28 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:21:28 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=mic_on
2025/12/31 22:21:28 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:28 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:28 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=1
2025/12/31 22:21:28 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:28 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:30 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb): websocket: close 1005 (no status)
2025/12/31 22:21:30 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb, 连接指针: 0x140000ac660
2025/12/31 22:21:30 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:30 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 22:21:30 [Unregister] 房间 3af835f6-f73a-45a0-b64e-c621cf744deb 清理客户端后，剩余成员数: 0, shouldDeleteRoom: true
2025/12/31 22:21:30 [Unregister] 房间 3af835f6-f73a-45a0-b64e-c621cf744deb 已删除（没有在线成员）
2025/12/31 22:21:30 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=member_update
2025/12/31 22:21:30 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:30 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:30 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:30 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2025/12/31 22:21:30 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: 3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:30 [broadcastToRoom] ENTER | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb type=room_deleted
2025/12/31 22:21:30 [broadcastToRoom] 准备获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:30 [broadcastToRoom] 已获取 RLock | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:30 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=3af835f6-f73a-45a0-b64e-c621cf744deb
2025/12/31 22:21:30 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2025/12/31 22:21:32 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:32 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=member_update
2025/12/31 22:21:32 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682, 连接指针: 0x1400051aea0
2025/12/31 22:21:32 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 673c92a1-608a-43c4-aaf9-7fb04f498682 的消息，连接指针: 0x1400051aea0
2025/12/31 22:21:32 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:32 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:32 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=2
2025/12/31 22:21:32 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:32 [broadcastToRoom] 📢 向房间 673c92a1-608a-43c4-aaf9-7fb04f498682 的 1 个客户端广播消息类型: member_update
2025/12/31 22:21:33 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:21:33 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:33 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:21:33 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=mic_on
2025/12/31 22:21:33 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:33 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:33 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=2
2025/12/31 22:21:33 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:33 [broadcastToRoom] 📢 向房间 673c92a1-608a-43c4-aaf9-7fb04f498682 的 1 个客户端广播消息类型: mic_on
2025/12/31 22:21:33 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:21:33 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:33 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:21:33 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=mic_on
2025/12/31 22:21:33 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:33 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:33 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=2
2025/12/31 22:21:33 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:33 [broadcastToRoom] 📢 向房间 673c92a1-608a-43c4-aaf9-7fb04f498682 的 1 个客户端广播消息类型: mic_on
2025/12/31 22:21:34 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:21:34 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:34 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 22:21:34 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 22:21:34 [ReadPump] 房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682, 准备广播给房间内其他成员
2025/12/31 22:21:34 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 22:21:34 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:21:34 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:21:34 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:21:34 [ReadPump] 准备调用 broadcastToRoom，房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:34 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=mic_request
2025/12/31 22:21:34 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:34 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:34 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=2
2025/12/31 22:21:34 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:34 [broadcastToRoom] 📢 向房间 673c92a1-608a-43c4-aaf9-7fb04f498682 的 1 个客户端广播消息类型: mic_request
2025/12/31 22:21:34 [ReadPump] ✅ 连麦申请已广播给房间 673c92a1-608a-43c4-aaf9-7fb04f498682 的其他成员
2025/12/31 22:21:39 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:21:39 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:39 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2025/12/31 22:21:39 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2025/12/31 22:21:39 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:673c92a1-608a-43c4-aaf9-7fb04f498682 UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:map[room_id:673c92a1-608a-43c4-aaf9-7fb04f498682 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa] Timestamp:1767190899}
2025/12/31 22:21:39 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:673c92a1-608a-43c4-aaf9-7fb04f498682 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2025/12/31 22:21:39 [ReadPump] Data 是 map，内容: map[room_id:673c92a1-608a-43c4-aaf9-7fb04f498682 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2025/12/31 22:21:39 [ReadPump] Data 中的所有键: [target_user_id user_id room_id]
2025/12/31 22:21:39 [ReadPump] ✅ 找到 target_user_id: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 22:21:39 [ReadPump] 准备发送 mic_approved 给用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (房间 673c92a1-608a-43c4-aaf9-7fb04f498682)
2025/12/31 22:21:39 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=mic_approved
2025/12/31 22:21:39 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:39 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:39 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=2
2025/12/31 22:21:39 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:39 [broadcastToRoom] 📢 向房间 673c92a1-608a-43c4-aaf9-7fb04f498682 的 1 个客户端广播消息类型: mic_approved
2025/12/31 22:21:39 [ReadPump] ✅ mic_approved 已广播给房间 673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:39 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:21:39 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:39 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_on'
2025/12/31 22:21:39 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=mic_on
2025/12/31 22:21:39 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:39 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:39 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=2
2025/12/31 22:21:39 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:21:39 [broadcastToRoom] 📢 向房间 673c92a1-608a-43c4-aaf9-7fb04f498682 的 1 个客户端广播消息类型: mic_on
2025/12/31 22:21:45 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:21:45 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 3365795890944567988 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS d973a667-40ee-4a0b-9840-b13d3c1972e5\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:O4HQ\r\na=ice-pwd:MPpEnk/UUwETqRcmn/3lj47s\r\na=ice-options:trickle\r\na=fingerprint:sha-256 AE:2A:05:56:6A:BE:96:CE:D3:30:EA:9B:61:DB:54:B7:D6:A6:F1:33:61:D5:3F:BB:2F:C3:69:0D:32:5B:23:41\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:d973a667-40ee-4a0b-9840-b13d3c1972e5 d0158d39-83e3-4c3f-8f7b-8b13ecbfd210\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:316980481 cname:qwbY1G/wrhA+qkkn\r\na=ssrc:316980481 msid:d973a667-40ee-4a0b-9840-b13d3c1972e5 d0158d39-83e3-4c3f-8f7b-8b13ecbfd210\r\n","type":"offer"},"room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:45 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2025/12/31 22:21:45 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:21:45 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 8059414816987134415 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS d973a667-40ee-4a0b-9840-b13d3c1972e5\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:QJJ9\r\na=ice-pwd:ciqPRkH07vbZmQVjgqySaAVY\r\na=ice-options:trickle\r\na=fingerprint:sha-256 F3:10:62:B7:C9:D6:93:A9:AF:34:FB:20:58:B1:F4:2A:EF:A9:72:74:0E:F0:8A:2E:28:E6:DE:EA:DF:DA:36:03\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:d973a667-40ee-4a0b-9840-b13d3c1972e5 d0158d39-83e3-4c3f-8f7b-8b13ecbfd210\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:4102118298 cname:yMAhikkoU4OcZAzz\r\na=ssrc:4102118298 msid:d973a667-40ee-4a0b-9840-b13d3c1972e5 d0158d39-83e3-4c3f-8f7b-8b13ecbfd210\r\n","type":"offer"},"room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:45 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2025/12/31 22:21:46 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:21:46 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3974585637 1 udp 2122194687 192.168.1.5 55303 typ host generation 0 ufrag O4HQ network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"O4HQ"},"room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:46 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:21:46 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:21:46 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1616225858 1 udp 2122262783 2409:8a00:26c8:9760:6c96:8f09:83dc:a0ee 65011 typ host generation 0 ufrag O4HQ network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"O4HQ"},"room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:46 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:21:46 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:21:46 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:48400343 1 udp 2122194687 192.168.1.5 53437 typ host generation 0 ufrag QJJ9 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"QJJ9"},"room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:46 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:21:46 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:21:46 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1667568521 1 udp 2122262783 2409:8a00:26c8:9760:6c96:8f09:83dc:a0ee 61305 typ host generation 0 ufrag QJJ9 network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"QJJ9"},"room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:46 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:21:46 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:21:46 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:307071409 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag O4HQ network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"O4HQ"},"room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:46 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:21:46 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:21:46 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2667541206 1 tcp 1518283007 2409:8a00:26c8:9760:6c96:8f09:83dc:a0ee 9 typ host tcptype active generation 0 ufrag O4HQ network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"O4HQ"},"room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:46 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:21:46 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:21:46 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2083349839 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag QJJ9 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"QJJ9"},"room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:46 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:21:46 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:21:46 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:497742097 1 tcp 1518283007 2409:8a00:26c8:9760:6c96:8f09:83dc:a0ee 9 typ host tcptype active generation 0 ufrag QJJ9 network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"QJJ9"},"room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:46 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:21:46 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:21:46 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2887593868 1 udp 1685987071 117.129.35.233 22335 typ srflx raddr 192.168.1.5 rport 55303 generation 0 ufrag O4HQ network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"O4HQ"},"room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:46 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:21:46 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:21:46 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:664487997 1 udp 1685987071 117.129.35.233 22336 typ srflx raddr 192.168.1.5 rport 53437 generation 0 ufrag QJJ9 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"QJJ9"},"room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:21:46 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:32:51 [Register] 新客户端注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2025/12/31 22:32:51 [Register] ✅ 全局连接已成功注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 当前全局在线用户数: 1, 连接指针: 0x1400051a5a0
2025/12/31 22:32:51 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x1400051a5a0
2025/12/31 22:32:51 [ReadPump] ✅ 开始监听用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 在房间 global 的消息，连接指针: 0x1400051a5a0
2025/12/31 22:32:54 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global): websocket: close 1005 (no status)
2025/12/31 22:32:54 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x1400051a5a0
2025/12/31 22:32:54 [Unregister] 客户端注销 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2025/12/31 22:32:54 [Unregister] 已从 GlobalClients 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左)
2025/12/31 22:32:54 [Unregister] 已从 GlobalByUserID 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左)
2025/12/31 22:32:58 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x1400048d380
2025/12/31 22:32:58 [Register] 新客户端注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2025/12/31 22:32:58 [Register] ✅ 全局连接已成功注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 当前全局在线用户数: 1, 连接指针: 0x1400048d380
2025/12/31 22:32:58 [ReadPump] ✅ 开始监听用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 在房间 global 的消息，连接指针: 0x1400048d380
2025/12/31 22:33:45 [WritePump] 用户 1ec34531-4001-46b1-b896-0a26b932553a (小左): 发送 ping 消息失败: websocket: close sent
2025/12/31 22:38:34 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x14000280240
2025/12/31 22:38:34 [ReadPump] ✅ 开始监听用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 在房间 global 的消息，连接指针: 0x14000280240
2025/12/31 22:38:34 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global): websocket: close 1001 (going away): WebSocket is closed before the connection is established.
2025/12/31 22:38:34 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x14000280240
2025/12/31 22:38:34 [Register] 新客户端注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2025/12/31 22:38:34 [Register] ✅ 全局连接已成功注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 当前全局在线用户数: 1, 连接指针: 0x14000280240
2025/12/31 22:38:34 [Unregister] 客户端注销 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2025/12/31 22:38:34 [Unregister] 已从 GlobalClients 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左)
2025/12/31 22:38:34 [Unregister] 已从 GlobalByUserID 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左)
2025/12/31 22:38:34 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x140001001e0
2025/12/31 22:38:34 [ReadPump] ✅ 开始监听用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 在房间 global 的消息，连接指针: 0x140001001e0
2025/12/31 22:38:34 [Register] 新客户端注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2025/12/31 22:38:34 [Register] ✅ 全局连接已成功注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 当前全局在线用户数: 1, 连接指针: 0x140001001e0
2025/12/31 22:38:37 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 22:38:37 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x140001001e0
2025/12/31 22:38:37 [Unregister] 客户端注销 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2025/12/31 22:38:37 [Unregister] 已从 GlobalClients 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左)
2025/12/31 22:38:37 [Unregister] 已从 GlobalByUserID 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左)
2025/12/31 22:38:39 [Register] 新客户端注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2025/12/31 22:38:39 [Register] ✅ 全局连接已成功注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 当前全局在线用户数: 1, 连接指针: 0x14000280ba0
2025/12/31 22:38:39 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x14000280ba0
2025/12/31 22:38:39 [ReadPump] ✅ 开始监听用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 在房间 global 的消息，连接指针: 0x14000280ba0
2025/12/31 22:38:39 [Register] 新客户端注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2025/12/31 22:38:39 [Register] 检测到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的旧连接，准备替换 - 旧连接: 0x14000280ba0, 新连接: 0x14000590480
2025/12/31 22:38:39 [Register] 已从 GlobalClients 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的旧连接
2025/12/31 22:38:39 [Register] ✅ 全局连接已成功注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 当前全局在线用户数: 1, 连接指针: 0x14000590480
2025/12/31 22:38:39 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x14000590480
2025/12/31 22:38:39 [ReadPump] ✅ 开始监听用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 在房间 global 的消息，连接指针: 0x14000590480
2025/12/31 22:38:39 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global): websocket: close 1001 (going away): WebSocket is closed before the connection is established.
2025/12/31 22:38:39 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x14000590480
2025/12/31 22:38:39 [Unregister] 客户端注销 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2025/12/31 22:38:39 [Unregister] 已从 GlobalClients 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左)
2025/12/31 22:38:39 [Unregister] 已从 GlobalByUserID 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左)
2025/12/31 22:39:28 [WritePump] 用户 1ec34531-4001-46b1-b896-0a26b932553a (小左): 发送 ping 消息失败: websocket: close sent
2025/12/31 22:39:28 [WritePump] 用户 1ec34531-4001-46b1-b896-0a26b932553a (小左): 发送 ping 消息失败: websocket: close sent
2025/12/31 22:39:33 [WritePump] 用户 1ec34531-4001-46b1-b896-0a26b932553a (小左): 发送 ping 消息失败: websocket: close sent
2025/12/31 22:40:58 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x140000a87e0
2025/12/31 22:40:58 [ReadPump] ✅ 开始监听用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 在房间 global 的消息，连接指针: 0x140000a87e0
2025/12/31 22:40:58 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global): websocket: close 1001 (going away): WebSocket is closed before the connection is established.
2025/12/31 22:40:58 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x140000a87e0
2025/12/31 22:40:58 [Register] 新客户端注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2025/12/31 22:40:58 [Register] ✅ 全局连接已成功注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 当前全局在线用户数: 1, 连接指针: 0x140000a87e0
2025/12/31 22:40:58 [Unregister] 客户端注销 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2025/12/31 22:40:58 [Unregister] 已从 GlobalClients 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左)
2025/12/31 22:40:58 [Unregister] 已从 GlobalByUserID 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左)
2025/12/31 22:40:58 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x14000240cc0
2025/12/31 22:40:58 [ReadPump] ✅ 开始监听用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 在房间 global 的消息，连接指针: 0x14000240cc0
2025/12/31 22:40:58 [Register] 新客户端注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2025/12/31 22:40:58 [Register] ✅ 全局连接已成功注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 当前全局在线用户数: 1, 连接指针: 0x14000240cc0
2025/12/31 22:41:11 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2025/12/31 22:41:11 [broadcastToRoom] ENTER | roomID=global type=room_created
2025/12/31 22:41:11 [broadcastToRoom] 准备获取 RLock | roomID=global
2025/12/31 22:41:11 [broadcastToRoom] 已获取 RLock | roomID=global
2025/12/31 22:41:11 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=global roomSize=2
2025/12/31 22:41:11 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=global
2025/12/31 22:41:11 [broadcastToRoom] 📢 向房间 global 的 2 个客户端广播消息类型: room_created
2025/12/31 22:41:11 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2025/12/31 22:41:11 [WritePump] 用户 1ec34531-4001-46b1-b896-0a26b932553a (小左): 获取写入器失败: websocket: close sent
2025/12/31 22:41:11 [Register] 新客户端注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:41:11 [Register] 检测到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的旧连接，准备替换 - 旧连接: 0x14000240cc0, 新连接: 0x1400040e660
2025/12/31 22:41:11 [Register] 已从 GlobalClients 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的旧连接
2025/12/31 22:41:11 [broadcastToRoom] ENTER | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 type=member_update
2025/12/31 22:41:11 [broadcastToRoom] 准备获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:41:11 [broadcastToRoom] 已获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:41:11 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 roomSize=1
2025/12/31 22:41:11 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:41:11 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:41:11 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136, 连接指针: 0x1400040e660
2025/12/31 22:41:11 [ReadPump] ✅ 开始监听用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 在房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的消息，连接指针: 0x1400040e660
2025/12/31 22:41:36 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682, 连接指针: 0x1400040e4e0
2025/12/31 22:41:36 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 673c92a1-608a-43c4-aaf9-7fb04f498682 的消息，连接指针: 0x1400040e4e0
2025/12/31 22:41:36 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:36 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=member_update
2025/12/31 22:41:36 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:36 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:36 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=1
2025/12/31 22:41:36 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:36 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:37 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:41:37 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:41:37 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:41:37 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=mic_on
2025/12/31 22:41:37 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:37 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:37 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=1
2025/12/31 22:41:37 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:37 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:37 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:41:37 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:41:37 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:41:37 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=mic_on
2025/12/31 22:41:37 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:37 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:37 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=1
2025/12/31 22:41:37 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:37 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:42 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:42 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=member_update
2025/12/31 22:41:42 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:42 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:42 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=2
2025/12/31 22:41:42 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:42 [broadcastToRoom] 📢 向房间 673c92a1-608a-43c4-aaf9-7fb04f498682 的 1 个客户端广播消息类型: member_update
2025/12/31 22:41:42 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682, 连接指针: 0x14000100780
2025/12/31 22:41:42 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 673c92a1-608a-43c4-aaf9-7fb04f498682 的消息，连接指针: 0x14000100780
2025/12/31 22:41:43 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:41:43 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:41:43 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:41:43 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=mic_on
2025/12/31 22:41:43 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:43 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:43 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=2
2025/12/31 22:41:43 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:43 [broadcastToRoom] 📢 向房间 673c92a1-608a-43c4-aaf9-7fb04f498682 的 1 个客户端广播消息类型: mic_on
2025/12/31 22:41:43 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:41:43 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:41:43 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:41:43 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=mic_on
2025/12/31 22:41:43 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:43 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:43 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=2
2025/12/31 22:41:43 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:43 [broadcastToRoom] 📢 向房间 673c92a1-608a-43c4-aaf9-7fb04f498682 的 1 个客户端广播消息类型: mic_on
2025/12/31 22:41:50 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682): websocket: close 1005 (no status)
2025/12/31 22:41:50 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682, 连接指针: 0x14000100780
2025/12/31 22:41:50 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:50 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2025/12/31 22:41:50 [Unregister] 房间 673c92a1-608a-43c4-aaf9-7fb04f498682 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2025/12/31 22:41:50 [Unregister] 房间 673c92a1-608a-43c4-aaf9-7fb04f498682 保留（还有 1 个在线成员）
2025/12/31 22:41:50 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=member_update
2025/12/31 22:41:50 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:50 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:50 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=1
2025/12/31 22:41:50 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:50 [broadcastToRoom] 📢 向房间 673c92a1-608a-43c4-aaf9-7fb04f498682 的 1 个客户端广播消息类型: member_update
2025/12/31 22:41:50 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2025/12/31 22:41:51 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:41:51 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:41:51 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:41:51 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=mic_on
2025/12/31 22:41:51 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:51 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:51 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=1
2025/12/31 22:41:51 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:51 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:51 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:41:51 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"673c92a1-608a-43c4-aaf9-7fb04f498682"}}
2025/12/31 22:41:51 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:41:51 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=mic_on
2025/12/31 22:41:51 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:51 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:51 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 roomSize=1
2025/12/31 22:41:51 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:51 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:41:56 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000100ba0
2025/12/31 22:41:56 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000100ba0
2025/12/31 22:41:56 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 22:41:56 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x14000100ba0
2025/12/31 22:41:56 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 22:41:56 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x14000100ba0, 新连接: 0x140001017a0
2025/12/31 22:41:56 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2025/12/31 22:41:56 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140001017a0
2025/12/31 22:41:56 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x140001017a0
2025/12/31 22:41:56 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140001017a0
2025/12/31 22:41:56 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 22:41:56 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000100ba0
2025/12/31 22:41:56 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2025/12/31 22:41:58 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136, 连接指针: 0x140004890e0
2025/12/31 22:41:58 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的消息，连接指针: 0x140004890e0
2025/12/31 22:41:58 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:41:58 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x140001017a0, 新连接: 0x140004890e0
2025/12/31 22:41:58 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2025/12/31 22:41:58 [broadcastToRoom] ENTER | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 type=member_update
2025/12/31 22:41:58 [broadcastToRoom] 准备获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:41:58 [broadcastToRoom] 已获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:41:58 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 roomSize=2
2025/12/31 22:41:58 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:41:58 [broadcastToRoom] 📢 向房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的 1 个客户端广播消息类型: member_update
2025/12/31 22:42:00 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:42:00 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:42:00 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2025/12/31 22:42:00 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2025/12/31 22:42:00 [ReadPump] 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136, 准备广播给房间内其他成员
2025/12/31 22:42:00 [ReadPump] 已添加 username 到 Data: 小东
2025/12/31 22:42:00 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:42:00 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:42:00 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2025/12/31 22:42:00 [ReadPump] 准备调用 broadcastToRoom，房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:00 [broadcastToRoom] ENTER | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 type=mic_request
2025/12/31 22:42:00 [broadcastToRoom] 准备获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:00 [broadcastToRoom] 已获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:00 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 roomSize=2
2025/12/31 22:42:00 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:00 [broadcastToRoom] 📢 向房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的 1 个客户端广播消息类型: mic_request
2025/12/31 22:42:00 [ReadPump] ✅ 连麦申请已广播给房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的其他成员
2025/12/31 22:42:12 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2025/12/31 22:42:12 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:42:12 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'mic_approve'
2025/12/31 22:42:12 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的 mic_approve 消息 ==========
2025/12/31 22:42:12 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:e7987f55-1eac-43c1-9aa3-a95f4874f136 UserID:1ec34531-4001-46b1-b896-0a26b932553a Username:小左 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小左 Content: Data:map[room_id:e7987f55-1eac-43c1-9aa3-a95f4874f136 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa] Timestamp:1767192132}
2025/12/31 22:42:12 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:e7987f55-1eac-43c1-9aa3-a95f4874f136 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2025/12/31 22:42:12 [ReadPump] Data 是 map，内容: map[room_id:e7987f55-1eac-43c1-9aa3-a95f4874f136 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2025/12/31 22:42:12 [ReadPump] Data 中的所有键: [target_user_id user_id room_id]
2025/12/31 22:42:12 [ReadPump] ✅ 找到 target_user_id: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2025/12/31 22:42:12 [ReadPump] 准备发送 mic_approved 给用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (房间 e7987f55-1eac-43c1-9aa3-a95f4874f136)
2025/12/31 22:42:12 [broadcastToRoom] ENTER | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 type=mic_approved
2025/12/31 22:42:12 [broadcastToRoom] 准备获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:12 [broadcastToRoom] 已获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:12 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 roomSize=2
2025/12/31 22:42:12 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:12 [broadcastToRoom] 📢 向房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的 1 个客户端广播消息类型: mic_approved
2025/12/31 22:42:12 [ReadPump] ✅ mic_approved 已广播给房间 e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:13 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:42:13 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:42:13 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_on'
2025/12/31 22:42:13 [broadcastToRoom] ENTER | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 type=mic_on
2025/12/31 22:42:13 [broadcastToRoom] 准备获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:13 [broadcastToRoom] 已获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:13 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 roomSize=2
2025/12/31 22:42:13 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:13 [broadcastToRoom] 📢 向房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的 1 个客户端广播消息类型: mic_on
2025/12/31 22:42:19 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682): websocket: close 1005 (no status)
2025/12/31 22:42:19 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682, 连接指针: 0x1400040e4e0
2025/12/31 22:42:19 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:42:19 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2025/12/31 22:42:19 [Unregister] 房间 673c92a1-608a-43c4-aaf9-7fb04f498682 清理客户端后，剩余成员数: 0, shouldDeleteRoom: true
2025/12/31 22:42:19 [Unregister] 房间 673c92a1-608a-43c4-aaf9-7fb04f498682 已删除（没有在线成员）
2025/12/31 22:42:19 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=member_update
2025/12/31 22:42:19 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:42:19 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:42:19 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:42:19 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): Hub 关闭了发送通道
2025/12/31 22:42:19 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 获取写入器失败: websocket: close sent
2025/12/31 22:42:19 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: 673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:42:19 [broadcastToRoom] ENTER | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682 type=room_deleted
2025/12/31 22:42:19 [broadcastToRoom] 准备获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:42:19 [broadcastToRoom] 已获取 RLock | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:42:19 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=673c92a1-608a-43c4-aaf9-7fb04f498682
2025/12/31 22:42:19 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2025/12/31 22:42:21 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:21 [broadcastToRoom] ENTER | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 type=member_update
2025/12/31 22:42:21 [broadcastToRoom] 准备获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:21 [broadcastToRoom] 已获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:21 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 roomSize=3
2025/12/31 22:42:21 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:21 [broadcastToRoom] 📢 向房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的 2 个客户端广播消息类型: member_update
2025/12/31 22:42:21 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136, 连接指针: 0x140005a9c20
2025/12/31 22:42:21 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的消息，连接指针: 0x140005a9c20
2025/12/31 22:42:25 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:42:25 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:42:25 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_request'
2025/12/31 22:42:25 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的连麦申请 ==========
2025/12/31 22:42:25 [ReadPump] 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136, 准备广播给房间内其他成员
2025/12/31 22:42:25 [ReadPump] 已添加 username 到 Data: 小北
2025/12/31 22:42:25 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小北
2025/12/31 22:42:25 [ReadPump] Data 字段内容: user_id=1b7b6081-9139-4e57-b16e-7f0885ae5e43, username=小北, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小北
2025/12/31 22:42:25 [ReadPump] 消息顶层字段: UserID=1b7b6081-9139-4e57-b16e-7f0885ae5e43, Username=小北, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小北
2025/12/31 22:42:25 [ReadPump] 准备调用 broadcastToRoom，房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:25 [broadcastToRoom] ENTER | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 type=mic_request
2025/12/31 22:42:25 [broadcastToRoom] 准备获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:25 [broadcastToRoom] 已获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:25 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 roomSize=3
2025/12/31 22:42:25 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:25 [broadcastToRoom] 📢 向房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的 2 个客户端广播消息类型: mic_request
2025/12/31 22:42:25 [ReadPump] ✅ 连麦申请已广播给房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的其他成员
2025/12/31 22:42:31 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2025/12/31 22:42:31 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:42:31 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'mic_approve'
2025/12/31 22:42:31 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的 mic_approve 消息 ==========
2025/12/31 22:42:31 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:e7987f55-1eac-43c1-9aa3-a95f4874f136 UserID:1ec34531-4001-46b1-b896-0a26b932553a Username:小左 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小左 Content: Data:map[room_id:e7987f55-1eac-43c1-9aa3-a95f4874f136 target_user_id:1b7b6081-9139-4e57-b16e-7f0885ae5e43 user_id:1b7b6081-9139-4e57-b16e-7f0885ae5e43] Timestamp:1767192151}
2025/12/31 22:42:31 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:e7987f55-1eac-43c1-9aa3-a95f4874f136 target_user_id:1b7b6081-9139-4e57-b16e-7f0885ae5e43 user_id:1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2025/12/31 22:42:31 [ReadPump] Data 是 map，内容: map[room_id:e7987f55-1eac-43c1-9aa3-a95f4874f136 target_user_id:1b7b6081-9139-4e57-b16e-7f0885ae5e43 user_id:1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2025/12/31 22:42:31 [ReadPump] Data 中的所有键: [target_user_id user_id room_id]
2025/12/31 22:42:31 [ReadPump] ✅ 找到 target_user_id: 1b7b6081-9139-4e57-b16e-7f0885ae5e43
2025/12/31 22:42:31 [ReadPump] 准备发送 mic_approved 给用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (房间 e7987f55-1eac-43c1-9aa3-a95f4874f136)
2025/12/31 22:42:31 [broadcastToRoom] ENTER | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 type=mic_approved
2025/12/31 22:42:31 [broadcastToRoom] 准备获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:31 [broadcastToRoom] 已获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:31 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 roomSize=3
2025/12/31 22:42:31 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:31 [broadcastToRoom] 📢 向房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的 2 个客户端广播消息类型: mic_approved
2025/12/31 22:42:31 [ReadPump] ✅ mic_approved 已广播给房间 e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:31 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:42:31 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 1851800109315318664 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 84ea158a-43a0-47c5-ba35-b9973437b98b\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:63PN\r\na=ice-pwd:rO1jqC8+GozRTCoHVNbKEwss\r\na=ice-options:trickle\r\na=fingerprint:sha-256 35:3C:F9:FB:FA:81:CE:0C:90:24:07:3A:C0:F4:7B:FD:94:04:36:76:00:1A:FF:D5:71:2F:A8:A3:D5:BF:7E:B4\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:84ea158a-43a0-47c5-ba35-b9973437b98b 4b612328-86a7-4217-9f19-920e7e56ded3\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:869981262 cname:4nRIR1WroGijEjHQ\r\na=ssrc:869981262 msid:84ea158a-43a0-47c5-ba35-b9973437b98b 4b612328-86a7-4217-9f19-920e7e56ded3\r\n","type":"offer"},"room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:42:31 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2025/12/31 22:42:31 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:42:31 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1348799063 1 udp 2122194687 192.168.1.5 60699 typ host generation 0 ufrag 63PN network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"63PN"},"room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:42:31 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:42:31 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:42:31 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:836935177 1 udp 2122262783 2409:8a00:26c8:9760:6c96:8f09:83dc:a0ee 56700 typ host generation 0 ufrag 63PN network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"63PN"},"room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:42:31 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:42:31 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:42:31 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:782952655 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag 63PN network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"63PN"},"room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:42:31 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:42:31 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:42:31 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1328381073 1 tcp 1518283007 2409:8a00:26c8:9760:6c96:8f09:83dc:a0ee 9 typ host tcptype active generation 0 ufrag 63PN network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"63PN"},"room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:42:31 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:42:31 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:42:31 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1964819901 1 udp 1685987071 117.129.35.233 22018 typ srflx raddr 192.168.1.5 rport 60699 generation 0 ufrag 63PN network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"63PN"},"room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:42:31 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:42:32 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:42:32 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:42:32 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:42:32 [broadcastToRoom] ENTER | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 type=mic_on
2025/12/31 22:42:32 [broadcastToRoom] 准备获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:32 [broadcastToRoom] 已获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:32 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 roomSize=3
2025/12/31 22:42:32 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:42:32 [broadcastToRoom] 📢 向房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的 2 个客户端广播消息类型: mic_on
2025/12/31 22:43:57 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136): websocket: close 1001 (going away)
2025/12/31 22:43:57 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136, 连接指针: 0x140005a9c20
2025/12/31 22:43:57 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:43:57 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2025/12/31 22:43:57 [Unregister] 房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 清理客户端后，剩余成员数: 2, shouldDeleteRoom: false
2025/12/31 22:43:57 [Unregister] 房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 保留（还有 2 个在线成员）
2025/12/31 22:43:57 [broadcastToRoom] ENTER | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 type=member_update
2025/12/31 22:43:57 [broadcastToRoom] 准备获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:43:57 [broadcastToRoom] 已获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:43:57 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 roomSize=2
2025/12/31 22:43:57 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:43:57 [broadcastToRoom] 📢 向房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的 2 个客户端广播消息类型: member_update
2025/12/31 22:43:57 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): Hub 关闭了发送通道
2025/12/31 22:43:59 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000a81e0
2025/12/31 22:43:59 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000a81e0
2025/12/31 22:43:59 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 22:43:59 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000a81e0
2025/12/31 22:43:59 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000241860
2025/12/31 22:43:59 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 22:43:59 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140000a81e0, 新连接: 0x14000241860
2025/12/31 22:43:59 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000241860
2025/12/31 22:43:59 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 22:43:59 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000241860
2025/12/31 22:43:59 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 22:43:59 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000a81e0
2025/12/31 22:43:59 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 22:44:00 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:44:00 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x14000241860, 新连接: 0x1400040e780
2025/12/31 22:44:00 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 22:44:00 [broadcastToRoom] ENTER | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 type=member_update
2025/12/31 22:44:00 [broadcastToRoom] 准备获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:44:00 [broadcastToRoom] 已获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:44:00 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 roomSize=3
2025/12/31 22:44:00 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:44:00 [broadcastToRoom] 📢 向房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的 2 个客户端广播消息类型: member_update
2025/12/31 22:44:00 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136, 连接指针: 0x1400040e780
2025/12/31 22:44:00 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的消息，连接指针: 0x1400040e780
2025/12/31 22:44:02 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:44:02 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:44:02 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_request'
2025/12/31 22:44:02 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的连麦申请 ==========
2025/12/31 22:44:02 [ReadPump] 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136, 准备广播给房间内其他成员
2025/12/31 22:44:02 [ReadPump] 已添加 username 到 Data: 小北
2025/12/31 22:44:02 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小北
2025/12/31 22:44:02 [ReadPump] Data 字段内容: user_id=1b7b6081-9139-4e57-b16e-7f0885ae5e43, username=小北, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小北
2025/12/31 22:44:02 [ReadPump] 消息顶层字段: UserID=1b7b6081-9139-4e57-b16e-7f0885ae5e43, Username=小北, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小北
2025/12/31 22:44:02 [ReadPump] 准备调用 broadcastToRoom，房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:44:02 [broadcastToRoom] ENTER | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 type=mic_request
2025/12/31 22:44:02 [broadcastToRoom] 准备获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:44:02 [broadcastToRoom] 已获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:44:02 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 roomSize=3
2025/12/31 22:44:02 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:44:02 [broadcastToRoom] 📢 向房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的 2 个客户端广播消息类型: mic_request
2025/12/31 22:44:02 [ReadPump] ✅ 连麦申请已广播给房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的其他成员
2025/12/31 22:44:11 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2025/12/31 22:44:11 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:44:11 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'mic_approve'
2025/12/31 22:44:11 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的 mic_approve 消息 ==========
2025/12/31 22:44:11 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:e7987f55-1eac-43c1-9aa3-a95f4874f136 UserID:1ec34531-4001-46b1-b896-0a26b932553a Username:小左 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小左 Content: Data:map[room_id:e7987f55-1eac-43c1-9aa3-a95f4874f136 target_user_id:1b7b6081-9139-4e57-b16e-7f0885ae5e43 user_id:1b7b6081-9139-4e57-b16e-7f0885ae5e43] Timestamp:1767192251}
2025/12/31 22:44:11 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:e7987f55-1eac-43c1-9aa3-a95f4874f136 target_user_id:1b7b6081-9139-4e57-b16e-7f0885ae5e43 user_id:1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2025/12/31 22:44:11 [ReadPump] Data 是 map，内容: map[room_id:e7987f55-1eac-43c1-9aa3-a95f4874f136 target_user_id:1b7b6081-9139-4e57-b16e-7f0885ae5e43 user_id:1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2025/12/31 22:44:11 [ReadPump] Data 中的所有键: [target_user_id user_id room_id]
2025/12/31 22:44:11 [ReadPump] ✅ 找到 target_user_id: 1b7b6081-9139-4e57-b16e-7f0885ae5e43
2025/12/31 22:44:11 [ReadPump] 准备发送 mic_approved 给用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (房间 e7987f55-1eac-43c1-9aa3-a95f4874f136)
2025/12/31 22:44:11 [broadcastToRoom] ENTER | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 type=mic_approved
2025/12/31 22:44:11 [broadcastToRoom] 准备获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:44:11 [broadcastToRoom] 已获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:44:11 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 roomSize=3
2025/12/31 22:44:11 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:44:11 [broadcastToRoom] 📢 向房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的 2 个客户端广播消息类型: mic_approved
2025/12/31 22:44:11 [ReadPump] ✅ mic_approved 已广播给房间 e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:44:11 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:44:11 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 412660039461977866 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 84ea158a-43a0-47c5-ba35-b9973437b98b\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:B7sC\r\na=ice-pwd:UA8gCcLU2JvuXHxv+5rMm7+b\r\na=ice-options:trickle\r\na=fingerprint:sha-256 BD:34:45:83:3C:59:1A:20:81:50:FD:17:05:1A:AD:F4:8B:A0:CB:99:F5:E0:67:0E:45:56:DD:42:9C:47:94:B4\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:84ea158a-43a0-47c5-ba35-b9973437b98b 4b612328-86a7-4217-9f19-920e7e56ded3\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:573199067 cname:wX6BlT7s57C2lb0+\r\na=ssrc:573199067 msid:84ea158a-43a0-47c5-ba35-b9973437b98b 4b612328-86a7-4217-9f19-920e7e56ded3\r\n","type":"offer"},"room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:44:11 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2025/12/31 22:44:11 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:44:11 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:4198891036 1 udp 2122194687 192.168.1.5 60576 typ host generation 0 ufrag B7sC network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"B7sC"},"room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:44:11 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:44:11 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:44:11 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2613209666 1 udp 2122262783 2409:8a00:26c8:9760:6c96:8f09:83dc:a0ee 53858 typ host generation 0 ufrag B7sC network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"B7sC"},"room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:44:11 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:44:11 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:44:11 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2223643780 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag B7sC network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"B7sC"},"room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:44:11 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:44:11 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:44:11 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3842869466 1 tcp 1518283007 2409:8a00:26c8:9760:6c96:8f09:83dc:a0ee 9 typ host tcptype active generation 0 ufrag B7sC network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"B7sC"},"room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:44:11 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:44:11 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2025/12/31 22:44:11 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3745264118 1 udp 1685987071 117.129.35.233 22360 typ srflx raddr 192.168.1.5 rport 60576 generation 0 ufrag B7sC network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"B7sC"},"room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:44:11 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2025/12/31 22:44:12 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:44:12 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"e7987f55-1eac-43c1-9aa3-a95f4874f136"}}
2025/12/31 22:44:12 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2025/12/31 22:44:12 [broadcastToRoom] ENTER | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 type=mic_on
2025/12/31 22:44:12 [broadcastToRoom] 准备获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:44:12 [broadcastToRoom] 已获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:44:12 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 roomSize=3
2025/12/31 22:44:12 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:44:12 [broadcastToRoom] 📢 向房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的 2 个客户端广播消息类型: mic_on
2025/12/31 22:44:53 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2025/12/31 22:46:06 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136): websocket: close 1005 (no status)
2025/12/31 22:46:06 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136, 连接指针: 0x1400040e780
2025/12/31 22:46:06 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:46:06 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2025/12/31 22:46:06 [Unregister] 房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 清理客户端后，剩余成员数: 2, shouldDeleteRoom: false
2025/12/31 22:46:06 [Unregister] 房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 保留（还有 2 个在线成员）
2025/12/31 22:46:06 [broadcastToRoom] ENTER | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 type=member_update
2025/12/31 22:46:06 [broadcastToRoom] 准备获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:46:06 [broadcastToRoom] 已获取 RLock | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:46:06 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136 roomSize=2
2025/12/31 22:46:06 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=e7987f55-1eac-43c1-9aa3-a95f4874f136
2025/12/31 22:46:06 [broadcastToRoom] 📢 向房间 e7987f55-1eac-43c1-9aa3-a95f4874f136 的 2 个客户端广播消息类型: member_update
2025/12/31 22:46:06 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): Hub 关闭了发送通道
2025/12/31 22:46:07 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005445a0
2025/12/31 22:46:07 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 22:46:07 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005445a0
2025/12/31 22:46:07 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005445a0
2025/12/31 22:46:07 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000544a80
2025/12/31 22:46:07 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000544a80
2025/12/31 22:46:07 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 22:46:07 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140005445a0, 新连接: 0x14000544a80
2025/12/31 22:46:07 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 22:46:07 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000544a80
2025/12/31 22:46:07 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 22:46:07 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005445a0
2025/12/31 22:46:07 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 22:46:08 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 22:46:08 [ReadPump] 消息内容: {"type":"1v1_match_request","data":{}}
2025/12/31 22:46:08 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 '1v1_match_request'
2025/12/31 22:46:08 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 22:46:08 [ReadPump] ✅ 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 22:46:08 收到匹配请求，用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 等待队列长度: 0, global在线数(去重): 3
2025/12/31 22:46:17 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136): websocket: close 1005 (no status)
2025/12/31 22:46:17 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136, 连接指针: 0x1400040e660
2025/12/31 22:46:19 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x14000488ea0
2025/12/31 22:46:19 [ReadPump] ✅ 开始监听用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 在房间 global 的消息，连接指针: 0x14000488ea0
2025/12/31 22:46:19 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global): websocket: close 1001 (going away): WebSocket is closed before the connection is established.
2025/12/31 22:46:19 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x14000488ea0
2025/12/31 22:46:26 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136): websocket: close 1005 (no status)
2025/12/31 22:46:26 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: e7987f55-1eac-43c1-9aa3-a95f4874f136, 连接指针: 0x140004890e0
2025/12/31 22:46:28 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2025/12/31 22:46:35 [WritePump] 用户 1ec34531-4001-46b1-b896-0a26b932553a (小左): 发送 ping 消息失败: websocket: close sent
2025/12/31 22:47:01 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2025/12/31 22:47:13 [WritePump] 用户 1ec34531-4001-46b1-b896-0a26b932553a (小左): 发送 ping 消息失败: websocket: close sent
2025/12/31 22:48:18 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 22:48:18 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x14000240cc0
2025/12/31 23:44:01 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 23:44:01 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000100540
2025/12/31 23:44:01 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000100540
2025/12/31 23:44:01 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000100540
2025/12/31 23:44:01 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007cba0
2025/12/31 23:44:01 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400007cba0
2025/12/31 23:44:01 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 23:44:01 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x14000100540, 新连接: 0x1400007cba0
2025/12/31 23:44:01 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 23:44:01 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400007cba0
2025/12/31 23:44:01 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 23:44:01 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000100540
2025/12/31 23:44:01 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 23:44:33 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 23:44:33 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x1400007cba0, 新连接: 0x1400007cde0
2025/12/31 23:44:33 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2025/12/31 23:44:33 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400007cde0
2025/12/31 23:44:33 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007cde0
2025/12/31 23:44:33 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400007cde0
2025/12/31 23:44:33 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2025/12/31 23:44:33 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007cde0
2025/12/31 23:44:33 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 23:44:33 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2025/12/31 23:44:33 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2025/12/31 23:44:33 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007d1a0
2025/12/31 23:44:33 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400007d1a0
2025/12/31 23:44:33 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2025/12/31 23:44:33 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400007d1a0
2025/12/31 23:44:34 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2025/12/31 23:44:34 [ReadPump] 消息内容: {"type":"1v1_match_request","data":{}}
2025/12/31 23:44:34 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 '1v1_match_request'
2025/12/31 23:44:34 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 1v1 匹配请求，准备加入匹配队列
2025/12/31 23:44:34 [ReadPump] ✅ 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的匹配请求来自最新连接，发送到匹配队列
2025/12/31 23:44:34 收到匹配请求，用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 等待队列长度: 0, global在线数(去重): 1
2025/12/31 23:44:36 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2025/12/31 23:44:36 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007d1a0
2025/12/31 23:44:47 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2025/12/31 23:44:47 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007cba0
2025/12/31 23:44:55 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2025/12/31 23:44:55 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2025/12/31 23:45:27 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2025/12/31 23:45:27 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/01 05:56:09 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000374c00
2026/01/01 05:56:09 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000374c00
2026/01/01 05:56:09 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/01 05:56:09 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x14000374c00
2026/01/01 05:56:09 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2026/01/01 05:56:09 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000374c00
2026/01/01 05:56:09 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/01 05:56:09 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/01 05:56:09 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/01 05:56:09 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000510480
2026/01/01 05:56:09 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000510480
2026/01/01 05:56:09 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/01 05:56:09 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x14000510480
2026/01/01 05:56:11 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 3cb1e4f8-bde6-4685-86cd-365a25be1fdb, 连接指针: 0x14000374ae0
2026/01/01 05:56:11 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 3cb1e4f8-bde6-4685-86cd-365a25be1fdb 的消息，连接指针: 0x14000374ae0
2026/01/01 05:56:11 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:56:11 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x14000510480, 新连接: 0x14000374ae0
2026/01/01 05:56:11 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2026/01/01 05:56:11 [broadcastToRoom] ENTER | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb type=member_update
2026/01/01 05:56:11 [broadcastToRoom] 准备获取 RLock | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:56:11 [broadcastToRoom] 已获取 RLock | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:56:11 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb roomSize=1
2026/01/01 05:56:11 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:56:11 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:56:14 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 05:56:14 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"3cb1e4f8-bde6-4685-86cd-365a25be1fdb"}}
2026/01/01 05:56:14 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2026/01/01 05:56:14 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2026/01/01 05:56:14 [ReadPump] 房间ID: 3cb1e4f8-bde6-4685-86cd-365a25be1fdb, 准备广播给房间内其他成员
2026/01/01 05:56:14 [ReadPump] 已添加 username 到 Data: 小东
2026/01/01 05:56:14 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 05:56:14 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 05:56:14 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 05:56:14 [ReadPump] 准备调用 broadcastToRoom，房间ID: 3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:56:14 [broadcastToRoom] ENTER | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb type=mic_request
2026/01/01 05:56:14 [broadcastToRoom] 准备获取 RLock | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:56:14 [broadcastToRoom] 已获取 RLock | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:56:14 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb roomSize=1
2026/01/01 05:56:14 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:56:14 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:56:14 [ReadPump] ✅ 连麦申请已广播给房间 3cb1e4f8-bde6-4685-86cd-365a25be1fdb 的其他成员
2026/01/01 05:57:03 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2026/01/01 05:57:13 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2026/01/01 05:57:13 [broadcastToRoom] ENTER | roomID=global type=room_created
2026/01/01 05:57:13 [broadcastToRoom] 准备获取 RLock | roomID=global
2026/01/01 05:57:13 [broadcastToRoom] 已获取 RLock | roomID=global
2026/01/01 05:57:13 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=global roomSize=2
2026/01/01 05:57:13 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=global
2026/01/01 05:57:13 [broadcastToRoom] 📢 向房间 global 的 2 个客户端广播消息类型: room_created
2026/01/01 05:57:13 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/01 05:57:13 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 2b317904-d4a9-4297-af26-74275470b888, 连接指针: 0x14000511560
2026/01/01 05:57:13 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 2b317904-d4a9-4297-af26-74275470b888 的消息，连接指针: 0x14000511560
2026/01/01 05:57:13 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:13 [broadcastToRoom] ENTER | roomID=2b317904-d4a9-4297-af26-74275470b888 type=member_update
2026/01/01 05:57:13 [broadcastToRoom] 准备获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:13 [broadcastToRoom] 已获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:13 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=2b317904-d4a9-4297-af26-74275470b888 roomSize=1
2026/01/01 05:57:13 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:13 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:14 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 05:57:14 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:14 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 05:57:14 [broadcastToRoom] ENTER | roomID=2b317904-d4a9-4297-af26-74275470b888 type=mic_on
2026/01/01 05:57:14 [broadcastToRoom] 准备获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:14 [broadcastToRoom] 已获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:14 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=2b317904-d4a9-4297-af26-74275470b888 roomSize=1
2026/01/01 05:57:14 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:14 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:14 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 05:57:14 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:14 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 05:57:14 [broadcastToRoom] ENTER | roomID=2b317904-d4a9-4297-af26-74275470b888 type=mic_on
2026/01/01 05:57:14 [broadcastToRoom] 准备获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:14 [broadcastToRoom] 已获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:14 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=2b317904-d4a9-4297-af26-74275470b888 roomSize=1
2026/01/01 05:57:14 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:14 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:17 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 3cb1e4f8-bde6-4685-86cd-365a25be1fdb): websocket: close 1005 (no status)
2026/01/01 05:57:17 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 3cb1e4f8-bde6-4685-86cd-365a25be1fdb, 连接指针: 0x14000374ae0
2026/01/01 05:57:17 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:57:17 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/01 05:57:17 [Unregister] 房间 3cb1e4f8-bde6-4685-86cd-365a25be1fdb 清理客户端后，剩余成员数: 0, shouldDeleteRoom: true
2026/01/01 05:57:17 [Unregister] 房间 3cb1e4f8-bde6-4685-86cd-365a25be1fdb 已删除（没有在线成员）
2026/01/01 05:57:17 [broadcastToRoom] ENTER | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb type=member_update
2026/01/01 05:57:17 [broadcastToRoom] 准备获取 RLock | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:57:17 [broadcastToRoom] 已获取 RLock | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:57:17 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:57:17 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2026/01/01 05:57:17 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: 3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:57:17 [broadcastToRoom] ENTER | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb type=room_deleted
2026/01/01 05:57:17 [broadcastToRoom] 准备获取 RLock | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:57:17 [broadcastToRoom] 已获取 RLock | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:57:17 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=3cb1e4f8-bde6-4685-86cd-365a25be1fdb
2026/01/01 05:57:17 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/01 05:57:19 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 2b317904-d4a9-4297-af26-74275470b888, 连接指针: 0x14000511200
2026/01/01 05:57:19 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 2b317904-d4a9-4297-af26-74275470b888 的消息，连接指针: 0x14000511200
2026/01/01 05:57:19 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:19 [broadcastToRoom] ENTER | roomID=2b317904-d4a9-4297-af26-74275470b888 type=member_update
2026/01/01 05:57:19 [broadcastToRoom] 准备获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:19 [broadcastToRoom] 已获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:19 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=2b317904-d4a9-4297-af26-74275470b888 roomSize=2
2026/01/01 05:57:19 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:19 [broadcastToRoom] 📢 向房间 2b317904-d4a9-4297-af26-74275470b888 的 1 个客户端广播消息类型: member_update
2026/01/01 05:57:20 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 05:57:20 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:20 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 05:57:20 [broadcastToRoom] ENTER | roomID=2b317904-d4a9-4297-af26-74275470b888 type=mic_on
2026/01/01 05:57:20 [broadcastToRoom] 准备获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:20 [broadcastToRoom] 已获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:20 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=2b317904-d4a9-4297-af26-74275470b888 roomSize=2
2026/01/01 05:57:20 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:20 [broadcastToRoom] 📢 向房间 2b317904-d4a9-4297-af26-74275470b888 的 1 个客户端广播消息类型: mic_on
2026/01/01 05:57:20 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 05:57:20 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:20 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 05:57:20 [broadcastToRoom] ENTER | roomID=2b317904-d4a9-4297-af26-74275470b888 type=mic_on
2026/01/01 05:57:20 [broadcastToRoom] 准备获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:20 [broadcastToRoom] 已获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:20 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=2b317904-d4a9-4297-af26-74275470b888 roomSize=2
2026/01/01 05:57:20 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:20 [broadcastToRoom] 📢 向房间 2b317904-d4a9-4297-af26-74275470b888 的 1 个客户端广播消息类型: mic_on
2026/01/01 05:57:22 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 05:57:22 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:22 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2026/01/01 05:57:22 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2026/01/01 05:57:22 [ReadPump] 房间ID: 2b317904-d4a9-4297-af26-74275470b888, 准备广播给房间内其他成员
2026/01/01 05:57:22 [ReadPump] 已添加 username 到 Data: 小东
2026/01/01 05:57:22 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 05:57:22 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 05:57:22 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 05:57:22 [ReadPump] 准备调用 broadcastToRoom，房间ID: 2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:22 [broadcastToRoom] ENTER | roomID=2b317904-d4a9-4297-af26-74275470b888 type=mic_request
2026/01/01 05:57:22 [broadcastToRoom] 准备获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:22 [broadcastToRoom] 已获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:22 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=2b317904-d4a9-4297-af26-74275470b888 roomSize=2
2026/01/01 05:57:22 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:22 [broadcastToRoom] 📢 向房间 2b317904-d4a9-4297-af26-74275470b888 的 1 个客户端广播消息类型: mic_request
2026/01/01 05:57:22 [ReadPump] ✅ 连麦申请已广播给房间 2b317904-d4a9-4297-af26-74275470b888 的其他成员
2026/01/01 05:57:31 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 05:57:31 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:31 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2026/01/01 05:57:31 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2026/01/01 05:57:31 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:2b317904-d4a9-4297-af26-74275470b888 UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:map[room_id:2b317904-d4a9-4297-af26-74275470b888 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa] Timestamp:1767218251}
2026/01/01 05:57:31 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:2b317904-d4a9-4297-af26-74275470b888 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/01 05:57:31 [ReadPump] Data 是 map，内容: map[room_id:2b317904-d4a9-4297-af26-74275470b888 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/01 05:57:31 [ReadPump] Data 中的所有键: [target_user_id user_id room_id]
2026/01/01 05:57:31 [ReadPump] ✅ 找到 target_user_id: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2026/01/01 05:57:31 [ReadPump] 准备发送 mic_approved 给用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (房间 2b317904-d4a9-4297-af26-74275470b888)
2026/01/01 05:57:31 [broadcastToRoom] ENTER | roomID=2b317904-d4a9-4297-af26-74275470b888 type=mic_approved
2026/01/01 05:57:31 [broadcastToRoom] 准备获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:31 [broadcastToRoom] 已获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:31 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=2b317904-d4a9-4297-af26-74275470b888 roomSize=2
2026/01/01 05:57:31 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:31 [broadcastToRoom] 📢 向房间 2b317904-d4a9-4297-af26-74275470b888 的 1 个客户端广播消息类型: mic_approved
2026/01/01 05:57:31 [ReadPump] ✅ mic_approved 已广播给房间 2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:32 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 05:57:32 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:32 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_on'
2026/01/01 05:57:32 [broadcastToRoom] ENTER | roomID=2b317904-d4a9-4297-af26-74275470b888 type=mic_on
2026/01/01 05:57:32 [broadcastToRoom] 准备获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:32 [broadcastToRoom] 已获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:32 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=2b317904-d4a9-4297-af26-74275470b888 roomSize=2
2026/01/01 05:57:32 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 05:57:32 [broadcastToRoom] 📢 向房间 2b317904-d4a9-4297-af26-74275470b888 的 1 个客户端广播消息类型: mic_on
2026/01/01 05:57:32 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 05:57:32 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 7223397715720921951 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 03d601f5-6681-47be-94f2-4bae10ac8e9e\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:ljJO\r\na=ice-pwd:daKm8d9OqTqP59xXE2C0Y2hW\r\na=ice-options:trickle\r\na=fingerprint:sha-256 24:42:96:D1:9E:A7:B3:4F:73:A7:90:B2:5E:03:E3:C5:9A:C0:35:96:77:CD:7C:21:66:B6:00:BA:29:EE:AB:D4\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:03d601f5-6681-47be-94f2-4bae10ac8e9e 9b7a8fbf-1592-487b-8563-1e29b427dc9b\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:3109448008 cname:z911O2Ar1B28bKO1\r\na=ssrc:3109448008 msid:03d601f5-6681-47be-94f2-4bae10ac8e9e 9b7a8fbf-1592-487b-8563-1e29b427dc9b\r\n","type":"offer"},"room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:32 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/01 05:57:32 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 05:57:32 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 6156943513226120156 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 03d601f5-6681-47be-94f2-4bae10ac8e9e\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:NITY\r\na=ice-pwd:fLUib/hzQ/vIH3jbG6OuA52J\r\na=ice-options:trickle\r\na=fingerprint:sha-256 EE:46:B8:B5:FC:A5:96:FD:83:CA:C9:B6:74:FC:1A:03:76:50:AA:69:20:20:9F:0E:90:11:31:79:A9:5E:C8:4D\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:03d601f5-6681-47be-94f2-4bae10ac8e9e 9b7a8fbf-1592-487b-8563-1e29b427dc9b\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:91223165 cname:PEUFeUaG0oX0lU8v\r\na=ssrc:91223165 msid:03d601f5-6681-47be-94f2-4bae10ac8e9e 9b7a8fbf-1592-487b-8563-1e29b427dc9b\r\n","type":"offer"},"room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:32 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/01 05:57:32 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 05:57:32 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3046045078 1 udp 2122194687 192.168.1.5 50254 typ host generation 0 ufrag ljJO network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"ljJO"},"room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:32 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 05:57:32 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 05:57:32 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1508210760 1 udp 2122262783 2409:8a00:26c8:9760:6c96:8f09:83dc:a0ee 57574 typ host generation 0 ufrag ljJO network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"ljJO"},"room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:32 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 05:57:32 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 05:57:32 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3232155313 1 udp 2122194687 192.168.1.5 64176 typ host generation 0 ufrag NITY network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"NITY"},"room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:32 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 05:57:32 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 05:57:32 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2703315695 1 udp 2122262783 2409:8a00:26c8:9760:6c96:8f09:83dc:a0ee 62631 typ host generation 0 ufrag NITY network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"NITY"},"room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:32 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 05:57:32 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 05:57:32 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2744368932 1 udp 1685987071 117.129.35.233 22494 typ srflx raddr 192.168.1.5 rport 50254 generation 0 ufrag ljJO network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"ljJO"},"room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:32 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 05:57:32 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 05:57:32 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3406876827 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag ljJO network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"ljJO"},"room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:32 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 05:57:32 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 05:57:32 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:662396229 1 tcp 1518283007 2409:8a00:26c8:9760:6c96:8f09:83dc:a0ee 9 typ host tcptype active generation 0 ufrag ljJO network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"ljJO"},"room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:32 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 05:57:32 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 05:57:32 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3194561577 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag NITY network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"NITY"},"room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:32 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 05:57:32 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 05:57:32 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3756961911 1 tcp 1518283007 2409:8a00:26c8:9760:6c96:8f09:83dc:a0ee 9 typ host tcptype active generation 0 ufrag NITY network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"NITY"},"room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:32 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 05:57:32 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 05:57:32 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3856599387 1 udp 1685987071 117.129.35.233 22497 typ srflx raddr 192.168.1.5 rport 64176 generation 0 ufrag NITY network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"NITY"},"room_id":"2b317904-d4a9-4297-af26-74275470b888"}}
2026/01/01 05:57:32 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 06:12:48 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 2b317904-d4a9-4297-af26-74275470b888): websocket: close 1001 (going away)
2026/01/01 06:12:48 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 2b317904-d4a9-4297-af26-74275470b888, 连接指针: 0x14000511560
2026/01/01 06:12:48 [RoomHub.Run] 收到 Broadcast 消息，类型: room_update, 房间ID: 2b317904-d4a9-4297-af26-74275470b888
2026/01/01 06:12:48 [broadcastToRoom] ENTER | roomID=2b317904-d4a9-4297-af26-74275470b888 type=room_update
2026/01/01 06:12:48 [broadcastToRoom] 准备获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 06:12:48 [broadcastToRoom] 已获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 06:12:48 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=2b317904-d4a9-4297-af26-74275470b888 roomSize=2
2026/01/01 06:12:48 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 06:12:48 [broadcastToRoom] 📢 向房间 2b317904-d4a9-4297-af26-74275470b888 的 2 个客户端广播消息类型: room_update
2026/01/01 06:12:48 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/01 06:12:48 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 2b317904-d4a9-4297-af26-74275470b888
2026/01/01 06:12:48 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/01 06:12:48 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2026/01/01 06:12:48 [Unregister] 房间 2b317904-d4a9-4297-af26-74275470b888 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2026/01/01 06:12:48 [Unregister] 房间 2b317904-d4a9-4297-af26-74275470b888 保留（还有 1 个在线成员）
2026/01/01 06:12:48 [broadcastToRoom] ENTER | roomID=2b317904-d4a9-4297-af26-74275470b888 type=member_update
2026/01/01 06:12:48 [broadcastToRoom] 准备获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 06:12:48 [broadcastToRoom] 已获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 06:12:48 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=2b317904-d4a9-4297-af26-74275470b888 roomSize=1
2026/01/01 06:12:48 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 06:12:48 [broadcastToRoom] 📢 向房间 2b317904-d4a9-4297-af26-74275470b888 的 1 个客户端广播消息类型: member_update
2026/01/01 06:12:51 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 2b317904-d4a9-4297-af26-74275470b888): websocket: close 1005 (no status)
2026/01/01 06:12:51 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 2b317904-d4a9-4297-af26-74275470b888, 连接指针: 0x14000511200
2026/01/01 06:12:51 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 2b317904-d4a9-4297-af26-74275470b888
2026/01/01 06:12:51 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/01 06:12:51 [Unregister] 房间 2b317904-d4a9-4297-af26-74275470b888 清理客户端后，剩余成员数: 0, shouldDeleteRoom: true
2026/01/01 06:12:51 [Unregister] 房间 2b317904-d4a9-4297-af26-74275470b888 已删除（没有在线成员）
2026/01/01 06:12:51 [broadcastToRoom] ENTER | roomID=2b317904-d4a9-4297-af26-74275470b888 type=member_update
2026/01/01 06:12:51 [broadcastToRoom] 准备获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 06:12:51 [broadcastToRoom] 已获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 06:12:51 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 06:12:51 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2026/01/01 06:12:51 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: 2b317904-d4a9-4297-af26-74275470b888
2026/01/01 06:12:51 [broadcastToRoom] ENTER | roomID=2b317904-d4a9-4297-af26-74275470b888 type=room_deleted
2026/01/01 06:12:51 [broadcastToRoom] 准备获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 06:12:51 [broadcastToRoom] 已获取 RLock | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 06:12:51 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=2b317904-d4a9-4297-af26-74275470b888
2026/01/01 06:12:51 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/01 06:12:56 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/01 06:12:56 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ad260
2026/01/01 06:12:56 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000ad260
2026/01/01 06:12:56 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000ad260
2026/01/01 06:12:56 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007dc20
2026/01/01 06:12:56 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400007dc20
2026/01/01 06:12:56 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/01 06:12:56 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140000ad260, 新连接: 0x1400007dc20
2026/01/01 06:12:56 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/01 06:12:56 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400007dc20
2026/01/01 06:12:56 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/01 06:12:56 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ad260
2026/01/01 06:12:56 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/01 06:13:00 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2026/01/01 06:13:00 [broadcastToRoom] ENTER | roomID=global type=room_created
2026/01/01 06:13:00 [broadcastToRoom] 准备获取 RLock | roomID=global
2026/01/01 06:13:00 [broadcastToRoom] 已获取 RLock | roomID=global
2026/01/01 06:13:00 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=global roomSize=4
2026/01/01 06:13:00 [broadcastToRoom] 已释放 RLock，recipients=4 | roomID=global
2026/01/01 06:13:00 [broadcastToRoom] 📢 向房间 global 的 4 个客户端广播消息类型: room_created
2026/01/01 06:13:00 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/01 06:13:00 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2026/01/01 06:13:01 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:01 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x1400007dc20, 新连接: 0x14000124240
2026/01/01 06:13:01 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/01 06:13:01 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 9c6a03d4-2733-4998-8ad3-12d72d1a90a6, 连接指针: 0x14000124240
2026/01/01 06:13:01 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 9c6a03d4-2733-4998-8ad3-12d72d1a90a6 的消息，连接指针: 0x14000124240
2026/01/01 06:13:01 [broadcastToRoom] ENTER | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 type=member_update
2026/01/01 06:13:01 [broadcastToRoom] 准备获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:01 [broadcastToRoom] 已获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:01 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 roomSize=1
2026/01/01 06:13:01 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:01 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:01 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 06:13:01 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:01 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 06:13:01 [broadcastToRoom] ENTER | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 type=mic_on
2026/01/01 06:13:01 [broadcastToRoom] 准备获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:01 [broadcastToRoom] 已获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:01 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 roomSize=1
2026/01/01 06:13:01 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:01 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:02 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 06:13:02 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:02 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 06:13:02 [broadcastToRoom] ENTER | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 type=mic_on
2026/01/01 06:13:02 [broadcastToRoom] 准备获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:02 [broadcastToRoom] 已获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:02 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 roomSize=1
2026/01/01 06:13:02 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:02 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:03 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:03 [broadcastToRoom] ENTER | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 type=member_update
2026/01/01 06:13:03 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 9c6a03d4-2733-4998-8ad3-12d72d1a90a6, 连接指针: 0x1400054d860
2026/01/01 06:13:03 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 9c6a03d4-2733-4998-8ad3-12d72d1a90a6 的消息，连接指针: 0x1400054d860
2026/01/01 06:13:03 [broadcastToRoom] 准备获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:03 [broadcastToRoom] 已获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:03 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 roomSize=2
2026/01/01 06:13:03 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:03 [broadcastToRoom] 📢 向房间 9c6a03d4-2733-4998-8ad3-12d72d1a90a6 的 1 个客户端广播消息类型: member_update
2026/01/01 06:13:04 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 06:13:04 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:04 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 06:13:04 [broadcastToRoom] ENTER | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 type=mic_on
2026/01/01 06:13:04 [broadcastToRoom] 准备获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:04 [broadcastToRoom] 已获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:04 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 roomSize=2
2026/01/01 06:13:04 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:04 [broadcastToRoom] 📢 向房间 9c6a03d4-2733-4998-8ad3-12d72d1a90a6 的 1 个客户端广播消息类型: mic_on
2026/01/01 06:13:04 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 06:13:04 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:04 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 06:13:04 [broadcastToRoom] ENTER | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 type=mic_on
2026/01/01 06:13:04 [broadcastToRoom] 准备获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:04 [broadcastToRoom] 已获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:04 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 roomSize=2
2026/01/01 06:13:04 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:04 [broadcastToRoom] 📢 向房间 9c6a03d4-2733-4998-8ad3-12d72d1a90a6 的 1 个客户端广播消息类型: mic_on
2026/01/01 06:13:05 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 06:13:05 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:05 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2026/01/01 06:13:05 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2026/01/01 06:13:05 [ReadPump] 房间ID: 9c6a03d4-2733-4998-8ad3-12d72d1a90a6, 准备广播给房间内其他成员
2026/01/01 06:13:05 [ReadPump] 已添加 username 到 Data: 小东
2026/01/01 06:13:05 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 06:13:05 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 06:13:05 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 06:13:05 [ReadPump] 准备调用 broadcastToRoom，房间ID: 9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:05 [broadcastToRoom] ENTER | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 type=mic_request
2026/01/01 06:13:05 [broadcastToRoom] 准备获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:05 [broadcastToRoom] 已获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:05 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 roomSize=2
2026/01/01 06:13:05 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:05 [broadcastToRoom] 📢 向房间 9c6a03d4-2733-4998-8ad3-12d72d1a90a6 的 1 个客户端广播消息类型: mic_request
2026/01/01 06:13:05 [ReadPump] ✅ 连麦申请已广播给房间 9c6a03d4-2733-4998-8ad3-12d72d1a90a6 的其他成员
2026/01/01 06:13:42 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 06:13:42 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:42 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2026/01/01 06:13:42 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2026/01/01 06:13:42 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:9c6a03d4-2733-4998-8ad3-12d72d1a90a6 UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:map[room_id:9c6a03d4-2733-4998-8ad3-12d72d1a90a6 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa] Timestamp:1767219222}
2026/01/01 06:13:42 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:9c6a03d4-2733-4998-8ad3-12d72d1a90a6 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/01 06:13:42 [ReadPump] Data 是 map，内容: map[room_id:9c6a03d4-2733-4998-8ad3-12d72d1a90a6 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/01 06:13:42 [ReadPump] Data 中的所有键: [user_id room_id target_user_id]
2026/01/01 06:13:42 [ReadPump] ✅ 找到 target_user_id: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2026/01/01 06:13:42 [ReadPump] 准备发送 mic_approved 给用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (房间 9c6a03d4-2733-4998-8ad3-12d72d1a90a6)
2026/01/01 06:13:42 [broadcastToRoom] ENTER | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 type=mic_approved
2026/01/01 06:13:42 [broadcastToRoom] 准备获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:42 [broadcastToRoom] 已获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:42 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 roomSize=2
2026/01/01 06:13:42 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:42 [broadcastToRoom] 📢 向房间 9c6a03d4-2733-4998-8ad3-12d72d1a90a6 的 1 个客户端广播消息类型: mic_approved
2026/01/01 06:13:42 [ReadPump] ✅ mic_approved 已广播给房间 9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:43 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 06:13:43 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:43 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_on'
2026/01/01 06:13:43 [broadcastToRoom] ENTER | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 type=mic_on
2026/01/01 06:13:43 [broadcastToRoom] 准备获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:43 [broadcastToRoom] 已获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:43 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 roomSize=2
2026/01/01 06:13:43 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 06:13:43 [broadcastToRoom] 📢 向房间 9c6a03d4-2733-4998-8ad3-12d72d1a90a6 的 1 个客户端广播消息类型: mic_on
2026/01/01 06:13:43 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 06:13:43 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 6104558368847958141 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS ca292df3-0641-4d57-bf93-3d2ea545494f\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:CbOB\r\na=ice-pwd:5/pIKVXWz6jpNR6ue8sZkWVD\r\na=ice-options:trickle\r\na=fingerprint:sha-256 41:EA:F1:80:45:13:56:52:84:1B:96:9C:2E:7A:82:19:DE:EC:BA:F8:C2:76:D0:7A:A9:B4:DC:09:58:72:E6:14\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:ca292df3-0641-4d57-bf93-3d2ea545494f 49fb2715-868c-4906-9091-6900e27620ed\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:1607081397 cname:D0G3QnvB3NVBB08+\r\na=ssrc:1607081397 msid:ca292df3-0641-4d57-bf93-3d2ea545494f 49fb2715-868c-4906-9091-6900e27620ed\r\n","type":"offer"},"room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:43 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/01 06:13:43 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 06:13:43 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 2957093170799279578 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS ca292df3-0641-4d57-bf93-3d2ea545494f\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:tks6\r\na=ice-pwd:VgCPTT3tZcnx1SaPaBmXK+Rr\r\na=ice-options:trickle\r\na=fingerprint:sha-256 A3:BB:A0:40:20:69:59:D8:74:D0:2E:24:CA:3C:D5:84:CC:12:EE:6F:A7:02:4E:25:30:92:DE:E3:22:5D:FE:40\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:ca292df3-0641-4d57-bf93-3d2ea545494f 49fb2715-868c-4906-9091-6900e27620ed\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:2440958753 cname:pDFm4IofacAzzWKl\r\na=ssrc:2440958753 msid:ca292df3-0641-4d57-bf93-3d2ea545494f 49fb2715-868c-4906-9091-6900e27620ed\r\n","type":"offer"},"room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:43 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/01 06:13:43 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 06:13:43 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1336765145 1 udp 2122194687 192.168.1.5 49354 typ host generation 0 ufrag CbOB network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"CbOB"},"room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:43 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 06:13:43 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 06:13:43 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3273626046 1 udp 2122262783 2409:8a00:26c8:9760:6c96:8f09:83dc:a0ee 62454 typ host generation 0 ufrag CbOB network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"CbOB"},"room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:43 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 06:13:43 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 06:13:43 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2970074701 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag CbOB network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"CbOB"},"room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:43 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 06:13:43 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 06:13:43 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1035289898 1 tcp 1518283007 2409:8a00:26c8:9760:6c96:8f09:83dc:a0ee 9 typ host tcptype active generation 0 ufrag CbOB network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"CbOB"},"room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:43 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 06:13:43 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 06:13:43 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3449179435 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag tks6 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"tks6"},"room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:43 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 06:13:43 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 06:13:43 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1092925004 1 tcp 1518283007 2409:8a00:26c8:9760:6c96:8f09:83dc:a0ee 9 typ host tcptype active generation 0 ufrag tks6 network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"tks6"},"room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:43 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 06:13:43 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 06:13:43 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:859609535 1 udp 2122194687 192.168.1.5 51262 typ host generation 0 ufrag tks6 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"tks6"},"room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:43 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 06:13:43 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 06:13:43 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3213779672 1 udp 2122262783 2409:8a00:26c8:9760:6c96:8f09:83dc:a0ee 52537 typ host generation 0 ufrag tks6 network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"tks6"},"room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:43 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 06:13:43 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 06:13:43 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:257366128 1 udp 1685987071 117.129.35.233 22345 typ srflx raddr 192.168.1.5 rport 49354 generation 0 ufrag CbOB network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"CbOB"},"room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:43 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 06:13:43 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 06:13:43 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1942416150 1 udp 1685987071 117.129.35.233 22346 typ srflx raddr 192.168.1.5 rport 51262 generation 0 ufrag tks6 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"tks6"},"room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 06:13:43 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 10:02:51 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 10:02:51 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2836698066 1 udp 2122262783 2409:8a00:26c8:9760:545d:2f72:65e3:f0c3 52545 typ host generation 0 ufrag CbOB network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"CbOB"},"room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 10:02:51 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 10:02:51 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 10:02:51 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3582288052 1 udp 2122262783 2409:8a00:26c8:9760:545d:2f72:65e3:f0c3 53817 typ host generation 0 ufrag tks6 network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"tks6"},"room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 10:02:51 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 10:02:51 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 10:02:51 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1472087878 1 tcp 1518283007 2409:8a00:26c8:9760:545d:2f72:65e3:f0c3 9 typ host tcptype active generation 0 ufrag CbOB network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"CbOB"},"room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 10:02:51 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 10:02:51 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 10:02:51 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:724546592 1 tcp 1518283007 2409:8a00:26c8:9760:545d:2f72:65e3:f0c3 9 typ host tcptype active generation 0 ufrag tks6 network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"tks6"},"room_id":"9c6a03d4-2733-4998-8ad3-12d72d1a90a6"}}
2026/01/01 10:02:51 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 18:56:59 ❌ WebSocket 读取错误 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 9c6a03d4-2733-4998-8ad3-12d72d1a90a6): websocket: close 1006 (abnormal closure): unexpected EOF
2026/01/01 18:56:59 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 9c6a03d4-2733-4998-8ad3-12d72d1a90a6): websocket: close 1006 (abnormal closure): unexpected EOF
2026/01/01 18:56:59 ❌ WebSocket 读取错误 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1006 (abnormal closure): unexpected EOF
2026/01/01 18:56:59 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1006 (abnormal closure): unexpected EOF
2026/01/01 18:56:59 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000510480
2026/01/01 18:56:59 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 9c6a03d4-2733-4998-8ad3-12d72d1a90a6, 连接指针: 0x14000124240
2026/01/01 18:56:59 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 9c6a03d4-2733-4998-8ad3-12d72d1a90a6, 连接指针: 0x1400054d860
2026/01/01 18:56:59 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007dc20
2026/01/01 18:56:59 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/01 18:56:59 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/01 18:57:00 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 18:57:00 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/01 18:57:00 [Unregister] 房间 9c6a03d4-2733-4998-8ad3-12d72d1a90a6 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2026/01/01 18:57:00 [Unregister] 房间 9c6a03d4-2733-4998-8ad3-12d72d1a90a6 保留（还有 1 个在线成员）
2026/01/01 18:57:00 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): Hub 关闭了发送通道
2026/01/01 18:57:00 [broadcastToRoom] ENTER | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 type=member_update
2026/01/01 18:57:00 [broadcastToRoom] 准备获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 18:57:00 [broadcastToRoom] 已获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 18:57:00 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 roomSize=1
2026/01/01 18:57:00 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 18:57:00 [broadcastToRoom] 📢 向房间 9c6a03d4-2733-4998-8ad3-12d72d1a90a6 的 1 个客户端广播消息类型: member_update
2026/01/01 18:57:00 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 18:57:00 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/01 18:57:00 [Unregister] 房间 9c6a03d4-2733-4998-8ad3-12d72d1a90a6 清理客户端后，剩余成员数: 0, shouldDeleteRoom: true
2026/01/01 18:57:00 [Unregister] 房间 9c6a03d4-2733-4998-8ad3-12d72d1a90a6 已删除（没有在线成员）
2026/01/01 18:57:00 [broadcastToRoom] ENTER | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 type=member_update
2026/01/01 18:57:00 [broadcastToRoom] 准备获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 18:57:00 [broadcastToRoom] 已获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 18:57:00 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 18:57:00 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 关闭写入器失败: write tcp [::1]:8081->[::1]:55819: use of closed network connection
2026/01/01 18:57:00 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 关闭写入器失败: write tcp [::1]:8081->[::1]:51379: use of closed network connection
2026/01/01 18:57:00 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 关闭写入器失败: write tcp [::1]:8081->[::1]:51294: use of closed network connection
2026/01/01 18:57:00 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: 9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 18:57:00 [broadcastToRoom] ENTER | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6 type=room_deleted
2026/01/01 18:57:00 [broadcastToRoom] 准备获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 18:57:00 [broadcastToRoom] 已获取 RLock | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 18:57:00 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=9c6a03d4-2733-4998-8ad3-12d72d1a90a6
2026/01/01 18:57:00 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/01 21:35:14 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/01 21:35:14 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005a66c0
2026/01/01 21:35:14 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005a66c0
2026/01/01 21:35:14 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005a66c0
2026/01/01 21:35:14 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/01 21:35:14 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005a66c0
2026/01/01 21:35:14 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/01 21:35:14 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/01 21:35:14 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/01 21:35:14 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007ca80
2026/01/01 21:35:14 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400007ca80
2026/01/01 21:35:14 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/01 21:35:14 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400007ca80
2026/01/01 21:35:19 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2026/01/01 21:35:19 [broadcastToRoom] ENTER | roomID=global type=room_created
2026/01/01 21:35:19 [broadcastToRoom] 准备获取 RLock | roomID=global
2026/01/01 21:35:19 [broadcastToRoom] 已获取 RLock | roomID=global
2026/01/01 21:35:19 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=global roomSize=6
2026/01/01 21:35:19 [broadcastToRoom] 已释放 RLock，recipients=6 | roomID=global
2026/01/01 21:35:19 [broadcastToRoom] 📢 向房间 global 的 6 个客户端广播消息类型: room_created
2026/01/01 21:35:19 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/01 21:35:19 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2026/01/01 21:35:19 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:19 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x1400007ca80, 新连接: 0x14000375380
2026/01/01 21:35:19 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/01 21:35:19 [broadcastToRoom] ENTER | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 type=member_update
2026/01/01 21:35:19 [broadcastToRoom] 准备获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:19 [broadcastToRoom] 已获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:19 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 roomSize=1
2026/01/01 21:35:19 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:19 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:19 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: fed597ac-a443-4e19-aaa0-fb3bbcb9ce73, 连接指针: 0x14000375380
2026/01/01 21:35:19 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 的消息，连接指针: 0x14000375380
2026/01/01 21:35:20 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 21:35:20 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:20 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 21:35:20 [broadcastToRoom] ENTER | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 type=mic_on
2026/01/01 21:35:20 [broadcastToRoom] 准备获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:20 [broadcastToRoom] 已获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:20 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 roomSize=1
2026/01/01 21:35:20 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:20 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:20 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 21:35:20 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:20 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 21:35:20 [broadcastToRoom] ENTER | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 type=mic_on
2026/01/01 21:35:20 [broadcastToRoom] 准备获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:20 [broadcastToRoom] 已获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:20 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 roomSize=1
2026/01/01 21:35:20 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:20 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:31 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000510960
2026/01/01 21:35:31 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/01 21:35:31 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000510960
2026/01/01 21:35:31 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x14000510960
2026/01/01 21:35:31 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140007983c0
2026/01/01 21:35:31 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140007983c0
2026/01/01 21:35:31 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/01 21:35:31 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x14000510960, 新连接: 0x140007983c0
2026/01/01 21:35:31 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2026/01/01 21:35:31 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x140007983c0
2026/01/01 21:35:31 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2026/01/01 21:35:31 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000510960
2026/01/01 21:35:31 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/01 21:35:32 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:32 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x140007983c0, 新连接: 0x140005628a0
2026/01/01 21:35:32 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2026/01/01 21:35:32 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: fed597ac-a443-4e19-aaa0-fb3bbcb9ce73, 连接指针: 0x140005628a0
2026/01/01 21:35:32 [broadcastToRoom] ENTER | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 type=member_update
2026/01/01 21:35:32 [broadcastToRoom] 准备获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:32 [broadcastToRoom] 已获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:32 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 的消息，连接指针: 0x140005628a0
2026/01/01 21:35:32 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 roomSize=2
2026/01/01 21:35:32 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:32 [broadcastToRoom] 📢 向房间 fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 的 1 个客户端广播消息类型: member_update
2026/01/01 21:35:33 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 21:35:33 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:33 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 21:35:33 [broadcastToRoom] ENTER | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 type=mic_on
2026/01/01 21:35:33 [broadcastToRoom] 准备获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:33 [broadcastToRoom] 已获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:33 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 roomSize=2
2026/01/01 21:35:33 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:33 [broadcastToRoom] 📢 向房间 fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 的 1 个客户端广播消息类型: mic_on
2026/01/01 21:35:33 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 21:35:33 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:33 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 21:35:33 [broadcastToRoom] ENTER | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 type=mic_on
2026/01/01 21:35:33 [broadcastToRoom] 准备获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:33 [broadcastToRoom] 已获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:33 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 roomSize=2
2026/01/01 21:35:33 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:33 [broadcastToRoom] 📢 向房间 fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 的 1 个客户端广播消息类型: mic_on
2026/01/01 21:35:34 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 21:35:34 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:34 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2026/01/01 21:35:34 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2026/01/01 21:35:34 [ReadPump] 房间ID: fed597ac-a443-4e19-aaa0-fb3bbcb9ce73, 准备广播给房间内其他成员
2026/01/01 21:35:34 [ReadPump] 已添加 username 到 Data: 小东
2026/01/01 21:35:34 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 21:35:34 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 21:35:34 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 21:35:34 [ReadPump] 准备调用 broadcastToRoom，房间ID: fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:34 [broadcastToRoom] ENTER | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 type=mic_request
2026/01/01 21:35:34 [broadcastToRoom] 准备获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:34 [broadcastToRoom] 已获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:34 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 roomSize=2
2026/01/01 21:35:34 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:34 [broadcastToRoom] 📢 向房间 fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 的 1 个客户端广播消息类型: mic_request
2026/01/01 21:35:34 [ReadPump] ✅ 连麦申请已广播给房间 fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 的其他成员
2026/01/01 21:35:35 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 21:35:35 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:35 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2026/01/01 21:35:35 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2026/01/01 21:35:35 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:map[room_id:fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa] Timestamp:1767274535}
2026/01/01 21:35:35 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/01 21:35:35 [ReadPump] Data 是 map，内容: map[room_id:fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/01 21:35:35 [ReadPump] Data 中的所有键: [target_user_id user_id room_id]
2026/01/01 21:35:35 [ReadPump] ✅ 找到 target_user_id: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2026/01/01 21:35:35 [ReadPump] 准备发送 mic_approved 给用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (房间 fed597ac-a443-4e19-aaa0-fb3bbcb9ce73)
2026/01/01 21:35:35 [broadcastToRoom] ENTER | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 type=mic_approved
2026/01/01 21:35:35 [broadcastToRoom] 准备获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:35 [broadcastToRoom] 已获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:35 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 roomSize=2
2026/01/01 21:35:35 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:35 [broadcastToRoom] 📢 向房间 fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 的 1 个客户端广播消息类型: mic_approved
2026/01/01 21:35:35 [ReadPump] ✅ mic_approved 已广播给房间 fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:36 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 21:35:36 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:36 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_on'
2026/01/01 21:35:36 [broadcastToRoom] ENTER | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 type=mic_on
2026/01/01 21:35:36 [broadcastToRoom] 准备获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:36 [broadcastToRoom] 已获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:36 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 roomSize=2
2026/01/01 21:35:36 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 21:35:36 [broadcastToRoom] 📢 向房间 fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 的 1 个客户端广播消息类型: mic_on
2026/01/01 21:35:36 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 21:35:36 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 3313653587115747386 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS b5e58204-d00a-45bb-8098-51ebd439a398\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:Kmww\r\na=ice-pwd:fN1Y2j6Xo10JPp6sINDuaLFY\r\na=ice-options:trickle\r\na=fingerprint:sha-256 4A:3E:B6:C2:6D:EC:39:61:5B:97:87:8D:6B:79:77:57:6C:20:6B:0C:FF:AD:78:7B:2D:1A:C8:06:88:41:ED:A2\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:b5e58204-d00a-45bb-8098-51ebd439a398 ba3fc647-1ae7-4b5e-ae39-f8139941be3e\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:3093523355 cname:4AKj9t2GdsYCBPud\r\na=ssrc:3093523355 msid:b5e58204-d00a-45bb-8098-51ebd439a398 ba3fc647-1ae7-4b5e-ae39-f8139941be3e\r\n","type":"offer"},"room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:36 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/01 21:35:36 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 21:35:36 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 7146405405980833297 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS b5e58204-d00a-45bb-8098-51ebd439a398\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:Jm1U\r\na=ice-pwd:50eKAMpti0TRUiu/b2vsLONH\r\na=ice-options:trickle\r\na=fingerprint:sha-256 E3:19:90:27:2F:43:C4:D3:E7:9D:F0:60:91:87:C4:B5:E7:C2:E9:2B:0C:EF:D3:66:F6:30:3B:8F:CB:9E:32:7A\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:b5e58204-d00a-45bb-8098-51ebd439a398 ba3fc647-1ae7-4b5e-ae39-f8139941be3e\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:3784965004 cname:tciGbL69g3IUKMEX\r\na=ssrc:3784965004 msid:b5e58204-d00a-45bb-8098-51ebd439a398 ba3fc647-1ae7-4b5e-ae39-f8139941be3e\r\n","type":"offer"},"room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:36 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/01 21:35:36 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 21:35:36 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1904374959 1 udp 2122194687 192.168.1.5 65522 typ host generation 0 ufrag Kmww network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Kmww"},"room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:36 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 21:35:36 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 21:35:36 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1552339220 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 54356 typ host generation 0 ufrag Kmww network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Kmww"},"room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:36 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 21:35:36 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 21:35:36 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3920421223 1 udp 2122194687 192.168.1.5 60155 typ host generation 0 ufrag Jm1U network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Jm1U"},"room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:36 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 21:35:36 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 21:35:36 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3299362012 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 64644 typ host generation 0 ufrag Jm1U network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Jm1U"},"room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:36 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 21:35:37 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 21:35:37 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2401804347 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag Kmww network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Kmww"},"room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:37 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 21:35:37 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 21:35:37 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2720793984 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag Kmww network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Kmww"},"room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:37 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 21:35:37 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 21:35:37 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:386282995 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag Jm1U network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Jm1U"},"room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:37 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 21:35:37 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 21:35:37 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:973246536 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag Jm1U network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Jm1U"},"room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:37 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 21:35:37 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 21:35:37 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:829949446 1 udp 1685987071 117.129.35.233 22518 typ srflx raddr 192.168.1.5 rport 65522 generation 0 ufrag Kmww network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Kmww"},"room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:37 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 21:35:37 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 21:35:37 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2841023438 1 udp 1685987071 117.129.35.233 22519 typ srflx raddr 192.168.1.5 rport 60155 generation 0 ufrag Jm1U network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Jm1U"},"room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 21:35:37 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 21:36:25 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2026/01/01 22:16:52 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400010e2a0
2026/01/01 22:16:52 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400010e2a0
2026/01/01 22:16:52 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/01 22:16:52 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400010e2a0
2026/01/01 22:16:52 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/01 22:16:52 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400010e2a0
2026/01/01 22:16:52 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/01 22:16:52 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/01 22:16:52 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/01 22:16:52 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/01 22:16:52 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400010e7e0
2026/01/01 22:16:52 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400010e7e0
2026/01/01 22:16:52 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400010e7e0
2026/01/01 22:16:58 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2026/01/01 22:16:58 [broadcastToRoom] ENTER | roomID=global type=room_created
2026/01/01 22:16:58 [broadcastToRoom] 准备获取 RLock | roomID=global
2026/01/01 22:16:58 [broadcastToRoom] 已获取 RLock | roomID=global
2026/01/01 22:16:58 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=global roomSize=2
2026/01/01 22:16:58 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=global
2026/01/01 22:16:58 [broadcastToRoom] 📢 向房间 global 的 2 个客户端广播消息类型: room_created
2026/01/01 22:16:58 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/01 22:16:58 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2026/01/01 22:16:58 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:16:58 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x1400010e7e0, 新连接: 0x1400050ae40
2026/01/01 22:16:58 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/01 22:16:58 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: cafc97b6-3fbf-438f-8be5-8289045784b5, 连接指针: 0x1400050ae40
2026/01/01 22:16:58 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 cafc97b6-3fbf-438f-8be5-8289045784b5 的消息，连接指针: 0x1400050ae40
2026/01/01 22:16:58 [broadcastToRoom] ENTER | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 type=member_update
2026/01/01 22:16:58 [broadcastToRoom] 准备获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:16:58 [broadcastToRoom] 已获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:16:58 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 roomSize=1
2026/01/01 22:16:58 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:16:58 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:16:58 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:16:58 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:16:58 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:16:58 [broadcastToRoom] ENTER | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 type=mic_on
2026/01/01 22:16:58 [broadcastToRoom] 准备获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:16:58 [broadcastToRoom] 已获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:16:58 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 roomSize=1
2026/01/01 22:16:58 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:16:58 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:16:58 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:16:58 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:16:58 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:16:58 [broadcastToRoom] ENTER | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 type=mic_on
2026/01/01 22:16:58 [broadcastToRoom] 准备获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:16:58 [broadcastToRoom] 已获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:16:58 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 roomSize=1
2026/01/01 22:16:58 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:16:58 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:04 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:04 [broadcastToRoom] ENTER | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 type=member_update
2026/01/01 22:17:04 [broadcastToRoom] 准备获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:04 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: fed597ac-a443-4e19-aaa0-fb3bbcb9ce73, 连接指针: 0x14000408ea0
2026/01/01 22:17:04 [broadcastToRoom] 已获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:04 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 roomSize=1
2026/01/01 22:17:04 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:04 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:04 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 的消息，连接指针: 0x14000408ea0
2026/01/01 22:17:06 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:17:06 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"fed597ac-a443-4e19-aaa0-fb3bbcb9ce73"}}
2026/01/01 22:17:06 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2026/01/01 22:17:06 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2026/01/01 22:17:06 [ReadPump] 房间ID: fed597ac-a443-4e19-aaa0-fb3bbcb9ce73, 准备广播给房间内其他成员
2026/01/01 22:17:06 [ReadPump] 已添加 username 到 Data: 小东
2026/01/01 22:17:06 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:17:06 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:17:06 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:17:06 [ReadPump] 准备调用 broadcastToRoom，房间ID: fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:06 [broadcastToRoom] ENTER | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 type=mic_request
2026/01/01 22:17:06 [broadcastToRoom] 准备获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:06 [broadcastToRoom] 已获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:06 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 roomSize=1
2026/01/01 22:17:06 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:06 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:06 [ReadPump] ✅ 连麦申请已广播给房间 fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 的其他成员
2026/01/01 22:17:14 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: fed597ac-a443-4e19-aaa0-fb3bbcb9ce73): websocket: close 1005 (no status)
2026/01/01 22:17:14 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: fed597ac-a443-4e19-aaa0-fb3bbcb9ce73, 连接指针: 0x14000408ea0
2026/01/01 22:17:14 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:14 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/01 22:17:14 [Unregister] 房间 fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 清理客户端后，剩余成员数: 0, shouldDeleteRoom: true
2026/01/01 22:17:14 [Unregister] 房间 fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 已删除（没有在线成员）
2026/01/01 22:17:14 [broadcastToRoom] ENTER | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 type=member_update
2026/01/01 22:17:14 [broadcastToRoom] 准备获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:14 [broadcastToRoom] 已获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:14 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:14 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2026/01/01 22:17:14 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:14 [broadcastToRoom] ENTER | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73 type=room_deleted
2026/01/01 22:17:14 [broadcastToRoom] 准备获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:14 [broadcastToRoom] 已获取 RLock | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:14 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=fed597ac-a443-4e19-aaa0-fb3bbcb9ce73
2026/01/01 22:17:14 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/01 22:17:16 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:16 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: cafc97b6-3fbf-438f-8be5-8289045784b5, 连接指针: 0x140006a0120
2026/01/01 22:17:16 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 cafc97b6-3fbf-438f-8be5-8289045784b5 的消息，连接指针: 0x140006a0120
2026/01/01 22:17:16 [broadcastToRoom] ENTER | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 type=member_update
2026/01/01 22:17:16 [broadcastToRoom] 准备获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:16 [broadcastToRoom] 已获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:16 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 roomSize=2
2026/01/01 22:17:16 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:16 [broadcastToRoom] 📢 向房间 cafc97b6-3fbf-438f-8be5-8289045784b5 的 1 个客户端广播消息类型: member_update
2026/01/01 22:17:17 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:17:17 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:17 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:17:17 [broadcastToRoom] ENTER | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 type=mic_on
2026/01/01 22:17:17 [broadcastToRoom] 准备获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:17 [broadcastToRoom] 已获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:17 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 roomSize=2
2026/01/01 22:17:17 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:17 [broadcastToRoom] 📢 向房间 cafc97b6-3fbf-438f-8be5-8289045784b5 的 1 个客户端广播消息类型: mic_on
2026/01/01 22:17:17 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:17:17 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:17 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:17:17 [broadcastToRoom] ENTER | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 type=mic_on
2026/01/01 22:17:17 [broadcastToRoom] 准备获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:17 [broadcastToRoom] 已获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:17 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 roomSize=2
2026/01/01 22:17:17 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:17 [broadcastToRoom] 📢 向房间 cafc97b6-3fbf-438f-8be5-8289045784b5 的 1 个客户端广播消息类型: mic_on
2026/01/01 22:17:18 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:17:18 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:18 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2026/01/01 22:17:18 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2026/01/01 22:17:18 [ReadPump] 房间ID: cafc97b6-3fbf-438f-8be5-8289045784b5, 准备广播给房间内其他成员
2026/01/01 22:17:18 [ReadPump] 已添加 username 到 Data: 小东
2026/01/01 22:17:18 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:17:18 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:17:18 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:17:18 [ReadPump] 准备调用 broadcastToRoom，房间ID: cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:18 [broadcastToRoom] ENTER | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 type=mic_request
2026/01/01 22:17:18 [broadcastToRoom] 准备获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:18 [broadcastToRoom] 已获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:18 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 roomSize=2
2026/01/01 22:17:18 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:18 [broadcastToRoom] 📢 向房间 cafc97b6-3fbf-438f-8be5-8289045784b5 的 1 个客户端广播消息类型: mic_request
2026/01/01 22:17:18 [ReadPump] ✅ 连麦申请已广播给房间 cafc97b6-3fbf-438f-8be5-8289045784b5 的其他成员
2026/01/01 22:17:20 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:17:20 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:20 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2026/01/01 22:17:20 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2026/01/01 22:17:20 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:cafc97b6-3fbf-438f-8be5-8289045784b5 UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:map[room_id:cafc97b6-3fbf-438f-8be5-8289045784b5 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa] Timestamp:1767277040}
2026/01/01 22:17:20 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:cafc97b6-3fbf-438f-8be5-8289045784b5 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/01 22:17:20 [ReadPump] Data 是 map，内容: map[room_id:cafc97b6-3fbf-438f-8be5-8289045784b5 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/01 22:17:20 [ReadPump] Data 中的所有键: [target_user_id user_id room_id]
2026/01/01 22:17:20 [ReadPump] ✅ 找到 target_user_id: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2026/01/01 22:17:20 [ReadPump] 准备发送 mic_approved 给用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (房间 cafc97b6-3fbf-438f-8be5-8289045784b5)
2026/01/01 22:17:20 [broadcastToRoom] ENTER | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 type=mic_approved
2026/01/01 22:17:20 [broadcastToRoom] 准备获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:20 [broadcastToRoom] 已获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:20 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 roomSize=2
2026/01/01 22:17:20 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:20 [broadcastToRoom] 📢 向房间 cafc97b6-3fbf-438f-8be5-8289045784b5 的 1 个客户端广播消息类型: mic_approved
2026/01/01 22:17:20 [ReadPump] ✅ mic_approved 已广播给房间 cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:21 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:17:21 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:21 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_on'
2026/01/01 22:17:21 [broadcastToRoom] ENTER | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 type=mic_on
2026/01/01 22:17:21 [broadcastToRoom] 准备获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:21 [broadcastToRoom] 已获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:21 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 roomSize=2
2026/01/01 22:17:21 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:17:21 [broadcastToRoom] 📢 向房间 cafc97b6-3fbf-438f-8be5-8289045784b5 的 1 个客户端广播消息类型: mic_on
2026/01/01 22:17:21 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:17:21 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","offer":{"sdp":"v=0\r\no=- 7782785249192200 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS a3a33e11-00bd-4f85-b739-d1bf9c14ef22\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:PdGj\r\na=ice-pwd:VOZSxHksAzeX+2iO4NVStVjE\r\na=ice-options:trickle\r\na=fingerprint:sha-256 FA:49:C9:DB:20:98:A6:16:B4:BE:D2:E2:22:97:51:B0:94:CE:3B:D2:A5:C6:21:22:FD:11:68:FC:24:6A:2A:7E\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:a3a33e11-00bd-4f85-b739-d1bf9c14ef22 25b30a40-0f69-42b1-8d5f-55405d80a8ba\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:2041212252 cname:HWT4IreBesZhbyey\r\na=ssrc:2041212252 msid:a3a33e11-00bd-4f85-b739-d1bf9c14ef22 25b30a40-0f69-42b1-8d5f-55405d80a8ba\r\n","type":"offer"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:21 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_offer'
2026/01/01 22:17:21 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:17:21 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:395662440 1 udp 2122194687 192.168.1.5 50823 typ host generation 0 ufrag PdGj network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"PdGj"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:21 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:17:21 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:17:21 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:982643155 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 61691 typ host generation 0 ufrag PdGj network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"PdGj"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:21 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:17:21 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:17:21 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:3913253116 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag PdGj network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"PdGj"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:21 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:17:21 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:17:21 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:3292210503 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag PdGj network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"PdGj"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:21 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:17:21 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:17:21 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:1466902209 1 udp 1685987071 117.129.35.233 22401 typ srflx raddr 192.168.1.5 rport 50823 generation 0 ufrag PdGj network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"PdGj"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:21 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:17:22 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:17:22 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 2235829370151478182 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS ce2517aa-2175-4877-bfdf-a593eb4b9749\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:Foiy\r\na=ice-pwd:4eUvFe2aja+5wuWlSELbvLlN\r\na=ice-options:trickle\r\na=fingerprint:sha-256 CD:8E:D8:F9:16:D4:8D:80:B3:91:99:C5:DB:7F:52:4F:6A:0A:F7:C1:E4:AF:A7:69:8B:A5:A6:21:65:A9:0F:54\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:ce2517aa-2175-4877-bfdf-a593eb4b9749 daee6e53-0d51-42c9-81d8-f15752c7e5f3\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:391114544 cname:IXKnNQ5YnmT+0AxV\r\na=ssrc:391114544 msid:ce2517aa-2175-4877-bfdf-a593eb4b9749 daee6e53-0d51-42c9-81d8-f15752c7e5f3\r\n","type":"offer"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:22 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/01 22:17:22 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:17:22 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 1700139376668937345 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS ce2517aa-2175-4877-bfdf-a593eb4b9749\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:LZay\r\na=ice-pwd:DvFlSe2y+vNlOX3rzoQwZ/UL\r\na=ice-options:trickle\r\na=fingerprint:sha-256 8C:BA:BC:29:37:2F:36:4B:2C:DB:A4:E1:DB:2C:37:02:4E:92:AA:3E:E5:52:31:26:E7:9F:48:4F:56:E3:5C:98\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:ce2517aa-2175-4877-bfdf-a593eb4b9749 daee6e53-0d51-42c9-81d8-f15752c7e5f3\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:3101513251 cname:DvRq2pbGL3TC7uIO\r\na=ssrc:3101513251 msid:ce2517aa-2175-4877-bfdf-a593eb4b9749 daee6e53-0d51-42c9-81d8-f15752c7e5f3\r\n","type":"offer"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:22 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/01 22:17:22 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:17:22 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:230656603 1 udp 2122194687 192.168.1.5 62447 typ host generation 0 ufrag Foiy network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Foiy"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:22 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:17:22 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:17:22 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:200653988 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 61588 typ host generation 0 ufrag Foiy network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Foiy"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:22 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:17:22 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:17:22 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:856315798 1 udp 2122194687 192.168.1.5 55978 typ host generation 0 ufrag LZay network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"LZay"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:22 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:17:22 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:17:22 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:504295981 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 52059 typ host generation 0 ufrag LZay network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"LZay"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:22 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:17:22 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:17:22 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1936746691 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag Foiy network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Foiy"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:22 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:17:22 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:17:22 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1966759484 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag Foiy network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Foiy"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:22 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:17:22 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:17:22 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3449848578 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag LZay network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"LZay"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:22 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:17:22 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:17:22 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3768854201 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag LZay network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"LZay"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:22 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:17:22 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:17:22 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:684082609 1 udp 1685987071 117.129.35.233 22402 typ srflx raddr 192.168.1.5 rport 62447 generation 0 ufrag Foiy network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Foiy"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:22 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:17:22 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:17:22 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1945118015 1 udp 1685987071 117.129.35.233 22403 typ srflx raddr 192.168.1.5 rport 55978 generation 0 ufrag LZay network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"LZay"},"room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:17:22 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:36:54 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: cafc97b6-3fbf-438f-8be5-8289045784b5, 连接指针: 0x1400019d4a0
2026/01/01 22:36:54 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 cafc97b6-3fbf-438f-8be5-8289045784b5 的消息，连接指针: 0x1400019d4a0
2026/01/01 22:36:54 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:36:54 [Register] 房间 cafc97b6-3fbf-438f-8be5-8289045784b5 当前没有已上麦用户
2026/01/01 22:36:54 [broadcastToRoom] ENTER | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 type=member_update
2026/01/01 22:36:54 [broadcastToRoom] 准备获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:36:54 [broadcastToRoom] 已获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:36:54 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 roomSize=1
2026/01/01 22:36:54 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:36:54 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:36:56 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:36:56 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"cafc97b6-3fbf-438f-8be5-8289045784b5"}}
2026/01/01 22:36:56 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2026/01/01 22:36:56 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2026/01/01 22:36:56 [ReadPump] 房间ID: cafc97b6-3fbf-438f-8be5-8289045784b5, 准备广播给房间内其他成员
2026/01/01 22:36:56 [ReadPump] 已添加 username 到 Data: 小东
2026/01/01 22:36:56 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:36:56 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:36:56 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:36:56 [ReadPump] 准备调用 broadcastToRoom，房间ID: cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:36:56 [broadcastToRoom] ENTER | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 type=mic_request
2026/01/01 22:36:56 [broadcastToRoom] 准备获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:36:56 [broadcastToRoom] 已获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:36:56 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 roomSize=1
2026/01/01 22:36:56 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:36:56 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:36:56 [ReadPump] ✅ 连麦申请已广播给房间 cafc97b6-3fbf-438f-8be5-8289045784b5 的其他成员
2026/01/01 22:37:04 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: cafc97b6-3fbf-438f-8be5-8289045784b5): websocket: close 1005 (no status)
2026/01/01 22:37:04 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: cafc97b6-3fbf-438f-8be5-8289045784b5, 连接指针: 0x1400019d4a0
2026/01/01 22:37:04 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:37:04 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/01 22:37:04 [Unregister] 房间 cafc97b6-3fbf-438f-8be5-8289045784b5 清理客户端后，剩余成员数: 0, shouldDeleteRoom: true
2026/01/01 22:37:04 [Unregister] 房间 cafc97b6-3fbf-438f-8be5-8289045784b5 已删除（没有在线成员）
2026/01/01 22:37:04 [broadcastToRoom] ENTER | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 type=member_update
2026/01/01 22:37:04 [broadcastToRoom] 准备获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:37:04 [broadcastToRoom] 已获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:37:04 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:37:04 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2026/01/01 22:37:04 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:37:04 [broadcastToRoom] ENTER | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5 type=room_deleted
2026/01/01 22:37:04 [broadcastToRoom] 准备获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:37:04 [broadcastToRoom] 已获取 RLock | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:37:04 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=cafc97b6-3fbf-438f-8be5-8289045784b5
2026/01/01 22:37:04 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/01 22:37:14 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2026/01/01 22:37:14 [broadcastToRoom] ENTER | roomID=global type=room_created
2026/01/01 22:37:14 [broadcastToRoom] 准备获取 RLock | roomID=global
2026/01/01 22:37:14 [broadcastToRoom] 已获取 RLock | roomID=global
2026/01/01 22:37:14 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=global
2026/01/01 22:37:14 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/01 22:37:14 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:14 [Register] 房间 0427bfae-bb44-48b1-8790-c30131567080 当前没有已上麦用户
2026/01/01 22:37:14 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=member_update
2026/01/01 22:37:14 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:14 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:14 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 0427bfae-bb44-48b1-8790-c30131567080, 连接指针: 0x140003686c0
2026/01/01 22:37:14 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 0427bfae-bb44-48b1-8790-c30131567080 的消息，连接指针: 0x140003686c0
2026/01/01 22:37:14 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=0427bfae-bb44-48b1-8790-c30131567080 roomSize=1
2026/01/01 22:37:14 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:14 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:14 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:37:14 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:14 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:37:14 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=mic_on
2026/01/01 22:37:14 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:14 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:14 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=0427bfae-bb44-48b1-8790-c30131567080 roomSize=1
2026/01/01 22:37:14 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:14 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:14 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:37:14 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:14 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:37:14 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=mic_on
2026/01/01 22:37:14 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:14 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:14 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=0427bfae-bb44-48b1-8790-c30131567080 roomSize=1
2026/01/01 22:37:14 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:14 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:19 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:19 [Register] 房间 0427bfae-bb44-48b1-8790-c30131567080 当前已上麦用户: [1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/01 22:37:19 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 0427bfae-bb44-48b1-8790-c30131567080, 连接指针: 0x140000adda0
2026/01/01 22:37:19 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 0427bfae-bb44-48b1-8790-c30131567080 的消息，连接指针: 0x140000adda0
2026/01/01 22:37:19 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=member_update
2026/01/01 22:37:19 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:19 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:19 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=0427bfae-bb44-48b1-8790-c30131567080 roomSize=2
2026/01/01 22:37:19 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:19 [broadcastToRoom] 📢 向房间 0427bfae-bb44-48b1-8790-c30131567080 的 1 个客户端广播消息类型: member_update
2026/01/01 22:37:19 [Register] 准备向新用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 发送当前已上麦用户信息: [1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/01 22:37:19 [Register] ✅ 已向新用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 发送用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的上麦信息
2026/01/01 22:37:19 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:37:19 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:19 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:37:19 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=mic_on
2026/01/01 22:37:19 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:19 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:19 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=0427bfae-bb44-48b1-8790-c30131567080 roomSize=2
2026/01/01 22:37:19 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:19 [broadcastToRoom] 📢 向房间 0427bfae-bb44-48b1-8790-c30131567080 的 1 个客户端广播消息类型: mic_on
2026/01/01 22:37:20 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:37:20 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:20 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:37:20 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=mic_on
2026/01/01 22:37:20 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:20 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:20 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=0427bfae-bb44-48b1-8790-c30131567080 roomSize=2
2026/01/01 22:37:20 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:20 [broadcastToRoom] 📢 向房间 0427bfae-bb44-48b1-8790-c30131567080 的 1 个客户端广播消息类型: mic_on
2026/01/01 22:37:20 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:37:20 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:20 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2026/01/01 22:37:20 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2026/01/01 22:37:20 [ReadPump] 房间ID: 0427bfae-bb44-48b1-8790-c30131567080, 准备广播给房间内其他成员
2026/01/01 22:37:20 [ReadPump] 已添加 username 到 Data: 小东
2026/01/01 22:37:20 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:37:20 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:37:20 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:37:20 [ReadPump] 准备调用 broadcastToRoom，房间ID: 0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:20 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=mic_request
2026/01/01 22:37:20 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:20 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:20 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=0427bfae-bb44-48b1-8790-c30131567080 roomSize=2
2026/01/01 22:37:20 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:20 [broadcastToRoom] 📢 向房间 0427bfae-bb44-48b1-8790-c30131567080 的 1 个客户端广播消息类型: mic_request
2026/01/01 22:37:20 [ReadPump] ✅ 连麦申请已广播给房间 0427bfae-bb44-48b1-8790-c30131567080 的其他成员
2026/01/01 22:37:23 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:37:23 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:23 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2026/01/01 22:37:23 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2026/01/01 22:37:23 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:0427bfae-bb44-48b1-8790-c30131567080 UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:map[room_id:0427bfae-bb44-48b1-8790-c30131567080 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa] Timestamp:1767278243}
2026/01/01 22:37:23 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:0427bfae-bb44-48b1-8790-c30131567080 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/01 22:37:23 [ReadPump] Data 是 map，内容: map[room_id:0427bfae-bb44-48b1-8790-c30131567080 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/01 22:37:23 [ReadPump] Data 中的所有键: [room_id target_user_id user_id]
2026/01/01 22:37:23 [ReadPump] ✅ 找到 target_user_id: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2026/01/01 22:37:23 [ReadPump] 准备发送 mic_approved 给用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (房间 0427bfae-bb44-48b1-8790-c30131567080)
2026/01/01 22:37:23 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=mic_approved
2026/01/01 22:37:23 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:23 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:23 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=0427bfae-bb44-48b1-8790-c30131567080 roomSize=2
2026/01/01 22:37:23 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:23 [broadcastToRoom] 📢 向房间 0427bfae-bb44-48b1-8790-c30131567080 的 1 个客户端广播消息类型: mic_approved
2026/01/01 22:37:23 [ReadPump] ✅ mic_approved 已广播给房间 0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:24 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:37:24 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:24 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_on'
2026/01/01 22:37:24 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=mic_on
2026/01/01 22:37:24 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:24 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:24 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=0427bfae-bb44-48b1-8790-c30131567080 roomSize=2
2026/01/01 22:37:24 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:37:24 [broadcastToRoom] 📢 向房间 0427bfae-bb44-48b1-8790-c30131567080 的 1 个客户端广播消息类型: mic_on
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","offer":{"sdp":"v=0\r\no=- 7135852959033013446 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS f44df596-90a2-4f08-bbc0-634022968d3e\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:ekQc\r\na=ice-pwd:8HD+FQJ+Ave8n5J/4PTz3Q1D\r\na=ice-options:trickle\r\na=fingerprint:sha-256 C8:C3:D7:08:CE:8D:0B:C4:F0:69:EF:57:73:7C:C0:26:D5:B9:49:D3:57:7C:25:3B:AA:4E:85:A6:D7:20:17:A9\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:f44df596-90a2-4f08-bbc0-634022968d3e 4c199bad-9a99-4325-9136-34ffcc64cc95\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:2819931224 cname:7ifYJclaJHFeJsdz\r\na=ssrc:2819931224 msid:f44df596-90a2-4f08-bbc0-634022968d3e 4c199bad-9a99-4325-9136-34ffcc64cc95\r\n","type":"offer"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_offer'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:1869319717 1 udp 2122194687 192.168.1.5 62107 typ host generation 0 ufrag ekQc network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"ekQc"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:1763817690 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 50895 typ host generation 0 ufrag ekQc network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"ekQc"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:295988413 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag ekQc network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"ekQc"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:401496642 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag ekQc network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"ekQc"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 2438057796349754342 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 4cd54d74-fe5a-4963-bc5c-eb0cefb56e92\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:DKra\r\na=ice-pwd:bQqLkjBid19p/gf5DjN7Aztn\r\na=ice-options:trickle\r\na=fingerprint:sha-256 4D:F4:E4:23:63:FB:4D:2B:44:FB:8A:C2:43:65:E7:00:28:E8:1B:B5:89:C7:28:97:D4:EC:75:EB:EF:76:38:20\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:4cd54d74-fe5a-4963-bc5c-eb0cefb56e92 4b276971-1f74-4004-be76-e197afccbd22\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:646707941 cname:xP1NRktTcSNAJDBe\r\na=ssrc:646707941 msid:4cd54d74-fe5a-4963-bc5c-eb0cefb56e92 4b276971-1f74-4004-be76-e197afccbd22\r\n","type":"offer"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 8571004584772296877 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 4cd54d74-fe5a-4963-bc5c-eb0cefb56e92\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:mTK+\r\na=ice-pwd:1enLu1F/oV/QeIdz10eDYzwY\r\na=ice-options:trickle\r\na=fingerprint:sha-256 3E:AD:2C:1B:12:E4:D1:41:B5:3A:05:67:09:78:DD:15:F4:B6:79:12:30:72:BB:45:4C:FE:DE:CD:ED:B6:29:70\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:4cd54d74-fe5a-4963-bc5c-eb0cefb56e92 4b276971-1f74-4004-be76-e197afccbd22\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:3995935946 cname:736TK+ZCFbSIbV+1\r\na=ssrc:3995935946 msid:4cd54d74-fe5a-4963-bc5c-eb0cefb56e92 4b276971-1f74-4004-be76-e197afccbd22\r\n","type":"offer"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:335026711 1 udp 2122194687 192.168.1.5 65313 typ host generation 0 ufrag DKra network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"DKra"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:363998440 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 55130 typ host generation 0 ufrag DKra network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"DKra"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:222335869 1 udp 2122194687 192.168.1.5 56917 typ host generation 0 ufrag mTK+ network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"mTK+"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:185247106 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 50230 typ host generation 0 ufrag mTK+ network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"mTK+"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1832384655 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag DKra network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"DKra"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1803406960 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag DKra network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"DKra"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1938780645 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag mTK+ network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"mTK+"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1975863066 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag mTK+ network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"mTK+"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:1242710479 1 udp 1685987071 117.129.35.233 22248 typ srflx raddr 192.168.1.5 rport 62107 generation 0 ufrag ekQc network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"ekQc"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:674847895 1 udp 1685987071 117.129.35.233 22249 typ srflx raddr 192.168.1.5 rport 56917 generation 0 ufrag mTK+ network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"mTK+"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:37:25 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:37:25 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:914478589 1 udp 1685987071 117.129.35.233 22250 typ srflx raddr 192.168.1.5 rport 65313 generation 0 ufrag DKra network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"DKra"},"room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:37:25 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:39:23 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:39:23 [ReadPump] 消息内容: {"type":"mic_mute","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"0427bfae-bb44-48b1-8790-c30131567080","muted":true}}
2026/01/01 22:39:23 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_mute'
2026/01/01 22:39:23 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=mic_mute
2026/01/01 22:39:23 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:39:23 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:39:23 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=0427bfae-bb44-48b1-8790-c30131567080 roomSize=2
2026/01/01 22:39:23 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:39:23 [broadcastToRoom] 📢 向房间 0427bfae-bb44-48b1-8790-c30131567080 的 1 个客户端广播消息类型: mic_mute
2026/01/01 22:39:25 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:39:25 [ReadPump] 消息内容: {"type":"mic_mute","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"0427bfae-bb44-48b1-8790-c30131567080","muted":false}}
2026/01/01 22:39:25 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_mute'
2026/01/01 22:39:25 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=mic_mute
2026/01/01 22:39:25 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:39:25 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:39:25 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=0427bfae-bb44-48b1-8790-c30131567080 roomSize=2
2026/01/01 22:39:25 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:39:25 [broadcastToRoom] 📢 向房间 0427bfae-bb44-48b1-8790-c30131567080 的 1 个客户端广播消息类型: mic_mute
2026/01/01 22:39:29 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:39:29 [ReadPump] 消息内容: {"type":"mic_mute","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"0427bfae-bb44-48b1-8790-c30131567080","muted":true}}
2026/01/01 22:39:29 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_mute'
2026/01/01 22:39:29 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=mic_mute
2026/01/01 22:39:29 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:39:29 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:39:29 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=0427bfae-bb44-48b1-8790-c30131567080 roomSize=2
2026/01/01 22:39:29 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:39:29 [broadcastToRoom] 📢 向房间 0427bfae-bb44-48b1-8790-c30131567080 的 1 个客户端广播消息类型: mic_mute
2026/01/01 22:39:35 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:39:35 [ReadPump] 消息内容: {"type":"mic_mute","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"0427bfae-bb44-48b1-8790-c30131567080","muted":false}}
2026/01/01 22:39:35 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_mute'
2026/01/01 22:39:35 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=mic_mute
2026/01/01 22:39:35 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:39:35 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:39:35 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=0427bfae-bb44-48b1-8790-c30131567080 roomSize=2
2026/01/01 22:39:35 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:39:35 [broadcastToRoom] 📢 向房间 0427bfae-bb44-48b1-8790-c30131567080 的 1 个客户端广播消息类型: mic_mute
2026/01/01 22:41:08 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 0427bfae-bb44-48b1-8790-c30131567080): websocket: close 1005 (no status)
2026/01/01 22:41:08 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 0427bfae-bb44-48b1-8790-c30131567080, 连接指针: 0x140000adda0
2026/01/01 22:41:09 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:09 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/01 22:41:09 [Unregister] 房间 0427bfae-bb44-48b1-8790-c30131567080 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2026/01/01 22:41:09 [Unregister] 房间 0427bfae-bb44-48b1-8790-c30131567080 保留（还有 1 个在线成员）
2026/01/01 22:41:09 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=member_update
2026/01/01 22:41:09 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:09 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:09 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=0427bfae-bb44-48b1-8790-c30131567080 roomSize=1
2026/01/01 22:41:09 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:09 [broadcastToRoom] 📢 向房间 0427bfae-bb44-48b1-8790-c30131567080 的 1 个客户端广播消息类型: member_update
2026/01/01 22:41:09 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2026/01/01 22:41:09 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:41:09 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:41:09 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:41:09 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=mic_on
2026/01/01 22:41:09 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:09 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:09 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=0427bfae-bb44-48b1-8790-c30131567080 roomSize=1
2026/01/01 22:41:09 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:09 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:09 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:41:09 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"0427bfae-bb44-48b1-8790-c30131567080"}}
2026/01/01 22:41:09 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:41:09 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=mic_on
2026/01/01 22:41:09 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:09 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:09 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=0427bfae-bb44-48b1-8790-c30131567080 roomSize=1
2026/01/01 22:41:09 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:09 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:15 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 0427bfae-bb44-48b1-8790-c30131567080): websocket: close 1005 (no status)
2026/01/01 22:41:15 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 0427bfae-bb44-48b1-8790-c30131567080, 连接指针: 0x140003686c0
2026/01/01 22:41:15 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:15 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/01 22:41:15 [Unregister] 房间 0427bfae-bb44-48b1-8790-c30131567080 清理客户端后，剩余成员数: 0, shouldDeleteRoom: true
2026/01/01 22:41:15 [Unregister] 房间 0427bfae-bb44-48b1-8790-c30131567080 已删除（没有在线成员）
2026/01/01 22:41:15 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=member_update
2026/01/01 22:41:15 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:15 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:15 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:15 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): Hub 关闭了发送通道
2026/01/01 22:41:15 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: 0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:15 [broadcastToRoom] ENTER | roomID=0427bfae-bb44-48b1-8790-c30131567080 type=room_deleted
2026/01/01 22:41:15 [broadcastToRoom] 准备获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:15 [broadcastToRoom] 已获取 RLock | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:15 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=0427bfae-bb44-48b1-8790-c30131567080
2026/01/01 22:41:15 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/01 22:41:19 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/01 22:41:19 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005a0420
2026/01/01 22:41:19 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005a0420
2026/01/01 22:41:19 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005a0420
2026/01/01 22:41:19 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302cc0
2026/01/01 22:41:19 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/01 22:41:19 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140005a0420, 新连接: 0x14000302cc0
2026/01/01 22:41:19 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/01 22:41:19 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000302cc0
2026/01/01 22:41:19 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000302cc0
2026/01/01 22:41:20 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/01 22:41:20 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005a0420
2026/01/01 22:41:20 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/01 22:41:23 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2026/01/01 22:41:23 [broadcastToRoom] ENTER | roomID=global type=room_created
2026/01/01 22:41:23 [broadcastToRoom] 准备获取 RLock | roomID=global
2026/01/01 22:41:23 [broadcastToRoom] 已获取 RLock | roomID=global
2026/01/01 22:41:23 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=global roomSize=2
2026/01/01 22:41:23 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=global
2026/01/01 22:41:23 [broadcastToRoom] 📢 向房间 global 的 2 个客户端广播消息类型: room_created
2026/01/01 22:41:23 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2026/01/01 22:41:23 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/01 22:41:23 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:23 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x14000302cc0, 新连接: 0x140000dd320
2026/01/01 22:41:23 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/01 22:41:23 [Register] 房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 当前没有已上麦用户
2026/01/01 22:41:23 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=member_update
2026/01/01 22:41:23 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716, 连接指针: 0x140000dd320
2026/01/01 22:41:23 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:23 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:23 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=1
2026/01/01 22:41:23 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:23 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:23 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的消息，连接指针: 0x140000dd320
2026/01/01 22:41:24 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:41:24 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:24 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:41:24 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=mic_on
2026/01/01 22:41:24 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:24 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:24 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=1
2026/01/01 22:41:24 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:24 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:24 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:41:24 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:24 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:41:24 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=mic_on
2026/01/01 22:41:24 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:24 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:24 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=1
2026/01/01 22:41:24 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:24 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:26 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000dd380
2026/01/01 22:41:26 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140000dd380
2026/01/01 22:41:26 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/01 22:41:26 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x140000dd380
2026/01/01 22:41:26 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000dd7a0
2026/01/01 22:41:26 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140000dd7a0
2026/01/01 22:41:26 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/01 22:41:26 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x140000dd380, 新连接: 0x140000dd7a0
2026/01/01 22:41:26 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2026/01/01 22:41:26 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x140000dd7a0
2026/01/01 22:41:26 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2026/01/01 22:41:26 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000dd380
2026/01/01 22:41:26 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/01 22:41:27 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:27 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716, 连接指针: 0x1400019d7a0
2026/01/01 22:41:27 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的消息，连接指针: 0x1400019d7a0
2026/01/01 22:41:27 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x140000dd7a0, 新连接: 0x1400019d7a0
2026/01/01 22:41:27 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2026/01/01 22:41:27 [Register] 房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 当前已上麦用户: [1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/01 22:41:27 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=member_update
2026/01/01 22:41:27 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:27 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:27 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/01 22:41:27 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:27 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: member_update
2026/01/01 22:41:27 [Register] 准备向新用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 发送当前已上麦用户信息: [1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/01 22:41:27 [Register] ✅ 已向新用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 发送用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的上麦信息
2026/01/01 22:41:28 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:41:28 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:28 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:41:28 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=mic_on
2026/01/01 22:41:28 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:28 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:28 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/01 22:41:28 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:28 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: mic_on
2026/01/01 22:41:28 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:41:28 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:28 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:41:28 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=mic_on
2026/01/01 22:41:28 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:28 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:28 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/01 22:41:28 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:28 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: mic_on
2026/01/01 22:41:30 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:41:30 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:30 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2026/01/01 22:41:30 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2026/01/01 22:41:30 [ReadPump] 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716, 准备广播给房间内其他成员
2026/01/01 22:41:30 [ReadPump] 已添加 username 到 Data: 小东
2026/01/01 22:41:30 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:41:30 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:41:30 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:41:30 [ReadPump] 准备调用 broadcastToRoom，房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:30 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=mic_request
2026/01/01 22:41:30 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:30 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:30 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/01 22:41:30 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:30 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: mic_request
2026/01/01 22:41:30 [ReadPump] ✅ 连麦申请已广播给房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的其他成员
2026/01/01 22:41:32 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:41:32 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:32 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2026/01/01 22:41:32 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2026/01/01 22:41:32 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:map[room_id:4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa] Timestamp:1767278492}
2026/01/01 22:41:32 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/01 22:41:32 [ReadPump] Data 是 map，内容: map[room_id:4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/01 22:41:32 [ReadPump] Data 中的所有键: [target_user_id user_id room_id]
2026/01/01 22:41:32 [ReadPump] ✅ 找到 target_user_id: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2026/01/01 22:41:32 [ReadPump] 准备发送 mic_approved 给用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716)
2026/01/01 22:41:32 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=mic_approved
2026/01/01 22:41:32 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:32 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:32 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/01 22:41:32 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:32 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: mic_approved
2026/01/01 22:41:32 [ReadPump] ✅ mic_approved 已广播给房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_on'
2026/01/01 22:41:33 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=mic_on
2026/01/01 22:41:33 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:33 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:33 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/01 22:41:33 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/01 22:41:33 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: mic_on
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","offer":{"sdp":"v=0\r\no=- 7758694274347401067 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 7866dfff-cfa5-49c8-86b3-a4460ecd985a\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:3h1H\r\na=ice-pwd:+0fTz2Q0w6fQgMFQZRmYwiQ8\r\na=ice-options:trickle\r\na=fingerprint:sha-256 49:1C:D3:46:BE:65:A1:85:DE:0D:FB:69:D9:C4:36:F7:50:83:A4:B0:BB:39:9D:4D:F0:B4:AB:46:92:AF:4A:01\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:7866dfff-cfa5-49c8-86b3-a4460ecd985a 4b8d2e06-14a6-44b3-b2e0-359bc8e99a95\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:214975256 cname:giC6wVRr6LOfoB9t\r\na=ssrc:214975256 msid:7866dfff-cfa5-49c8-86b3-a4460ecd985a 4b8d2e06-14a6-44b3-b2e0-359bc8e99a95\r\n","type":"offer"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_offer'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:1193545512 1 udp 2122194687 192.168.1.5 59566 typ host generation 0 ufrag 3h1H network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"3h1H"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:1780525715 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 56423 typ host generation 0 ufrag 3h1H network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"3h1H"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:3113147324 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag 3h1H network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"3h1H"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:2492104199 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag 3h1H network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"3h1H"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:132021633 1 udp 1685987071 117.129.35.233 22430 typ srflx raddr 192.168.1.5 rport 59566 generation 0 ufrag 3h1H network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"3h1H"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 3567740016943885088 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS d6640c4a-4bef-454b-b4b6-5446aa4c4b6e\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:GvSe\r\na=ice-pwd:/Cj4iE40efiz/al/JOhXBLoO\r\na=ice-options:trickle\r\na=fingerprint:sha-256 9A:12:82:04:B1:FC:67:77:37:C7:14:69:DC:31:92:1C:A9:E7:FA:A7:01:EB:94:92:E0:0A:3E:56:D0:11:B1:90\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:d6640c4a-4bef-454b-b4b6-5446aa4c4b6e 39e0720c-0c5b-40eb-b521-dcd82945d1d6\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:1936736501 cname:/6KvT6cfXGlwA7SM\r\na=ssrc:1936736501 msid:d6640c4a-4bef-454b-b4b6-5446aa4c4b6e 39e0720c-0c5b-40eb-b521-dcd82945d1d6\r\n","type":"offer"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 2683802611525494199 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS d6640c4a-4bef-454b-b4b6-5446aa4c4b6e\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:4aPn\r\na=ice-pwd:P7WBQzdIl9pAxP2IzCA8Ecx+\r\na=ice-options:trickle\r\na=fingerprint:sha-256 09:F3:EA:61:FE:48:9F:62:BB:A9:40:C3:D2:9D:D7:A0:45:AF:FE:8A:B1:0F:2F:58:2E:B5:7C:61:78:AE:E2:3D\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:d6640c4a-4bef-454b-b4b6-5446aa4c4b6e 39e0720c-0c5b-40eb-b521-dcd82945d1d6\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:704058666 cname:13RlGCuElyHoOQN4\r\na=ssrc:704058666 msid:d6640c4a-4bef-454b-b4b6-5446aa4c4b6e 39e0720c-0c5b-40eb-b521-dcd82945d1d6\r\n","type":"offer"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1631874441 1 udp 2122194687 192.168.1.5 60250 typ host generation 0 ufrag GvSe network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"GvSe"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1279313970 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 52412 typ host generation 0 ufrag GvSe network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"GvSe"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3948274942 1 udp 2122194687 192.168.1.5 58692 typ host generation 0 ufrag 4aPn network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"4aPn"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3327213893 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 49728 typ host generation 0 ufrag 4aPn network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"4aPn"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2880411223 1 udp 1685987071 117.129.35.233 22432 typ srflx raddr 192.168.1.5 rport 58692 generation 0 ufrag 4aPn network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"4aPn"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2683222301 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag GvSe network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"GvSe"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3001687206 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag GvSe network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"GvSe"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:369045610 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag 4aPn network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"4aPn"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:956011985 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag 4aPn network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"4aPn"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:41:33 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:41:33 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:566107936 1 udp 1685987071 117.129.35.233 22431 typ srflx raddr 192.168.1.5 rport 60250 generation 0 ufrag GvSe network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"GvSe"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/01 22:41:33 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:42:20 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2026/01/01 22:48:39 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2026/01/01 22:48:39 [broadcastToRoom] ENTER | roomID=global type=room_created
2026/01/01 22:48:39 [broadcastToRoom] 准备获取 RLock | roomID=global
2026/01/01 22:48:39 [broadcastToRoom] 已获取 RLock | roomID=global
2026/01/01 22:48:39 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=global
2026/01/01 22:48:39 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/01 22:48:39 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:39 [Register] 房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32 当前没有已上麦用户
2026/01/01 22:48:39 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: e696fa9b-55e6-4759-a63a-b3acbc6b6b32, 连接指针: 0x140000adc20
2026/01/01 22:48:39 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32 的消息，连接指针: 0x140000adc20
2026/01/01 22:48:39 [broadcastToRoom] ENTER | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 type=member_update
2026/01/01 22:48:39 [broadcastToRoom] 准备获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:39 [broadcastToRoom] 已获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:39 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 roomSize=1
2026/01/01 22:48:39 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:39 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:40 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:48:40 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:40 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:48:40 [broadcastToRoom] ENTER | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 type=mic_on
2026/01/01 22:48:40 [broadcastToRoom] 准备获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:40 [broadcastToRoom] 已获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:40 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 roomSize=1
2026/01/01 22:48:40 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:40 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:40 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:48:40 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:40 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:48:40 [broadcastToRoom] ENTER | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 type=mic_on
2026/01/01 22:48:40 [broadcastToRoom] 准备获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:40 [broadcastToRoom] 已获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:40 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 roomSize=1
2026/01/01 22:48:40 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:40 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:47 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x1400020dce0
2026/01/01 22:48:47 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/01 22:48:47 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x1400020dce0
2026/01/01 22:48:47 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x1400020dce0
2026/01/01 22:48:47 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140004156e0
2026/01/01 22:48:47 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/01 22:48:47 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x1400020dce0, 新连接: 0x140004156e0
2026/01/01 22:48:47 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2026/01/01 22:48:47 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x140004156e0
2026/01/01 22:48:47 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140004156e0
2026/01/01 22:48:47 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2026/01/01 22:48:47 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x1400020dce0
2026/01/01 22:48:47 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/01 22:48:48 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:48 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x140004156e0, 新连接: 0x1400020d020
2026/01/01 22:48:48 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: e696fa9b-55e6-4759-a63a-b3acbc6b6b32, 连接指针: 0x1400020d020
2026/01/01 22:48:48 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2026/01/01 22:48:48 [Register] 房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32 当前已上麦用户: [1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/01 22:48:48 [broadcastToRoom] ENTER | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 type=member_update
2026/01/01 22:48:48 [broadcastToRoom] 准备获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:48 [broadcastToRoom] 已获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:48 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 roomSize=2
2026/01/01 22:48:48 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32 的消息，连接指针: 0x1400020d020
2026/01/01 22:48:48 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:48 [broadcastToRoom] 📢 向房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32 的 1 个客户端广播消息类型: member_update
2026/01/01 22:48:48 [Register] 准备向新用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 发送当前已上麦用户信息: [1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/01 22:48:48 [Register] ✅ 已向新用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 发送用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的上麦信息
2026/01/01 22:48:49 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:48:49 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:49 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:48:49 [broadcastToRoom] ENTER | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 type=mic_on
2026/01/01 22:48:49 [broadcastToRoom] 准备获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:49 [broadcastToRoom] 已获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:49 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 roomSize=2
2026/01/01 22:48:49 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:49 [broadcastToRoom] 📢 向房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32 的 1 个客户端广播消息类型: mic_on
2026/01/01 22:48:49 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:48:49 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:49 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/01 22:48:49 [broadcastToRoom] ENTER | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 type=mic_on
2026/01/01 22:48:49 [broadcastToRoom] 准备获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:49 [broadcastToRoom] 已获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:49 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 roomSize=2
2026/01/01 22:48:49 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:49 [broadcastToRoom] 📢 向房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32 的 1 个客户端广播消息类型: mic_on
2026/01/01 22:48:51 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:48:51 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:51 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2026/01/01 22:48:51 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2026/01/01 22:48:51 [ReadPump] 房间ID: e696fa9b-55e6-4759-a63a-b3acbc6b6b32, 准备广播给房间内其他成员
2026/01/01 22:48:51 [ReadPump] 已添加 username 到 Data: 小东
2026/01/01 22:48:51 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:48:51 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:48:51 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/01 22:48:51 [ReadPump] 准备调用 broadcastToRoom，房间ID: e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:51 [broadcastToRoom] ENTER | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 type=mic_request
2026/01/01 22:48:51 [broadcastToRoom] 准备获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:51 [broadcastToRoom] 已获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:51 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 roomSize=2
2026/01/01 22:48:51 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:51 [broadcastToRoom] 📢 向房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32 的 1 个客户端广播消息类型: mic_request
2026/01/01 22:48:51 [ReadPump] ✅ 连麦申请已广播给房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32 的其他成员
2026/01/01 22:48:52 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:48:52 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:52 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2026/01/01 22:48:52 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2026/01/01 22:48:52 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:e696fa9b-55e6-4759-a63a-b3acbc6b6b32 UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:map[room_id:e696fa9b-55e6-4759-a63a-b3acbc6b6b32 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa] Timestamp:1767278932}
2026/01/01 22:48:52 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:e696fa9b-55e6-4759-a63a-b3acbc6b6b32 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/01 22:48:52 [ReadPump] Data 是 map，内容: map[room_id:e696fa9b-55e6-4759-a63a-b3acbc6b6b32 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/01 22:48:52 [ReadPump] Data 中的所有键: [target_user_id user_id room_id]
2026/01/01 22:48:52 [ReadPump] ✅ 找到 target_user_id: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2026/01/01 22:48:52 [ReadPump] 准备发送 mic_approved 给用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32)
2026/01/01 22:48:52 [broadcastToRoom] ENTER | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 type=mic_approved
2026/01/01 22:48:52 [broadcastToRoom] 准备获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:52 [broadcastToRoom] 已获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:52 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 roomSize=2
2026/01/01 22:48:52 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:52 [broadcastToRoom] 📢 向房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32 的 1 个客户端广播消息类型: mic_approved
2026/01/01 22:48:52 [ReadPump] ✅ mic_approved 已广播给房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:53 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:48:53 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:53 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_on'
2026/01/01 22:48:53 [broadcastToRoom] ENTER | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 type=mic_on
2026/01/01 22:48:53 [broadcastToRoom] 准备获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:53 [broadcastToRoom] 已获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:53 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 roomSize=2
2026/01/01 22:48:53 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/01 22:48:53 [broadcastToRoom] 📢 向房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32 的 1 个客户端广播消息类型: mic_on
2026/01/01 22:48:53 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:48:53 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","offer":{"sdp":"v=0\r\no=- 8831104805221453773 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 8bbcbcea-1662-4e24-9830-5df4e173dd00\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:Di6F\r\na=ice-pwd:UPxKgoIYXfuKa8l39CQNBtnb\r\na=ice-options:trickle\r\na=fingerprint:sha-256 56:FF:E6:75:3D:91:EB:C2:02:08:38:B3:EC:D0:5C:6D:1B:7B:09:A0:A6:C2:D0:FF:BF:93:B9:45:A5:86:99:3C\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:8bbcbcea-1662-4e24-9830-5df4e173dd00 d590f495-47cc-4a18-b897-afb46b836f0f\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:1300058738 cname:W2QXUzZ7tj3SMygk\r\na=ssrc:1300058738 msid:8bbcbcea-1662-4e24-9830-5df4e173dd00 d590f495-47cc-4a18-b897-afb46b836f0f\r\n","type":"offer"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:53 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_offer'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:3878955797 1 udp 2122194687 192.168.1.5 50690 typ host generation 0 ufrag Di6F network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Di6F"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:3392179886 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 63746 typ host generation 0 ufrag Di6F network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Di6F"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:429850497 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag Di6F network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Di6F"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:882530874 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag Di6F network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Di6F"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 9146658635657076418 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 56e4bbb3-ab85-48ea-916f-6b39ec4b0a93\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:YWzp\r\na=ice-pwd:tS1MPXdGh7kdVVNknPuX+uud\r\na=ice-options:trickle\r\na=fingerprint:sha-256 61:2E:17:EC:E3:B6:0D:8C:9D:DD:FD:F6:3C:4C:D6:4E:A7:9E:6E:7A:B3:D4:F2:2E:CD:CB:24:7B:4C:13:92:10\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:56e4bbb3-ab85-48ea-916f-6b39ec4b0a93 10d7ed36-e421-42d5-bb88-534f567eb814\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:1704327944 cname:Sm2Y+VzND5vSBmv5\r\na=ssrc:1704327944 msid:56e4bbb3-ab85-48ea-916f-6b39ec4b0a93 10d7ed36-e421-42d5-bb88-534f567eb814\r\n","type":"offer"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 7803419306771650151 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 56e4bbb3-ab85-48ea-916f-6b39ec4b0a93\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:53Iv\r\na=ice-pwd:cNY+LW+8ypX8IwkK8xKEqJlb\r\na=ice-options:trickle\r\na=fingerprint:sha-256 7F:EB:54:1E:5C:EA:4A:E2:A8:16:06:97:13:65:0C:30:AF:B4:8A:E6:B0:EF:41:6A:AB:64:33:F8:2A:E6:D0:9D\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:56e4bbb3-ab85-48ea-916f-6b39ec4b0a93 10d7ed36-e421-42d5-bb88-534f567eb814\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:1353690110 cname:T7DJ350q7PQxNUz+\r\na=ssrc:1353690110 msid:56e4bbb3-ab85-48ea-916f-6b39ec4b0a93 10d7ed36-e421-42d5-bb88-534f567eb814\r\n","type":"offer"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:2815318460 1 udp 1685987071 117.129.35.233 22489 typ srflx raddr 192.168.1.5 rport 50690 generation 0 ufrag Di6F network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"Di6F"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1163170187 1 udp 2122194687 192.168.1.5 63364 typ host generation 0 ufrag YWzp network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"YWzp"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1126082420 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 56450 typ host generation 0 ufrag YWzp network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"YWzp"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:228440523 1 udp 2122194687 192.168.1.5 58273 typ host generation 0 ufrag 53Iv network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"53Iv"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:198676276 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 52704 typ host generation 0 ufrag 53Iv network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"53Iv"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1000043283 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag YWzp network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"YWzp"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1037125100 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag YWzp network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"YWzp"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1934777171 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag 53Iv network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"53Iv"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1964535212 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag 53Iv network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"53Iv"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1613586017 1 udp 1685987071 117.129.35.233 22490 typ srflx raddr 192.168.1.5 rport 63364 generation 0 ufrag YWzp network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"YWzp"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:48:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/01 22:48:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:686061089 1 udp 1685987071 117.129.35.233 22492 typ srflx raddr 192.168.1.5 rport 58273 generation 0 ufrag 53Iv network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"53Iv"},"room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/01 22:48:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/01 22:49:41 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2026/01/02 06:36:01 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: e696fa9b-55e6-4759-a63a-b3acbc6b6b32): websocket: close 1005 (no status)
2026/01/02 06:36:01 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: e696fa9b-55e6-4759-a63a-b3acbc6b6b32, 连接指针: 0x1400020d020
2026/01/02 06:36:01 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:01 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/02 06:36:01 [Unregister] 房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2026/01/02 06:36:01 [Unregister] 房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32 保留（还有 1 个在线成员）
2026/01/02 06:36:01 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2026/01/02 06:36:01 [broadcastToRoom] ENTER | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 type=member_update
2026/01/02 06:36:01 [broadcastToRoom] 准备获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:01 [broadcastToRoom] 已获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:01 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 roomSize=1
2026/01/02 06:36:01 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:01 [broadcastToRoom] 📢 向房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32 的 1 个客户端广播消息类型: member_update
2026/01/02 06:36:03 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:36:03 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/02 06:36:03 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/02 06:36:03 [broadcastToRoom] ENTER | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 type=mic_on
2026/01/02 06:36:03 [broadcastToRoom] 准备获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:03 [broadcastToRoom] 已获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:03 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 roomSize=1
2026/01/02 06:36:03 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:03 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:03 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:36:03 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"e696fa9b-55e6-4759-a63a-b3acbc6b6b32"}}
2026/01/02 06:36:03 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/02 06:36:03 [broadcastToRoom] ENTER | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 type=mic_on
2026/01/02 06:36:03 [broadcastToRoom] 准备获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:03 [broadcastToRoom] 已获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:03 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 roomSize=1
2026/01/02 06:36:03 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:03 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:07 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: e696fa9b-55e6-4759-a63a-b3acbc6b6b32): websocket: close 1005 (no status)
2026/01/02 06:36:07 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: e696fa9b-55e6-4759-a63a-b3acbc6b6b32, 连接指针: 0x140000adc20
2026/01/02 06:36:07 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:07 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/02 06:36:07 [Unregister] 房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32 清理客户端后，剩余成员数: 0, shouldDeleteRoom: true
2026/01/02 06:36:07 [Unregister] 房间 e696fa9b-55e6-4759-a63a-b3acbc6b6b32 已删除（没有在线成员）
2026/01/02 06:36:07 [broadcastToRoom] ENTER | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 type=member_update
2026/01/02 06:36:07 [broadcastToRoom] 准备获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:07 [broadcastToRoom] 已获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:07 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:07 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): Hub 关闭了发送通道
2026/01/02 06:36:07 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:07 [broadcastToRoom] ENTER | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32 type=room_deleted
2026/01/02 06:36:07 [broadcastToRoom] 准备获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:07 [broadcastToRoom] 已获取 RLock | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:07 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=e696fa9b-55e6-4759-a63a-b3acbc6b6b32
2026/01/02 06:36:07 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/02 06:36:11 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2026/01/02 06:36:11 [broadcastToRoom] ENTER | roomID=global type=room_created
2026/01/02 06:36:11 [broadcastToRoom] 准备获取 RLock | roomID=global
2026/01/02 06:36:11 [broadcastToRoom] 已获取 RLock | roomID=global
2026/01/02 06:36:11 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=global roomSize=2
2026/01/02 06:36:11 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=global
2026/01/02 06:36:11 [broadcastToRoom] 📢 向房间 global 的 2 个客户端广播消息类型: room_created
2026/01/02 06:36:11 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/02 06:36:12 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:12 [Register] 房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 当前没有已上麦用户
2026/01/02 06:36:12 [broadcastToRoom] ENTER | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 type=member_update
2026/01/02 06:36:12 [broadcastToRoom] 准备获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:12 [broadcastToRoom] 已获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:12 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 roomSize=1
2026/01/02 06:36:12 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:12 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:12 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: cfa0d1ee-082c-4f30-aa05-e38b4349e418, 连接指针: 0x14000621380
2026/01/02 06:36:12 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 的消息，连接指针: 0x14000621380
2026/01/02 06:36:12 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:36:12 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:12 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/02 06:36:12 [broadcastToRoom] ENTER | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 type=mic_on
2026/01/02 06:36:12 [broadcastToRoom] 准备获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:12 [broadcastToRoom] 已获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:12 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 roomSize=1
2026/01/02 06:36:12 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:12 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:14 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:36:14 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:14 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/02 06:36:14 [broadcastToRoom] ENTER | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 type=mic_on
2026/01/02 06:36:14 [broadcastToRoom] 准备获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:14 [broadcastToRoom] 已获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:14 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 roomSize=1
2026/01/02 06:36:14 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:14 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:20 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:20 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: cfa0d1ee-082c-4f30-aa05-e38b4349e418, 连接指针: 0x140005a1140
2026/01/02 06:36:20 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 的消息，连接指针: 0x140005a1140
2026/01/02 06:36:20 [Register] 房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 当前已上麦用户: [1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/02 06:36:20 [broadcastToRoom] ENTER | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 type=member_update
2026/01/02 06:36:20 [broadcastToRoom] 准备获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:20 [broadcastToRoom] 已获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:20 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 roomSize=2
2026/01/02 06:36:20 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:20 [broadcastToRoom] 📢 向房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 的 1 个客户端广播消息类型: member_update
2026/01/02 06:36:20 [Register] 准备向新用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 发送当前已上麦用户信息: [1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/02 06:36:20 [Register] ✅ 已向新用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 发送用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的上麦信息
2026/01/02 06:36:21 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:36:21 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:21 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/02 06:36:21 [broadcastToRoom] ENTER | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 type=mic_on
2026/01/02 06:36:21 [broadcastToRoom] 准备获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:21 [broadcastToRoom] 已获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:21 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 roomSize=2
2026/01/02 06:36:21 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:21 [broadcastToRoom] 📢 向房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 的 1 个客户端广播消息类型: mic_on
2026/01/02 06:36:21 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:36:21 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:21 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/02 06:36:21 [broadcastToRoom] ENTER | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 type=mic_on
2026/01/02 06:36:21 [broadcastToRoom] 准备获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:21 [broadcastToRoom] 已获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:21 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 roomSize=2
2026/01/02 06:36:21 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:21 [broadcastToRoom] 📢 向房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 的 1 个客户端广播消息类型: mic_on
2026/01/02 06:36:22 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:36:22 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:22 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2026/01/02 06:36:22 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2026/01/02 06:36:22 [ReadPump] 房间ID: cfa0d1ee-082c-4f30-aa05-e38b4349e418, 准备广播给房间内其他成员
2026/01/02 06:36:22 [ReadPump] 已添加 username 到 Data: 小东
2026/01/02 06:36:22 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/02 06:36:22 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/02 06:36:22 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/02 06:36:22 [ReadPump] 准备调用 broadcastToRoom，房间ID: cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:22 [broadcastToRoom] ENTER | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 type=mic_request
2026/01/02 06:36:22 [broadcastToRoom] 准备获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:22 [broadcastToRoom] 已获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:22 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 roomSize=2
2026/01/02 06:36:22 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:22 [broadcastToRoom] 📢 向房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 的 1 个客户端广播消息类型: mic_request
2026/01/02 06:36:22 [ReadPump] ✅ 连麦申请已广播给房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 的其他成员
2026/01/02 06:36:25 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:36:25 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:25 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2026/01/02 06:36:25 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2026/01/02 06:36:25 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:cfa0d1ee-082c-4f30-aa05-e38b4349e418 UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:map[room_id:cfa0d1ee-082c-4f30-aa05-e38b4349e418 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa] Timestamp:1767306985}
2026/01/02 06:36:25 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:cfa0d1ee-082c-4f30-aa05-e38b4349e418 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/02 06:36:25 [ReadPump] Data 是 map，内容: map[room_id:cfa0d1ee-082c-4f30-aa05-e38b4349e418 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/02 06:36:25 [ReadPump] Data 中的所有键: [target_user_id user_id room_id]
2026/01/02 06:36:25 [ReadPump] ✅ 找到 target_user_id: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2026/01/02 06:36:25 [ReadPump] 准备发送 mic_approved 给用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418)
2026/01/02 06:36:25 [broadcastToRoom] ENTER | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 type=mic_approved
2026/01/02 06:36:25 [broadcastToRoom] 准备获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:25 [broadcastToRoom] 已获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:25 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 roomSize=2
2026/01/02 06:36:25 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:25 [broadcastToRoom] 📢 向房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 的 1 个客户端广播消息类型: mic_approved
2026/01/02 06:36:25 [ReadPump] ✅ mic_approved 已广播给房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:26 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:36:26 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:26 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_on'
2026/01/02 06:36:26 [broadcastToRoom] ENTER | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 type=mic_on
2026/01/02 06:36:26 [broadcastToRoom] 准备获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:26 [broadcastToRoom] 已获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:26 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 roomSize=2
2026/01/02 06:36:26 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:36:26 [broadcastToRoom] 📢 向房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 的 1 个客户端广播消息类型: mic_on
2026/01/02 06:36:26 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:36:26 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","offer":{"sdp":"v=0\r\no=- 7207526862796085344 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 77807c6a-4073-4873-b4f8-5651ff3c0b95\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:kJdH\r\na=ice-pwd:utsp313Lw8BK0VWqHWTMqXm7\r\na=ice-options:trickle\r\na=fingerprint:sha-256 6C:29:B1:C4:71:6D:51:22:D6:AF:AA:34:C3:27:DD:A2:FA:74:57:E6:62:7B:7B:AE:3A:93:C0:97:FA:41:7A:7D\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:77807c6a-4073-4873-b4f8-5651ff3c0b95 8517197e-b2cf-40fa-9970-cb60e575e0d9\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:1334459003 cname:cYcUGkMhIFOAWloL\r\na=ssrc:1334459003 msid:77807c6a-4073-4873-b4f8-5651ff3c0b95 8517197e-b2cf-40fa-9970-cb60e575e0d9\r\n","type":"offer"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:26 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_offer'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:1976472069 1 udp 2122194687 192.168.1.5 55225 typ host generation 0 ufrag kJdH network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"kJdH"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:1938072826 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 65031 typ host generation 0 ufrag kJdH network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"kJdH"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:184643741 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag kJdH network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"kJdH"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:223037026 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag kJdH network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"kJdH"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 1249383913710917402 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS c8398b21-6f71-4cf7-8260-5143e0d28ace\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:u4ys\r\na=ice-pwd:n8AOduDGYZQw7wYLnTK3p3Co\r\na=ice-options:trickle\r\na=fingerprint:sha-256 5A:A3:CB:DC:09:40:B4:E9:59:48:C3:47:9E:AC:2A:08:E5:F8:1A:6E:EF:E9:9D:16:9B:79:A1:F4:CB:1E:0A:7A\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:c8398b21-6f71-4cf7-8260-5143e0d28ace 5fe4c6ae-fe02-4589-b493-5712a3cc4b8a\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:3236206224 cname:3GQ7IowzBwe8xooD\r\na=ssrc:3236206224 msid:c8398b21-6f71-4cf7-8260-5143e0d28ace 5fe4c6ae-fe02-4589-b493-5712a3cc4b8a\r\n","type":"offer"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 3766414131349854846 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS c8398b21-6f71-4cf7-8260-5143e0d28ace\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:rKAc\r\na=ice-pwd:11NZ4x1x+OOIoslUVkMzqywO\r\na=ice-options:trickle\r\na=fingerprint:sha-256 3D:92:E5:F2:EB:44:63:84:BF:D3:14:64:E4:B9:96:67:3C:EF:92:33:44:09:D4:46:37:00:70:34:D6:9A:37:9C\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:c8398b21-6f71-4cf7-8260-5143e0d28ace 5fe4c6ae-fe02-4589-b493-5712a3cc4b8a\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:1317659204 cname:PthU9eVTd4VOB1Yq\r\na=ssrc:1317659204 msid:c8398b21-6f71-4cf7-8260-5143e0d28ace 5fe4c6ae-fe02-4589-b493-5712a3cc4b8a\r\n","type":"offer"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:1354194415 1 udp 1685987071 117.129.35.233 22306 typ srflx raddr 192.168.1.5 rport 55225 generation 0 ufrag kJdH network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"kJdH"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:935942276 1 udp 2122194687 192.168.1.5 52854 typ host generation 0 ufrag u4ys network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"u4ys"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:449707327 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 55746 typ host generation 0 ufrag u4ys network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"u4ys"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1206724796 1 udp 2122194687 192.168.1.5 49323 typ host generation 0 ufrag rKAc network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"rKAc"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1793690887 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 50049 typ host generation 0 ufrag rKAc network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"rKAc"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3378744336 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag u4ys network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"u4ys"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3831966123 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag u4ys network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"u4ys"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3108502568 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag rKAc network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"rKAc"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2487441811 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag rKAc network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"rKAc"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1999841837 1 udp 1685987071 117.129.35.233 22311 typ srflx raddr 192.168.1.5 rport 52854 generation 0 ufrag u4ys network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"u4ys"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:36:27 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:36:27 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:118970901 1 udp 1685987071 117.129.35.233 22312 typ srflx raddr 192.168.1.5 rport 49323 generation 0 ufrag rKAc network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"rKAc"},"room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:36:27 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:43:53 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:43:53 [ReadPump] 消息内容: {"type":"message","data":{"type":"message","content":"发达方法","room_id":"cfa0d1ee-082c-4f30-aa05-e38b4349e418"}}
2026/01/02 06:43:53 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'message'
2026/01/02 06:43:53 [RoomHub.Run] 收到 Broadcast 消息，类型: message, 房间ID: cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:43:53 [broadcastToRoom] ENTER | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 type=message
2026/01/02 06:43:53 [broadcastToRoom] 准备获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:43:53 [broadcastToRoom] 已获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:43:53 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 roomSize=2
2026/01/02 06:43:53 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:43:53 [broadcastToRoom] 📢 向房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 的 2 个客户端广播消息类型: message
2026/01/02 06:43:53 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/02 06:43:53 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: cfa0d1ee-082c-4f30-aa05-e38b4349e418): websocket: close 1005 (no status)
2026/01/02 06:43:53 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: cfa0d1ee-082c-4f30-aa05-e38b4349e418, 连接指针: 0x140005a1140
2026/01/02 06:43:53 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1005 (no status)
2026/01/02 06:43:53 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140004156e0
2026/01/02 06:43:53 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/02 06:43:53 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:43:53 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/02 06:43:53 [Unregister] 房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2026/01/02 06:43:53 [Unregister] 房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 保留（还有 1 个在线成员）
2026/01/02 06:43:53 [broadcastToRoom] ENTER | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 type=member_update
2026/01/02 06:43:53 [broadcastToRoom] 准备获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:43:53 [broadcastToRoom] 已获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:43:53 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 roomSize=1
2026/01/02 06:43:53 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2026/01/02 06:43:53 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:43:53 [broadcastToRoom] 📢 向房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 的 1 个客户端广播消息类型: member_update
2026/01/02 06:43:53 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: cfa0d1ee-082c-4f30-aa05-e38b4349e418): websocket: close 1005 (no status)
2026/01/02 06:43:53 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: cfa0d1ee-082c-4f30-aa05-e38b4349e418, 连接指针: 0x14000621380
2026/01/02 06:43:53 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:43:53 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/02 06:43:53 [Unregister] 房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 清理客户端后，剩余成员数: 0, shouldDeleteRoom: true
2026/01/02 06:43:53 [Unregister] 房间 cfa0d1ee-082c-4f30-aa05-e38b4349e418 已删除（没有在线成员）
2026/01/02 06:43:53 [broadcastToRoom] ENTER | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 type=member_update
2026/01/02 06:43:53 [broadcastToRoom] 准备获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:43:53 [broadcastToRoom] 已获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:43:53 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:43:53 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): Hub 关闭了发送通道
2026/01/02 06:43:53 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 获取写入器失败: websocket: close sent
2026/01/02 06:43:53 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:43:53 [broadcastToRoom] ENTER | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418 type=room_deleted
2026/01/02 06:43:53 [broadcastToRoom] 准备获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:43:53 [broadcastToRoom] 已获取 RLock | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:43:53 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=cfa0d1ee-082c-4f30-aa05-e38b4349e418
2026/01/02 06:43:53 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/02 06:44:14 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ac720
2026/01/02 06:44:14 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000ac720
2026/01/02 06:44:14 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/02 06:44:14 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000ac720
2026/01/02 06:44:14 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/02 06:44:14 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ac720
2026/01/02 06:44:14 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/02 06:44:14 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/02 06:44:14 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/02 06:44:14 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400019f680
2026/01/02 06:44:14 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400019f680
2026/01/02 06:44:14 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/02 06:44:14 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400019f680
2026/01/02 06:44:15 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:15 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x1400019f680, 新连接: 0x1400020cae0
2026/01/02 06:44:15 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/02 06:44:15 [Register] 房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 当前没有已上麦用户
2026/01/02 06:44:15 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=member_update
2026/01/02 06:44:15 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:15 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:15 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=1
2026/01/02 06:44:15 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:15 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:15 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716, 连接指针: 0x1400020cae0
2026/01/02 06:44:15 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的消息，连接指针: 0x1400020cae0
2026/01/02 06:44:16 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:44:16 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:16 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/02 06:44:16 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=mic_on
2026/01/02 06:44:16 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:16 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:16 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=1
2026/01/02 06:44:16 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:16 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:16 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:44:16 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:16 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/02 06:44:16 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=mic_on
2026/01/02 06:44:16 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:16 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:16 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=1
2026/01/02 06:44:16 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:16 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:30 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000303020
2026/01/02 06:44:30 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000303020
2026/01/02 06:44:30 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/02 06:44:30 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x14000303020
2026/01/02 06:44:30 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000414b40
2026/01/02 06:44:30 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000414b40
2026/01/02 06:44:30 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/02 06:44:30 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x14000303020, 新连接: 0x14000414b40
2026/01/02 06:44:30 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2026/01/02 06:44:30 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x14000414b40
2026/01/02 06:44:30 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2026/01/02 06:44:30 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000303020
2026/01/02 06:44:30 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/02 06:44:33 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:33 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x14000414b40, 新连接: 0x14000620540
2026/01/02 06:44:33 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2026/01/02 06:44:33 [Register] 房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 当前已上麦用户: [1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/02 06:44:33 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=member_update
2026/01/02 06:44:33 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:33 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:33 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/02 06:44:33 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:33 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: member_update
2026/01/02 06:44:33 [Register] 准备向新用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 发送当前已上麦用户信息: [1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/02 06:44:33 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716, 连接指针: 0x14000620540
2026/01/02 06:44:33 [Register] ✅ 已向新用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 发送用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的上麦信息
2026/01/02 06:44:33 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的消息，连接指针: 0x14000620540
2026/01/02 06:44:34 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:44:34 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:34 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/02 06:44:34 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=mic_on
2026/01/02 06:44:34 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:34 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:34 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/02 06:44:34 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:34 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: mic_on
2026/01/02 06:44:34 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:44:34 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:34 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/02 06:44:34 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=mic_on
2026/01/02 06:44:34 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:34 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:34 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/02 06:44:34 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:34 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: mic_on
2026/01/02 06:44:38 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716): websocket: close 1005 (no status)
2026/01/02 06:44:38 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716, 连接指针: 0x1400020cae0
2026/01/02 06:44:38 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:38 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/02 06:44:38 [Unregister] 房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2026/01/02 06:44:38 [Unregister] 房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 保留（还有 1 个在线成员）
2026/01/02 06:44:38 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=member_update
2026/01/02 06:44:38 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:38 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:38 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=1
2026/01/02 06:44:38 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:38 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: member_update
2026/01/02 06:44:38 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): Hub 关闭了发送通道
2026/01/02 06:44:41 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:41 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716, 连接指针: 0x140005fe840
2026/01/02 06:44:41 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的消息，连接指针: 0x140005fe840
2026/01/02 06:44:41 [Register] 房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 当前已上麦用户: []
2026/01/02 06:44:41 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=member_update
2026/01/02 06:44:41 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:41 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:41 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/02 06:44:41 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:41 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: member_update
2026/01/02 06:44:42 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:44:42 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:42 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/02 06:44:42 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=mic_on
2026/01/02 06:44:42 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:42 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:42 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/02 06:44:42 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:42 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: mic_on
2026/01/02 06:44:42 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:44:42 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:42 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/02 06:44:42 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=mic_on
2026/01/02 06:44:42 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:42 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:42 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/02 06:44:42 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:42 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: mic_on
2026/01/02 06:44:47 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:44:47 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:47 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2026/01/02 06:44:47 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2026/01/02 06:44:47 [ReadPump] 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716, 准备广播给房间内其他成员
2026/01/02 06:44:47 [ReadPump] 已添加 username 到 Data: 小东
2026/01/02 06:44:47 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/02 06:44:47 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/02 06:44:47 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/02 06:44:47 [ReadPump] 准备调用 broadcastToRoom，房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:47 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=mic_request
2026/01/02 06:44:47 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:47 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:47 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/02 06:44:47 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:47 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: mic_request
2026/01/02 06:44:47 [ReadPump] ✅ 连麦申请已广播给房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的其他成员
2026/01/02 06:44:49 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/02 06:44:49 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:49 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2026/01/02 06:44:49 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2026/01/02 06:44:49 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:map[room_id:4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa] Timestamp:1767307489}
2026/01/02 06:44:49 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/02 06:44:49 [ReadPump] Data 是 map，内容: map[room_id:4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/02 06:44:49 [ReadPump] Data 中的所有键: [target_user_id user_id room_id]
2026/01/02 06:44:49 [ReadPump] ✅ 找到 target_user_id: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2026/01/02 06:44:49 [ReadPump] 准备发送 mic_approved 给用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716)
2026/01/02 06:44:49 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=mic_approved
2026/01/02 06:44:49 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:49 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:49 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/02 06:44:49 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:49 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: mic_approved
2026/01/02 06:44:49 [ReadPump] ✅ mic_approved 已广播给房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:44:50 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:50 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_on'
2026/01/02 06:44:50 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=mic_on
2026/01/02 06:44:50 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:50 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:50 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/02 06:44:50 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:44:50 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: mic_on
2026/01/02 06:44:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:44:50 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 2930906859709209984 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 336bfd68-044f-45d7-be80-4e1faa26a414\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:/AJ1\r\na=ice-pwd:ChdJeFf8JJDY2RIls4UlCsua\r\na=ice-options:trickle\r\na=fingerprint:sha-256 B7:4E:13:8A:5B:C6:5D:12:62:30:B5:9E:14:45:17:42:45:32:38:59:E5:D8:78:B4:80:DA:F0:14:1B:84:D0:22\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:336bfd68-044f-45d7-be80-4e1faa26a414 c416b475-b738-4a81-8415-8492469ec7d0\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:2509608616 cname:vA5y9HxKIkkst6xn\r\na=ssrc:2509608616 msid:336bfd68-044f-45d7-be80-4e1faa26a414 c416b475-b738-4a81-8415-8492469ec7d0\r\n","type":"offer"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:50 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/02 06:44:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:44:50 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 5480761222672594504 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 336bfd68-044f-45d7-be80-4e1faa26a414\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:j/eQ\r\na=ice-pwd:02dIa8cO49Fsp3iVKqRudgQ+\r\na=ice-options:trickle\r\na=fingerprint:sha-256 9E:99:2E:B2:49:87:3B:FE:D1:4B:54:56:54:BD:F7:2B:D9:93:3B:CE:30:BD:C8:8E:D8:94:A6:BC:38:3E:9D:15\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:336bfd68-044f-45d7-be80-4e1faa26a414 c416b475-b738-4a81-8415-8492469ec7d0\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:3905946082 cname:+BUvPuB2shmvAY3l\r\na=ssrc:3905946082 msid:336bfd68-044f-45d7-be80-4e1faa26a414 c416b475-b738-4a81-8415-8492469ec7d0\r\n","type":"offer"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:50 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/02 06:44:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:44:50 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3282083202 1 udp 2122194687 192.168.1.5 55787 typ host generation 0 ufrag /AJ1 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"/AJ1"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:50 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:44:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:44:50 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1059290567 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 49700 typ host generation 0 ufrag /AJ1 network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"/AJ1"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:50 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:44:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:44:50 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2500115917 1 udp 2122194687 192.168.1.5 64126 typ host generation 0 ufrag j/eQ network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"j/eQ"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:50 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:44:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:44:50 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2471398194 1 udp 2122262783 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 65367 typ host generation 0 ufrag j/eQ network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"j/eQ"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:50 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:44:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:44:50 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3175004303 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag /AJ1 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"/AJ1"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:50 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:44:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:44:50 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1102928074 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag /AJ1 network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"/AJ1"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:50 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:44:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:44:50 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3955973973 1 tcp 1518214911 192.168.1.5 9 typ host tcptype active generation 0 ufrag j/eQ network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"j/eQ"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:50 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:44:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:44:50 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3984681386 1 tcp 1518283007 2409:8a00:26c8:9760:fc8d:4542:dff5:3dd4 9 typ host tcptype active generation 0 ufrag j/eQ network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"j/eQ"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:50 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:44:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:44:50 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3585988400 1 udp 1685987071 117.129.35.233 22518 typ srflx raddr 192.168.1.5 rport 55787 generation 0 ufrag /AJ1 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"/AJ1"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:50 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:44:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:44:50 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2961011239 1 udp 1685987071 117.129.35.233 22519 typ srflx raddr 192.168.1.5 rport 64126 generation 0 ufrag j/eQ network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"j/eQ"},"room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:44:50 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/02 06:45:08 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/02 06:45:15 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/02 06:45:15 [ReadPump] 消息内容: {"type":"message","data":{"type":"message","content":"短发","room_id":"4f52b5ec-23f0-4cc3-a1ca-8cc04704b716"}}
2026/01/02 06:45:15 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'message'
2026/01/02 06:45:15 [RoomHub.Run] 收到 Broadcast 消息，类型: message, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=message
2026/01/02 06:45:15 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/02 06:45:15 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 2 个客户端广播消息类型: message
2026/01/02 06:45:15 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/02 06:45:15 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/02 06:45:15 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400019f680
2026/01/02 06:45:15 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/02 06:45:15 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716): websocket: close 1005 (no status)
2026/01/02 06:45:15 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716, 连接指针: 0x140005fe840
2026/01/02 06:45:15 [RoomHub.Run] 收到 Broadcast 消息，类型: room_update, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=room_update
2026/01/02 06:45:15 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=2
2026/01/02 06:45:15 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 2 个客户端广播消息类型: room_update
2026/01/02 06:45:15 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/02 06:45:15 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/02 06:45:15 [Unregister] 房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2026/01/02 06:45:15 [Unregister] 房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 保留（还有 1 个在线成员）
2026/01/02 06:45:15 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2026/01/02 06:45:15 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=member_update
2026/01/02 06:45:15 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 roomSize=1
2026/01/02 06:45:15 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [broadcastToRoom] 📢 向房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 的 1 个客户端广播消息类型: member_update
2026/01/02 06:45:15 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716): websocket: close 1005 (no status)
2026/01/02 06:45:15 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1005 (no status)
2026/01/02 06:45:15 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000414b40
2026/01/02 06:45:15 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/02 06:45:15 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716, 连接指针: 0x14000620540
2026/01/02 06:45:15 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/02 06:45:15 [Unregister] 房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 清理客户端后，剩余成员数: 0, shouldDeleteRoom: true
2026/01/02 06:45:15 [Unregister] 房间 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 已删除（没有在线成员）
2026/01/02 06:45:15 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=member_update
2026/01/02 06:45:15 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2026/01/02 06:45:15 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 获取写入器失败: websocket: close sent
2026/01/02 06:45:15 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2026/01/02 06:45:15 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 获取写入器失败: websocket: close sent
2026/01/02 06:45:15 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: 4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [broadcastToRoom] ENTER | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716 type=room_deleted
2026/01/02 06:45:15 [broadcastToRoom] 准备获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [broadcastToRoom] 已获取 RLock | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=4f52b5ec-23f0-4cc3-a1ca-8cc04704b716
2026/01/02 06:45:15 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/03 11:00:55 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400020ca20
2026/01/03 11:00:55 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400020ca20
2026/01/03 11:00:55 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 11:00:55 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400020ca20
2026/01/03 11:00:55 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005a0120
2026/01/03 11:00:55 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005a0120
2026/01/03 11:00:55 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 11:00:55 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x1400020ca20, 新连接: 0x140005a0120
2026/01/03 11:00:55 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/03 11:00:55 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005a0120
2026/01/03 11:00:55 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/03 11:00:55 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400020ca20
2026/01/03 11:00:55 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 11:00:56 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/03 11:00:56 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005a0120
2026/01/03 11:00:56 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 11:00:56 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/03 11:00:56 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/03 11:01:04 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ac4e0
2026/01/03 11:01:04 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000ac4e0
2026/01/03 11:01:04 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 11:01:04 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000ac4e0
2026/01/03 11:01:04 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/03 11:01:04 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ac4e0
2026/01/03 11:01:04 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 11:01:04 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/03 11:01:04 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/03 11:01:04 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003029c0
2026/01/03 11:01:04 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140003029c0
2026/01/03 11:01:04 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 11:01:04 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140003029c0
2026/01/03 11:01:35 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140006207e0
2026/01/03 11:01:35 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140006207e0
2026/01/03 11:01:35 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/03 11:01:35 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 2, 连接指针: 0x140006207e0
2026/01/03 11:01:35 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2026/01/03 11:01:35 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140006207e0
2026/01/03 11:01:35 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/03 11:01:35 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/03 11:01:35 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/03 11:01:35 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/03 11:01:35 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x1400007c600
2026/01/03 11:01:35 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x1400007c600
2026/01/03 11:01:35 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 2, 连接指针: 0x1400007c600
2026/01/03 11:01:37 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1005 (no status)
2026/01/03 11:01:37 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x1400007c600
2026/01/03 11:01:37 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/03 11:01:37 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/03 11:01:37 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/03 11:01:38 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000870d80
2026/01/03 11:01:38 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000870d80
2026/01/03 11:01:38 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/03 11:01:38 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 2, 连接指针: 0x14000870d80
2026/01/03 11:01:38 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2026/01/03 11:01:38 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000870d80
2026/01/03 11:01:38 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/03 11:01:38 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/03 11:01:38 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/03 11:01:38 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000620840
2026/01/03 11:01:38 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000620840
2026/01/03 11:01:38 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/03 11:01:38 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 2, 连接指针: 0x14000620840
2026/01/03 11:01:40 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 418f809c-a4ab-4dfe-a34b-0bab15dc5251
2026/01/03 11:01:40 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x14000620840, 新连接: 0x14000cf4fc0
2026/01/03 11:01:40 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2026/01/03 11:01:40 [Register] 房间 418f809c-a4ab-4dfe-a34b-0bab15dc5251 当前没有已上麦用户
2026/01/03 11:01:40 [broadcastToRoom] ENTER | roomID=418f809c-a4ab-4dfe-a34b-0bab15dc5251 type=member_update
2026/01/03 11:01:40 [broadcastToRoom] 准备获取 RLock | roomID=418f809c-a4ab-4dfe-a34b-0bab15dc5251
2026/01/03 11:01:40 [broadcastToRoom] 已获取 RLock | roomID=418f809c-a4ab-4dfe-a34b-0bab15dc5251
2026/01/03 11:01:40 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=418f809c-a4ab-4dfe-a34b-0bab15dc5251 roomSize=1
2026/01/03 11:01:40 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=418f809c-a4ab-4dfe-a34b-0bab15dc5251
2026/01/03 11:01:40 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=418f809c-a4ab-4dfe-a34b-0bab15dc5251
2026/01/03 11:01:40 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 418f809c-a4ab-4dfe-a34b-0bab15dc5251, 连接指针: 0x14000cf4fc0
2026/01/03 11:01:40 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 418f809c-a4ab-4dfe-a34b-0bab15dc5251 的消息，连接指针: 0x14000cf4fc0
2026/01/03 11:01:44 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 418f809c-a4ab-4dfe-a34b-0bab15dc5251): websocket: close 1005 (no status)
2026/01/03 11:01:44 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 418f809c-a4ab-4dfe-a34b-0bab15dc5251, 连接指针: 0x14000cf4fc0
2026/01/03 11:01:44 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 418f809c-a4ab-4dfe-a34b-0bab15dc5251
2026/01/03 11:01:44 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/03 11:01:44 [Unregister] 房间 418f809c-a4ab-4dfe-a34b-0bab15dc5251 清理客户端后，剩余成员数: 0, shouldDeleteRoom: true
2026/01/03 11:01:44 [Unregister] 房间 418f809c-a4ab-4dfe-a34b-0bab15dc5251 已删除（没有在线成员）
2026/01/03 11:01:44 [broadcastToRoom] ENTER | roomID=418f809c-a4ab-4dfe-a34b-0bab15dc5251 type=member_update
2026/01/03 11:01:44 [broadcastToRoom] 准备获取 RLock | roomID=418f809c-a4ab-4dfe-a34b-0bab15dc5251
2026/01/03 11:01:44 [broadcastToRoom] 已获取 RLock | roomID=418f809c-a4ab-4dfe-a34b-0bab15dc5251
2026/01/03 11:01:44 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=418f809c-a4ab-4dfe-a34b-0bab15dc5251
2026/01/03 11:01:44 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 获取写入器失败: websocket: close sent
2026/01/03 11:01:44 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2026/01/03 11:01:44 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2026/01/03 11:01:44 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 获取写入器失败: websocket: close sent
2026/01/03 11:01:44 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2026/01/03 11:01:44 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 获取写入器失败: websocket: close sent
2026/01/03 11:01:44 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2026/01/03 11:01:44 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: 418f809c-a4ab-4dfe-a34b-0bab15dc5251
2026/01/03 11:01:44 [broadcastToRoom] ENTER | roomID=418f809c-a4ab-4dfe-a34b-0bab15dc5251 type=room_deleted
2026/01/03 11:01:44 [broadcastToRoom] 准备获取 RLock | roomID=418f809c-a4ab-4dfe-a34b-0bab15dc5251
2026/01/03 11:01:44 [broadcastToRoom] 已获取 RLock | roomID=418f809c-a4ab-4dfe-a34b-0bab15dc5251
2026/01/03 11:01:44 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=418f809c-a4ab-4dfe-a34b-0bab15dc5251
2026/01/03 11:01:44 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/03 11:01:56 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2026/01/03 11:01:56 [broadcastToRoom] ENTER | roomID=global type=room_created
2026/01/03 11:01:56 [broadcastToRoom] 准备获取 RLock | roomID=global
2026/01/03 11:01:56 [broadcastToRoom] 已获取 RLock | roomID=global
2026/01/03 11:01:56 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=global roomSize=14
2026/01/03 11:01:56 [broadcastToRoom] 已释放 RLock，recipients=14 | roomID=global
2026/01/03 11:01:56 [broadcastToRoom] 📢 向房间 global 的 14 个客户端广播消息类型: room_created
2026/01/03 11:01:56 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/03 11:01:57 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:01:57 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140003029c0, 新连接: 0x14000e7a1e0
2026/01/03 11:01:57 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/03 11:01:57 [Register] 房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 当前没有已上麦用户
2026/01/03 11:01:57 [broadcastToRoom] ENTER | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 type=member_update
2026/01/03 11:01:57 [broadcastToRoom] 准备获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:01:57 [broadcastToRoom] 已获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:01:57 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 roomSize=1
2026/01/03 11:01:57 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:01:57 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:01:57 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 563b2a81-4050-4ebe-85f2-a4fc400a6995, 连接指针: 0x14000e7a1e0
2026/01/03 11:01:57 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 的消息，连接指针: 0x14000e7a1e0
2026/01/03 11:01:58 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:01:58 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:01:58 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 11:01:58 [broadcastToRoom] ENTER | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 type=mic_on
2026/01/03 11:01:58 [broadcastToRoom] 准备获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:01:58 [broadcastToRoom] 已获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:01:58 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 roomSize=1
2026/01/03 11:01:58 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:01:58 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:01:58 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:01:58 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:01:58 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 11:01:58 [broadcastToRoom] ENTER | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 type=mic_on
2026/01/03 11:01:58 [broadcastToRoom] 准备获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:01:58 [broadcastToRoom] 已获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:01:58 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 roomSize=1
2026/01/03 11:01:58 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:01:58 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:01 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 563b2a81-4050-4ebe-85f2-a4fc400a6995, 连接指针: 0x14000fce420
2026/01/03 11:02:01 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:01 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 的消息，连接指针: 0x14000fce420
2026/01/03 11:02:01 [Register] 房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 当前已上麦用户: [1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/03 11:02:01 [broadcastToRoom] ENTER | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 type=member_update
2026/01/03 11:02:01 [broadcastToRoom] 准备获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:01 [broadcastToRoom] 已获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:01 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 roomSize=2
2026/01/03 11:02:01 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:01 [broadcastToRoom] 📢 向房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 的 1 个客户端广播消息类型: member_update
2026/01/03 11:02:01 [Register] 准备向新用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 发送当前已上麦用户信息: [1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/03 11:02:01 [Register] ✅ 已向新用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 发送用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的上麦信息
2026/01/03 11:02:02 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:02:02 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:02 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 11:02:02 [broadcastToRoom] ENTER | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 type=mic_on
2026/01/03 11:02:02 [broadcastToRoom] 准备获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:02 [broadcastToRoom] 已获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:02 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 roomSize=2
2026/01/03 11:02:02 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:02 [broadcastToRoom] 📢 向房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 的 1 个客户端广播消息类型: mic_on
2026/01/03 11:02:02 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:02:02 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:02 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 11:02:02 [broadcastToRoom] ENTER | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 type=mic_on
2026/01/03 11:02:02 [broadcastToRoom] 准备获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:02 [broadcastToRoom] 已获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:02 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 roomSize=2
2026/01/03 11:02:02 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:02 [broadcastToRoom] 📢 向房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 的 1 个客户端广播消息类型: mic_on
2026/01/03 11:02:04 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:02:04 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:04 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2026/01/03 11:02:04 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2026/01/03 11:02:04 [ReadPump] 房间ID: 563b2a81-4050-4ebe-85f2-a4fc400a6995, 准备广播给房间内其他成员
2026/01/03 11:02:04 [ReadPump] 已添加 username 到 Data: 小东
2026/01/03 11:02:04 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/03 11:02:04 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/03 11:02:04 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/03 11:02:04 [ReadPump] 准备调用 broadcastToRoom，房间ID: 563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:04 [broadcastToRoom] ENTER | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 type=mic_request
2026/01/03 11:02:04 [broadcastToRoom] 准备获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:04 [broadcastToRoom] 已获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:04 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 roomSize=2
2026/01/03 11:02:04 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:04 [broadcastToRoom] 📢 向房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 的 1 个客户端广播消息类型: mic_request
2026/01/03 11:02:04 [ReadPump] ✅ 连麦申请已广播给房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 的其他成员
2026/01/03 11:02:08 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:02:08 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:08 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2026/01/03 11:02:08 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2026/01/03 11:02:08 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:563b2a81-4050-4ebe-85f2-a4fc400a6995 UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:map[room_id:563b2a81-4050-4ebe-85f2-a4fc400a6995 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa] Timestamp:1767409328}
2026/01/03 11:02:08 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:563b2a81-4050-4ebe-85f2-a4fc400a6995 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/03 11:02:08 [ReadPump] Data 是 map，内容: map[room_id:563b2a81-4050-4ebe-85f2-a4fc400a6995 target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/03 11:02:08 [ReadPump] Data 中的所有键: [room_id target_user_id user_id]
2026/01/03 11:02:08 [ReadPump] ✅ 找到 target_user_id: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2026/01/03 11:02:08 [ReadPump] 准备发送 mic_approved 给用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (房间 563b2a81-4050-4ebe-85f2-a4fc400a6995)
2026/01/03 11:02:08 [broadcastToRoom] ENTER | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 type=mic_approved
2026/01/03 11:02:08 [broadcastToRoom] 准备获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:08 [broadcastToRoom] 已获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:08 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 roomSize=2
2026/01/03 11:02:08 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:08 [broadcastToRoom] 📢 向房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 的 1 个客户端广播消息类型: mic_approved
2026/01/03 11:02:08 [ReadPump] ✅ mic_approved 已广播给房间 563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_on'
2026/01/03 11:02:09 [broadcastToRoom] ENTER | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 type=mic_on
2026/01/03 11:02:09 [broadcastToRoom] 准备获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:09 [broadcastToRoom] 已获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:09 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 roomSize=2
2026/01/03 11:02:09 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:02:09 [broadcastToRoom] 📢 向房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 的 1 个客户端广播消息类型: mic_on
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","offer":{"sdp":"v=0\r\no=- 8547646170895879591 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 85d770ef-be5a-410f-a958-c1914d79b2a7\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:unA4\r\na=ice-pwd:BHzOWvpuP/CPcqx/xlwuHtZ7\r\na=ice-options:trickle\r\na=fingerprint:sha-256 44:D7:11:09:2D:91:A6:54:63:41:56:96:F2:92:78:94:BD:B0:FD:2B:ED:37:0C:F8:93:CF:58:3E:1A:3C:C5:0A\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:85d770ef-be5a-410f-a958-c1914d79b2a7 ced680f5-94e1-4286-b104-b9179e522c56\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:2397873379 cname:yH0i8/WL9Dbr3+Fa\r\na=ssrc:2397873379 msid:85d770ef-be5a-410f-a958-c1914d79b2a7 ced680f5-94e1-4286-b104-b9179e522c56\r\n","type":"offer"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_offer'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:3651008189 1 udp 2122194687 192.168.1.13 53093 typ host generation 0 ufrag unA4 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"unA4"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:4169506025 1 udp 2122262783 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 54980 typ host generation 0 ufrag unA4 network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"unA4"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:657924649 1 tcp 1518214911 192.168.1.13 9 typ host tcptype active generation 0 ufrag unA4 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"unA4"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:103762045 1 tcp 1518283007 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 9 typ host tcptype active generation 0 ufrag unA4 network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"unA4"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 3394329315075995552 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS d78a16aa-f7e4-4059-9890-e702c46ab846\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:CxiG\r\na=ice-pwd:PRigT363CdjWRTqIRVnGMS9a\r\na=ice-options:trickle\r\na=fingerprint:sha-256 AD:9E:9A:BE:E6:60:8C:7F:27:BD:8D:84:2E:93:4F:55:AA:82:4E:58:23:D5:D3:98:C7:CC:DF:85:E2:35:78:74\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:d78a16aa-f7e4-4059-9890-e702c46ab846 24a2a70c-3727-4231-bb60-6f13878b55f6\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:1740606419 cname:v/EGlBd6GHv3UUu8\r\na=ssrc:1740606419 msid:d78a16aa-f7e4-4059-9890-e702c46ab846 24a2a70c-3727-4231-bb60-6f13878b55f6\r\n","type":"offer"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 4686064817708830381 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS d78a16aa-f7e4-4059-9890-e702c46ab846\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:YsMd\r\na=ice-pwd:7ckNGSukNuFpCTEyHB/vOQw7\r\na=ice-options:trickle\r\na=fingerprint:sha-256 14:52:A8:5F:4B:65:B5:15:BB:05:B5:D7:D7:1C:F5:C2:F3:30:AE:17:F6:E6:22:4A:B2:72:C8:E9:45:1B:5B:F2\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:d78a16aa-f7e4-4059-9890-e702c46ab846 24a2a70c-3727-4231-bb60-6f13878b55f6\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:2238614165 cname:Fv0UZYPvxreB9Wfx\r\na=ssrc:2238614165 msid:d78a16aa-f7e4-4059-9890-e702c46ab846 24a2a70c-3727-4231-bb60-6f13878b55f6\r\n","type":"offer"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:1993807747 1 udp 1685987071 117.129.35.233 22242 typ srflx raddr 192.168.1.13 rport 53093 generation 0 ufrag unA4 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"unA4"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:807278421 1 udp 2122194687 192.168.1.13 65292 typ host generation 0 ufrag CxiG network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"CxiG"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2625697377 1 udp 2122262783 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 50514 typ host generation 0 ufrag CxiG network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"CxiG"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3427715704 1 udp 2122194687 192.168.1.13 51630 typ host generation 0 ufrag YsMd network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"YsMd"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3981877292 1 udp 2122262783 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 65071 typ host generation 0 ufrag YsMd network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"YsMd"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1322382797 1 tcp 1518214911 192.168.1.13 9 typ host tcptype active generation 0 ufrag CxiG network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"CxiG"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3796833529 1 tcp 1518283007 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 9 typ host tcptype active generation 0 ufrag CxiG network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"CxiG"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:853810924 1 tcp 1518214911 192.168.1.13 9 typ host tcptype active generation 0 ufrag YsMd network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"YsMd"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:335312056 1 tcp 1518283007 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 9 typ host tcptype active generation 0 ufrag YsMd network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"YsMd"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1894016508 1 udp 1685987071 117.129.35.233 22243 typ srflx raddr 192.168.1.13 rport 65292 generation 0 ufrag CxiG network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"CxiG"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 11:02:09 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:02:09 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:1661217606 1 udp 1685987071 117.129.35.233 22246 typ srflx raddr 192.168.1.13 rport 51630 generation 0 ufrag YsMd network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"YsMd"},"room_id":"563b2a81-4050-4ebe-85f2-a4fc400a6995"}}
2026/01/03 11:02:09 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 11:22:21 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 563b2a81-4050-4ebe-85f2-a4fc400a6995): websocket: close 1005 (no status)
2026/01/03 11:22:21 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 563b2a81-4050-4ebe-85f2-a4fc400a6995, 连接指针: 0x14000e7a1e0
2026/01/03 11:22:21 [RoomHub.Run] 收到 Broadcast 消息，类型: room_update, 房间ID: 563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:22:21 [broadcastToRoom] ENTER | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 type=room_update
2026/01/03 11:22:21 [broadcastToRoom] 准备获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:22:21 [broadcastToRoom] 已获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:22:21 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 roomSize=2
2026/01/03 11:22:21 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:22:21 [broadcastToRoom] 📢 向房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 的 2 个客户端广播消息类型: room_update
2026/01/03 11:22:21 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/03 11:22:21 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: 563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:22:21 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/03 11:22:21 [Unregister] 房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2026/01/03 11:22:21 [Unregister] 房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 保留（还有 1 个在线成员）
2026/01/03 11:22:21 [broadcastToRoom] ENTER | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 type=member_update
2026/01/03 11:22:21 [broadcastToRoom] 准备获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:22:21 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2026/01/03 11:22:21 [broadcastToRoom] 已获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:22:21 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 roomSize=1
2026/01/03 11:22:21 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:22:21 [broadcastToRoom] 📢 向房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 的 1 个客户端广播消息类型: member_update
2026/01/03 11:22:23 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/03 11:22:23 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003029c0
2026/01/03 11:22:23 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 11:22:25 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000e7a420
2026/01/03 11:22:25 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000e7a420
2026/01/03 11:22:25 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 11:22:25 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000e7a420
2026/01/03 11:22:25 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000fceb40
2026/01/03 11:22:25 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000fceb40
2026/01/03 11:22:25 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 11:22:25 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x14000e7a420, 新连接: 0x14000fceb40
2026/01/03 11:22:25 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/03 11:22:25 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000fceb40
2026/01/03 11:22:25 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/03 11:22:25 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000e7a420
2026/01/03 11:22:25 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 11:22:29 [RoomHub.Run] 收到 Broadcast 消息，类型: room_created, 房间ID: global
2026/01/03 11:22:29 [broadcastToRoom] ENTER | roomID=global type=room_created
2026/01/03 11:22:29 [broadcastToRoom] 准备获取 RLock | roomID=global
2026/01/03 11:22:29 [broadcastToRoom] 已获取 RLock | roomID=global
2026/01/03 11:22:29 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=global roomSize=16
2026/01/03 11:22:29 [broadcastToRoom] 已释放 RLock，recipients=16 | roomID=global
2026/01/03 11:22:29 [broadcastToRoom] 📢 向房间 global 的 16 个客户端广播消息类型: room_created
2026/01/03 11:22:29 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2026/01/03 11:22:29 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/03 11:22:29 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2026/01/03 11:22:30 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:30 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x14000fceb40, 新连接: 0x14000870000
2026/01/03 11:22:30 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/03 11:22:30 [Register] 房间 f76455cc-e02d-4848-aec6-66319643c22e 当前没有已上麦用户
2026/01/03 11:22:30 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=member_update
2026/01/03 11:22:30 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:30 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:30 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=1
2026/01/03 11:22:30 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:30 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:30 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e, 连接指针: 0x14000870000
2026/01/03 11:22:30 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 f76455cc-e02d-4848-aec6-66319643c22e 的消息，连接指针: 0x14000870000
2026/01/03 11:22:30 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:22:30 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:30 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 11:22:30 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 11:22:30 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:30 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:30 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=1
2026/01/03 11:22:30 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:30 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:30 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:22:30 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:30 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 11:22:30 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 11:22:30 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:30 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:30 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=1
2026/01/03 11:22:30 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:30 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:33 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 563b2a81-4050-4ebe-85f2-a4fc400a6995): websocket: close 1005 (no status)
2026/01/03 11:22:33 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 563b2a81-4050-4ebe-85f2-a4fc400a6995, 连接指针: 0x14000fce420
2026/01/03 11:22:33 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: 563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:22:33 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/03 11:22:33 [Unregister] 房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 清理客户端后，剩余成员数: 0, shouldDeleteRoom: true
2026/01/03 11:22:33 [Unregister] 房间 563b2a81-4050-4ebe-85f2-a4fc400a6995 已删除（没有在线成员）
2026/01/03 11:22:33 [broadcastToRoom] ENTER | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 type=member_update
2026/01/03 11:22:33 [broadcastToRoom] 准备获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:22:33 [broadcastToRoom] 已获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:22:33 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:22:33 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2026/01/03 11:22:33 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: 563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:22:33 [broadcastToRoom] ENTER | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995 type=room_deleted
2026/01/03 11:22:33 [broadcastToRoom] 准备获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:22:33 [broadcastToRoom] 已获取 RLock | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:22:33 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=563b2a81-4050-4ebe-85f2-a4fc400a6995
2026/01/03 11:22:33 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/03 11:22:36 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:36 [Register] 房间 f76455cc-e02d-4848-aec6-66319643c22e 当前已上麦用户: [1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/03 11:22:36 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=member_update
2026/01/03 11:22:36 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:36 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:36 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=2
2026/01/03 11:22:36 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:36 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 1 个客户端广播消息类型: member_update
2026/01/03 11:22:36 [Register] 准备向新用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 发送当前已上麦用户信息: [1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/03 11:22:36 [Register] ✅ 已向新用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 发送用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的上麦信息
2026/01/03 11:22:36 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e, 连接指针: 0x140000d7860
2026/01/03 11:22:36 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 f76455cc-e02d-4848-aec6-66319643c22e 的消息，连接指针: 0x140000d7860
2026/01/03 11:22:36 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:22:36 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:36 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 11:22:36 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 11:22:36 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:36 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:36 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=2
2026/01/03 11:22:36 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:36 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 1 个客户端广播消息类型: mic_on
2026/01/03 11:22:36 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:22:36 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:36 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 11:22:36 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 11:22:36 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:36 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:36 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=2
2026/01/03 11:22:36 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:36 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 1 个客户端广播消息类型: mic_on
2026/01/03 11:22:39 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e): websocket: close 1005 (no status)
2026/01/03 11:22:39 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e, 连接指针: 0x140000d7860
2026/01/03 11:22:39 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:39 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/03 11:22:39 [Unregister] 房间 f76455cc-e02d-4848-aec6-66319643c22e 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2026/01/03 11:22:39 [Unregister] 房间 f76455cc-e02d-4848-aec6-66319643c22e 保留（还有 1 个在线成员）
2026/01/03 11:22:39 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=member_update
2026/01/03 11:22:39 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2026/01/03 11:22:39 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:39 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:39 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=1
2026/01/03 11:22:39 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:39 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 1 个客户端广播消息类型: member_update
2026/01/03 11:22:39 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:22:39 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:39 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 11:22:39 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 11:22:39 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:39 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:39 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=1
2026/01/03 11:22:39 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:39 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:40 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:22:40 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:40 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 11:22:40 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 11:22:40 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:40 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:40 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=1
2026/01/03 11:22:40 [broadcastToRoom] 已释放 RLock，recipients=0 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:40 [broadcastToRoom] ⚠️ 无可接收者（排除发送者后为0）| roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:40 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2026/01/03 11:22:40 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000620840
2026/01/03 11:22:40 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/03 11:22:42 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140004145a0
2026/01/03 11:22:42 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140004145a0
2026/01/03 11:22:42 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/03 11:22:42 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x140004145a0
2026/01/03 11:22:42 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000cf4a80
2026/01/03 11:22:42 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000cf4a80
2026/01/03 11:22:42 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/03 11:22:42 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x140004145a0, 新连接: 0x14000cf4a80
2026/01/03 11:22:42 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2026/01/03 11:22:42 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x14000cf4a80
2026/01/03 11:22:42 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2026/01/03 11:22:42 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140004145a0
2026/01/03 11:22:42 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/03 11:22:43 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:43 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x14000cf4a80, 新连接: 0x14000cb0300
2026/01/03 11:22:43 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e, 连接指针: 0x14000cb0300
2026/01/03 11:22:43 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 f76455cc-e02d-4848-aec6-66319643c22e 的消息，连接指针: 0x14000cb0300
2026/01/03 11:22:43 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2026/01/03 11:22:43 [Register] 房间 f76455cc-e02d-4848-aec6-66319643c22e 当前已上麦用户: [1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/03 11:22:43 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=member_update
2026/01/03 11:22:43 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:43 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:43 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=2
2026/01/03 11:22:43 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:43 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 1 个客户端广播消息类型: member_update
2026/01/03 11:22:43 [Register] 准备向新用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 发送当前已上麦用户信息: [1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/03 11:22:43 [Register] ✅ 已向新用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 发送用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的上麦信息
2026/01/03 11:22:44 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:22:44 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:44 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 11:22:44 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 11:22:44 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:44 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:44 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=2
2026/01/03 11:22:44 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:44 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 1 个客户端广播消息类型: mic_on
2026/01/03 11:22:44 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:22:44 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:44 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 11:22:44 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 11:22:44 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:44 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:44 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=2
2026/01/03 11:22:44 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:44 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 1 个客户端广播消息类型: mic_on
2026/01/03 11:22:45 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:22:45 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:45 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_request'
2026/01/03 11:22:45 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的连麦申请 ==========
2026/01/03 11:22:45 [ReadPump] 房间ID: f76455cc-e02d-4848-aec6-66319643c22e, 准备广播给房间内其他成员
2026/01/03 11:22:45 [ReadPump] 已添加 username 到 Data: 小东
2026/01/03 11:22:45 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/03 11:22:45 [ReadPump] Data 字段内容: user_id=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, username=小东, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/03 11:22:45 [ReadPump] 消息顶层字段: UserID=6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, Username=小东, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小东
2026/01/03 11:22:45 [ReadPump] 准备调用 broadcastToRoom，房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:45 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_request
2026/01/03 11:22:45 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:45 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:45 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=2
2026/01/03 11:22:45 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:45 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 1 个客户端广播消息类型: mic_request
2026/01/03 11:22:45 [ReadPump] ✅ 连麦申请已广播给房间 f76455cc-e02d-4848-aec6-66319643c22e 的其他成员
2026/01/03 11:22:49 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:22:49 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:49 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2026/01/03 11:22:49 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2026/01/03 11:22:49 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:f76455cc-e02d-4848-aec6-66319643c22e UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:map[room_id:f76455cc-e02d-4848-aec6-66319643c22e target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa] Timestamp:1767410569}
2026/01/03 11:22:49 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:f76455cc-e02d-4848-aec6-66319643c22e target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/03 11:22:49 [ReadPump] Data 是 map，内容: map[room_id:f76455cc-e02d-4848-aec6-66319643c22e target_user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa user_id:6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/03 11:22:49 [ReadPump] Data 中的所有键: [target_user_id user_id room_id]
2026/01/03 11:22:49 [ReadPump] ✅ 找到 target_user_id: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa
2026/01/03 11:22:49 [ReadPump] 准备发送 mic_approved 给用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (房间 f76455cc-e02d-4848-aec6-66319643c22e)
2026/01/03 11:22:49 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_approved
2026/01/03 11:22:49 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:49 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:49 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=2
2026/01/03 11:22:49 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:49 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 1 个客户端广播消息类型: mic_approved
2026/01/03 11:22:49 [ReadPump] ✅ mic_approved 已广播给房间 f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:50 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:22:50 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:50 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_on'
2026/01/03 11:22:50 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 11:22:50 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:50 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:50 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=2
2026/01/03 11:22:50 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 11:22:50 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 1 个客户端广播消息类型: mic_on
2026/01/03 11:22:51 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:22:51 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","offer":{"sdp":"v=0\r\no=- 8790430028645912484 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 8e1c0a2e-e14b-40ff-a0da-d4c4aa4024d5\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:sKsB\r\na=ice-pwd:8rtmCOAe4eeSrmZJebMqn5XQ\r\na=ice-options:trickle\r\na=fingerprint:sha-256 AF:CA:76:C9:DD:3A:88:E3:A8:41:13:6A:45:80:04:5E:84:F3:E2:E2:5C:19:FD:38:FA:C7:EB:71:97:00:00:3F\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:8e1c0a2e-e14b-40ff-a0da-d4c4aa4024d5 a59cc499-cb2c-43a2-9c76-96ce69be86e1\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:2744501208 cname:kVs1BoRmFp3NRPsG\r\na=ssrc:2744501208 msid:8e1c0a2e-e14b-40ff-a0da-d4c4aa4024d5 a59cc499-cb2c-43a2-9c76-96ce69be86e1\r\n","type":"offer"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:51 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_offer'
2026/01/03 11:22:51 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:22:51 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:3189518896 1 udp 2122194687 192.168.1.13 50213 typ host generation 0 ufrag sKsB network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"sKsB"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:51 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/03 11:22:51 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:22:51 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:310563588 1 udp 2122262783 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 61970 typ host generation 0 ufrag sKsB network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"sKsB"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:51 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/03 11:22:51 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:22:51 [ReadPump] 消息内容: {"type":"webrtc_answer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","answer":{"sdp":"v=0\r\no=- 3864804721349644422 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 5b149920-cfa4-4fd4-be51-9d900c31a09d\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:7tr9\r\na=ice-pwd:5ah/j0O37JC+XEelJBWxHM3v\r\na=ice-options:trickle\r\na=fingerprint:sha-256 28:6D:09:C4:53:E1:A2:6C:1B:B8:07:DF:C0:CD:A5:B5:DB:C2:E5:72:D5:D4:40:EA:9E:7D:35:4E:AD:42:9F:0C\r\na=setup:active\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:5b149920-cfa4-4fd4-be51-9d900c31a09d 2bbfad8d-93e7-445c-9ac8-018f67572e80\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:3094845654 cname:aBzi2qIo3iT7inpP\r\n","type":"answer"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:51 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_answer'
2026/01/03 11:22:51 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:22:51 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:3235106984 1 tcp 1518214911 192.168.1.13 9 typ host tcptype active generation 0 ufrag sKsB network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"sKsB"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:51 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/03 11:22:51 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 11:22:51 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:1816998300 1 tcp 1518283007 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 9 typ host tcptype active generation 0 ufrag sKsB network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"sKsB"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:51 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/03 11:22:51 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:22:51 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:3184042928 1 udp 2122194687 192.168.1.13 56726 typ host generation 0 ufrag 7tr9 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"7tr9"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:51 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 11:22:51 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 11:22:51 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","candidate":{"candidate":"candidate:290865796 1 udp 2122262783 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 64674 typ host generation 0 ufrag 7tr9 network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"7tr9"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 11:22:51 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 11:23:14 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2026/01/03 11:23:36 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2026/01/03 12:03:47 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x14000cf50e0
2026/01/03 12:03:47 [ReadPump] ✅ 开始监听用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 在房间 global 的消息，连接指针: 0x14000cf50e0
2026/01/03 12:03:47 [Register] 新客户端注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2026/01/03 12:03:47 [Register] ✅ 全局连接已成功注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 当前全局在线用户数: 1, 连接指针: 0x14000cf50e0
2026/01/03 12:03:47 [Register] 新客户端注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2026/01/03 12:03:47 [Register] 检测到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的旧连接，准备替换 - 旧连接: 0x14000cf50e0, 新连接: 0x14000cf5140
2026/01/03 12:03:47 [Register] 已从 GlobalClients 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的旧连接
2026/01/03 12:03:47 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x14000cf5140
2026/01/03 12:03:47 [ReadPump] ✅ 开始监听用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 在房间 global 的消息，连接指针: 0x14000cf5140
2026/01/03 12:03:47 [Register] ✅ 全局连接已成功注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 当前全局在线用户数: 1, 连接指针: 0x14000cf5140
2026/01/03 12:03:47 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global): websocket: close 1001 (going away): WebSocket is closed before the connection is established.
2026/01/03 12:03:47 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x14000cf5140
2026/01/03 12:03:47 [Unregister] 客户端注销 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2026/01/03 12:03:47 [Unregister] 已从 GlobalClients 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左)
2026/01/03 12:03:47 [Unregister] 已从 GlobalByUserID 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左)
2026/01/03 12:03:48 [Register] 新客户端注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:48 [Register] 房间 f76455cc-e02d-4848-aec6-66319643c22e 当前已上麦用户: [1b7b6081-9139-4e57-b16e-7f0885ae5e43 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/03 12:03:48 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e, 连接指针: 0x14000e06300
2026/01/03 12:03:48 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=member_update
2026/01/03 12:03:48 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:48 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:48 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=3
2026/01/03 12:03:48 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:48 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 2 个客户端广播消息类型: member_update
2026/01/03 12:03:48 [ReadPump] ✅ 开始监听用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 在房间 f76455cc-e02d-4848-aec6-66319643c22e 的消息，连接指针: 0x14000e06300
2026/01/03 12:03:48 [Register] 准备向新用户 1ec34531-4001-46b1-b896-0a26b932553a 发送当前已上麦用户信息: [1b7b6081-9139-4e57-b16e-7f0885ae5e43 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa]
2026/01/03 12:03:48 [Register] ✅ 已向新用户 1ec34531-4001-46b1-b896-0a26b932553a 发送用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的上麦信息
2026/01/03 12:03:48 [Register] ✅ 已向新用户 1ec34531-4001-46b1-b896-0a26b932553a 发送用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 的上麦信息
2026/01/03 12:03:49 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:03:49 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:03:49 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 12:03:49 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 12:03:49 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:49 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:49 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=3
2026/01/03 12:03:49 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:49 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 2 个客户端广播消息类型: mic_on
2026/01/03 12:03:49 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:03:49 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:03:49 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 12:03:49 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 12:03:49 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:49 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:49 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=3
2026/01/03 12:03:49 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:49 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 2 个客户端广播消息类型: mic_on
2026/01/03 12:03:51 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:03:51 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"1ec34531-4001-46b1-b896-0a26b932553a","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:03:51 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'mic_request'
2026/01/03 12:03:51 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的连麦申请 ==========
2026/01/03 12:03:51 [ReadPump] 房间ID: f76455cc-e02d-4848-aec6-66319643c22e, 准备广播给房间内其他成员
2026/01/03 12:03:51 [ReadPump] 已添加 username 到 Data: 小左
2026/01/03 12:03:51 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小左
2026/01/03 12:03:51 [ReadPump] Data 字段内容: user_id=1ec34531-4001-46b1-b896-0a26b932553a, username=小左, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小左
2026/01/03 12:03:51 [ReadPump] 消息顶层字段: UserID=1ec34531-4001-46b1-b896-0a26b932553a, Username=小左, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小左
2026/01/03 12:03:51 [ReadPump] 准备调用 broadcastToRoom，房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:51 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_request
2026/01/03 12:03:51 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:51 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:51 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=3
2026/01/03 12:03:51 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:51 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 2 个客户端广播消息类型: mic_request
2026/01/03 12:03:51 [ReadPump] ✅ 连麦申请已广播给房间 f76455cc-e02d-4848-aec6-66319643c22e 的其他成员
2026/01/03 12:03:54 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:03:54 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"1ec34531-4001-46b1-b896-0a26b932553a","user_id":"1ec34531-4001-46b1-b896-0a26b932553a","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:03:54 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2026/01/03 12:03:54 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2026/01/03 12:03:54 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:f76455cc-e02d-4848-aec6-66319643c22e UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:map[room_id:f76455cc-e02d-4848-aec6-66319643c22e target_user_id:1ec34531-4001-46b1-b896-0a26b932553a user_id:1ec34531-4001-46b1-b896-0a26b932553a] Timestamp:1767413034}
2026/01/03 12:03:54 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:f76455cc-e02d-4848-aec6-66319643c22e target_user_id:1ec34531-4001-46b1-b896-0a26b932553a user_id:1ec34531-4001-46b1-b896-0a26b932553a]
2026/01/03 12:03:54 [ReadPump] Data 是 map，内容: map[room_id:f76455cc-e02d-4848-aec6-66319643c22e target_user_id:1ec34531-4001-46b1-b896-0a26b932553a user_id:1ec34531-4001-46b1-b896-0a26b932553a]
2026/01/03 12:03:54 [ReadPump] Data 中的所有键: [room_id target_user_id user_id]
2026/01/03 12:03:54 [ReadPump] ✅ 找到 target_user_id: 1ec34531-4001-46b1-b896-0a26b932553a
2026/01/03 12:03:54 [ReadPump] 准备发送 mic_approved 给用户 1ec34531-4001-46b1-b896-0a26b932553a (房间 f76455cc-e02d-4848-aec6-66319643c22e)
2026/01/03 12:03:54 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_approved
2026/01/03 12:03:54 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:54 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:54 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=3
2026/01/03 12:03:54 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:54 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 2 个客户端广播消息类型: mic_approved
2026/01/03 12:03:54 [ReadPump] ✅ mic_approved 已广播给房间 f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:03:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 12:03:54 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1ec34531-4001-46b1-b896-0a26b932553a","user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","offer":{"sdp":"v=0\r\no=- 5317760488007311698 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 5b149920-cfa4-4fd4-be51-9d900c31a09d\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:6oBK\r\na=ice-pwd:zL3XvApiUQW/zajD5h7DBeXy\r\na=ice-options:trickle\r\na=fingerprint:sha-256 67:5C:DF:7E:31:B0:CF:80:E1:8B:9B:11:B6:B4:C4:5D:04:70:9B:70:5B:D2:AB:F8:21:BA:5E:B2:2B:F1:24:71\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:5b149920-cfa4-4fd4-be51-9d900c31a09d 2bbfad8d-93e7-445c-9ac8-018f67572e80\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:3825417945 cname:rJg9GtXmVeFgSfkz\r\na=ssrc:3825417945 msid:5b149920-cfa4-4fd4-be51-9d900c31a09d 2bbfad8d-93e7-445c-9ac8-018f67572e80\r\n","type":"offer"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:03:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_offer'
2026/01/03 12:03:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 12:03:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1ec34531-4001-46b1-b896-0a26b932553a","candidate":{"candidate":"candidate:3751499558 1 udp 2122194687 192.168.1.13 65138 typ host generation 0 ufrag 6oBK network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"6oBK"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:03:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 12:03:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 12:03:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1ec34531-4001-46b1-b896-0a26b932553a","candidate":{"candidate":"candidate:4270013810 1 udp 2122262783 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 55790 typ host generation 0 ufrag 6oBK network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"6oBK"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:03:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 12:03:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 12:03:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1ec34531-4001-46b1-b896-0a26b932553a","candidate":{"candidate":"candidate:1892791832 1 udp 1685987071 117.129.35.233 22340 typ srflx raddr 192.168.1.13 rport 65138 generation 0 ufrag 6oBK network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"6oBK"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:03:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 12:03:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 12:03:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1ec34531-4001-46b1-b896-0a26b932553a","candidate":{"candidate":"candidate:556893106 1 tcp 1518214911 192.168.1.13 9 typ host tcptype active generation 0 ufrag 6oBK network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"6oBK"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:03:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 12:03:54 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 12:03:54 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1ec34531-4001-46b1-b896-0a26b932553a","candidate":{"candidate":"candidate:2746854 1 tcp 1518283007 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 9 typ host tcptype active generation 0 ufrag 6oBK network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"6oBK"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:03:54 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'webrtc_ice'
2026/01/03 12:04:08 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:04:08 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"1ec34531-4001-46b1-b896-0a26b932553a","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:04:08 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'mic_request'
2026/01/03 12:04:08 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的连麦申请 ==========
2026/01/03 12:04:08 [ReadPump] 房间ID: f76455cc-e02d-4848-aec6-66319643c22e, 准备广播给房间内其他成员
2026/01/03 12:04:08 [ReadPump] 已添加 username 到 Data: 小左
2026/01/03 12:04:08 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小左
2026/01/03 12:04:08 [ReadPump] Data 字段内容: user_id=1ec34531-4001-46b1-b896-0a26b932553a, username=小左, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小左
2026/01/03 12:04:08 [ReadPump] 消息顶层字段: UserID=1ec34531-4001-46b1-b896-0a26b932553a, Username=小左, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小左
2026/01/03 12:04:08 [ReadPump] 准备调用 broadcastToRoom，房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:08 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_request
2026/01/03 12:04:08 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:08 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:08 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=3
2026/01/03 12:04:08 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:08 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 2 个客户端广播消息类型: mic_request
2026/01/03 12:04:08 [ReadPump] ✅ 连麦申请已广播给房间 f76455cc-e02d-4848-aec6-66319643c22e 的其他成员
2026/01/03 12:04:10 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:04:10 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"1ec34531-4001-46b1-b896-0a26b932553a","user_id":"1ec34531-4001-46b1-b896-0a26b932553a","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:04:10 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2026/01/03 12:04:10 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2026/01/03 12:04:10 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:f76455cc-e02d-4848-aec6-66319643c22e UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:map[room_id:f76455cc-e02d-4848-aec6-66319643c22e target_user_id:1ec34531-4001-46b1-b896-0a26b932553a user_id:1ec34531-4001-46b1-b896-0a26b932553a] Timestamp:1767413050}
2026/01/03 12:04:10 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:f76455cc-e02d-4848-aec6-66319643c22e target_user_id:1ec34531-4001-46b1-b896-0a26b932553a user_id:1ec34531-4001-46b1-b896-0a26b932553a]
2026/01/03 12:04:10 [ReadPump] Data 是 map，内容: map[room_id:f76455cc-e02d-4848-aec6-66319643c22e target_user_id:1ec34531-4001-46b1-b896-0a26b932553a user_id:1ec34531-4001-46b1-b896-0a26b932553a]
2026/01/03 12:04:10 [ReadPump] Data 中的所有键: [target_user_id user_id room_id]
2026/01/03 12:04:10 [ReadPump] ✅ 找到 target_user_id: 1ec34531-4001-46b1-b896-0a26b932553a
2026/01/03 12:04:10 [ReadPump] 准备发送 mic_approved 给用户 1ec34531-4001-46b1-b896-0a26b932553a (房间 f76455cc-e02d-4848-aec6-66319643c22e)
2026/01/03 12:04:10 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_approved
2026/01/03 12:04:10 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:10 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:10 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=3
2026/01/03 12:04:10 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:10 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 2 个客户端广播消息类型: mic_approved
2026/01/03 12:04:10 [ReadPump] ✅ mic_approved 已广播给房间 f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:18 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:04:18 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"1ec34531-4001-46b1-b896-0a26b932553a","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:04:18 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'mic_request'
2026/01/03 12:04:18 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的连麦申请 ==========
2026/01/03 12:04:18 [ReadPump] 房间ID: f76455cc-e02d-4848-aec6-66319643c22e, 准备广播给房间内其他成员
2026/01/03 12:04:18 [ReadPump] 已添加 username 到 Data: 小左
2026/01/03 12:04:18 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小左
2026/01/03 12:04:18 [ReadPump] Data 字段内容: user_id=1ec34531-4001-46b1-b896-0a26b932553a, username=小左, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小左
2026/01/03 12:04:18 [ReadPump] 消息顶层字段: UserID=1ec34531-4001-46b1-b896-0a26b932553a, Username=小左, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小左
2026/01/03 12:04:18 [ReadPump] 准备调用 broadcastToRoom，房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:18 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_request
2026/01/03 12:04:18 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:18 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:18 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=3
2026/01/03 12:04:18 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:18 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 2 个客户端广播消息类型: mic_request
2026/01/03 12:04:18 [ReadPump] ✅ 连麦申请已广播给房间 f76455cc-e02d-4848-aec6-66319643c22e 的其他成员
2026/01/03 12:04:19 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:04:19 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"1ec34531-4001-46b1-b896-0a26b932553a","user_id":"1ec34531-4001-46b1-b896-0a26b932553a","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:04:19 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2026/01/03 12:04:19 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2026/01/03 12:04:19 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:f76455cc-e02d-4848-aec6-66319643c22e UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:map[room_id:f76455cc-e02d-4848-aec6-66319643c22e target_user_id:1ec34531-4001-46b1-b896-0a26b932553a user_id:1ec34531-4001-46b1-b896-0a26b932553a] Timestamp:1767413059}
2026/01/03 12:04:19 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:f76455cc-e02d-4848-aec6-66319643c22e target_user_id:1ec34531-4001-46b1-b896-0a26b932553a user_id:1ec34531-4001-46b1-b896-0a26b932553a]
2026/01/03 12:04:19 [ReadPump] Data 是 map，内容: map[room_id:f76455cc-e02d-4848-aec6-66319643c22e target_user_id:1ec34531-4001-46b1-b896-0a26b932553a user_id:1ec34531-4001-46b1-b896-0a26b932553a]
2026/01/03 12:04:19 [ReadPump] Data 中的所有键: [target_user_id user_id room_id]
2026/01/03 12:04:19 [ReadPump] ✅ 找到 target_user_id: 1ec34531-4001-46b1-b896-0a26b932553a
2026/01/03 12:04:19 [ReadPump] 准备发送 mic_approved 给用户 1ec34531-4001-46b1-b896-0a26b932553a (房间 f76455cc-e02d-4848-aec6-66319643c22e)
2026/01/03 12:04:19 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_approved
2026/01/03 12:04:19 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:19 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:19 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=3
2026/01/03 12:04:19 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:19 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 2 个客户端广播消息类型: mic_approved
2026/01/03 12:04:19 [ReadPump] ✅ mic_approved 已广播给房间 f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:41 [WritePump] 用户 1ec34531-4001-46b1-b896-0a26b932553a (小左): 发送 ping 消息失败: websocket: close sent
2026/01/03 12:04:47 [Register] 新客户端注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2026/01/03 12:04:47 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x140005a0480
2026/01/03 12:04:47 [ReadPump] ✅ 开始监听用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 在房间 global 的消息，连接指针: 0x140005a0480
2026/01/03 12:04:47 [Register] 检测到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的旧连接，准备替换 - 旧连接: 0x14000e06300, 新连接: 0x140005a0480
2026/01/03 12:04:47 [Register] 已从 GlobalClients 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的旧连接
2026/01/03 12:04:47 [Register] ✅ 全局连接已成功注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 当前全局在线用户数: 1, 连接指针: 0x140005a0480
2026/01/03 12:04:47 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x14000cb0360
2026/01/03 12:04:47 [ReadPump] ✅ 开始监听用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 在房间 global 的消息，连接指针: 0x14000cb0360
2026/01/03 12:04:47 [Register] 新客户端注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2026/01/03 12:04:47 [Register] 检测到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的旧连接，准备替换 - 旧连接: 0x140005a0480, 新连接: 0x14000cb0360
2026/01/03 12:04:47 [Register] 已从 GlobalClients 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的旧连接
2026/01/03 12:04:47 [Register] ✅ 全局连接已成功注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 当前全局在线用户数: 1, 连接指针: 0x14000cb0360
2026/01/03 12:04:47 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global): websocket: close 1001 (going away)
2026/01/03 12:04:47 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x140005a0480
2026/01/03 12:04:47 [Unregister] 客户端注销 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2026/01/03 12:04:48 [Register] 新客户端注册 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:48 [Register] 检测到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的旧连接，准备替换 - 旧连接: 0x14000cb0360, 新连接: 0x14000cf5860
2026/01/03 12:04:48 [Register] 已从 GlobalClients 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的旧连接
2026/01/03 12:04:48 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e, 连接指针: 0x14000cf5860
2026/01/03 12:04:48 [Register] 房间 f76455cc-e02d-4848-aec6-66319643c22e 当前已上麦用户: [6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/03 12:04:48 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=member_update
2026/01/03 12:04:48 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:48 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:48 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=4
2026/01/03 12:04:48 [broadcastToRoom] 已释放 RLock，recipients=3 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:48 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 3 个客户端广播消息类型: member_update
2026/01/03 12:04:48 [Register] 准备向新用户 1ec34531-4001-46b1-b896-0a26b932553a 发送当前已上麦用户信息: [6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 1b7b6081-9139-4e57-b16e-7f0885ae5e43]
2026/01/03 12:04:48 [Register] ✅ 已向新用户 1ec34531-4001-46b1-b896-0a26b932553a 发送用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa 的上麦信息
2026/01/03 12:04:48 [Register] ✅ 已向新用户 1ec34531-4001-46b1-b896-0a26b932553a 发送用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 的上麦信息
2026/01/03 12:04:48 [ReadPump] ✅ 开始监听用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 在房间 f76455cc-e02d-4848-aec6-66319643c22e 的消息，连接指针: 0x14000cf5860
2026/01/03 12:04:49 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:04:49 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:04:49 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 12:04:49 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 12:04:49 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:49 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:49 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=4
2026/01/03 12:04:49 [broadcastToRoom] 已释放 RLock，recipients=3 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:49 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 3 个客户端广播消息类型: mic_on
2026/01/03 12:04:49 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:04:49 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:04:49 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 12:04:49 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 12:04:49 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:49 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:49 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=4
2026/01/03 12:04:49 [broadcastToRoom] 已释放 RLock，recipients=3 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:49 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 3 个客户端广播消息类型: mic_on
2026/01/03 12:04:51 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:04:51 [ReadPump] 消息内容: {"type":"mic_request","data":{"user_id":"1ec34531-4001-46b1-b896-0a26b932553a","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:04:51 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'mic_request'
2026/01/03 12:04:51 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的连麦申请 ==========
2026/01/03 12:04:51 [ReadPump] 房间ID: f76455cc-e02d-4848-aec6-66319643c22e, 准备广播给房间内其他成员
2026/01/03 12:04:51 [ReadPump] 已添加 username 到 Data: 小左
2026/01/03 12:04:51 [ReadPump] 已添加 avatar_url 到 Data: https://api.dicebear.com/7.x/avataaars/svg?seed=小左
2026/01/03 12:04:51 [ReadPump] Data 字段内容: user_id=1ec34531-4001-46b1-b896-0a26b932553a, username=小左, avatar_url=https://api.dicebear.com/7.x/avataaars/svg?seed=小左
2026/01/03 12:04:51 [ReadPump] 消息顶层字段: UserID=1ec34531-4001-46b1-b896-0a26b932553a, Username=小左, AvatarURL=https://api.dicebear.com/7.x/avataaars/svg?seed=小左
2026/01/03 12:04:51 [ReadPump] 准备调用 broadcastToRoom，房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:51 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_request
2026/01/03 12:04:51 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:51 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:51 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=4
2026/01/03 12:04:51 [broadcastToRoom] 已释放 RLock，recipients=3 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:51 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 3 个客户端广播消息类型: mic_request
2026/01/03 12:04:51 [ReadPump] ✅ 连麦申请已广播给房间 f76455cc-e02d-4848-aec6-66319643c22e 的其他成员
2026/01/03 12:04:56 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:04:56 [ReadPump] 消息内容: {"type":"mic_approve","data":{"target_user_id":"1ec34531-4001-46b1-b896-0a26b932553a","user_id":"1ec34531-4001-46b1-b896-0a26b932553a","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:04:56 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_approve'
2026/01/03 12:04:56 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 mic_approve 消息 ==========
2026/01/03 12:04:56 [ReadPump] mic_approve 消息完整内容: {Type:mic_approve RoomID:f76455cc-e02d-4848-aec6-66319643c22e UserID:1b7b6081-9139-4e57-b16e-7f0885ae5e43 Username:小北 AvatarURL:https://api.dicebear.com/7.x/avataaars/svg?seed=小北 Content: Data:map[room_id:f76455cc-e02d-4848-aec6-66319643c22e target_user_id:1ec34531-4001-46b1-b896-0a26b932553a user_id:1ec34531-4001-46b1-b896-0a26b932553a] Timestamp:1767413096}
2026/01/03 12:04:56 [ReadPump] message.Data 类型: map[string]interface {}, 值: map[room_id:f76455cc-e02d-4848-aec6-66319643c22e target_user_id:1ec34531-4001-46b1-b896-0a26b932553a user_id:1ec34531-4001-46b1-b896-0a26b932553a]
2026/01/03 12:04:56 [ReadPump] Data 是 map，内容: map[room_id:f76455cc-e02d-4848-aec6-66319643c22e target_user_id:1ec34531-4001-46b1-b896-0a26b932553a user_id:1ec34531-4001-46b1-b896-0a26b932553a]
2026/01/03 12:04:56 [ReadPump] Data 中的所有键: [target_user_id user_id room_id]
2026/01/03 12:04:56 [ReadPump] ✅ 找到 target_user_id: 1ec34531-4001-46b1-b896-0a26b932553a
2026/01/03 12:04:56 [ReadPump] 准备发送 mic_approved 给用户 1ec34531-4001-46b1-b896-0a26b932553a (房间 f76455cc-e02d-4848-aec6-66319643c22e)
2026/01/03 12:04:56 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_approved
2026/01/03 12:04:56 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:56 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:56 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=4
2026/01/03 12:04:56 [broadcastToRoom] 已释放 RLock，recipients=3 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:04:56 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 3 个客户端广播消息类型: mic_approved
2026/01/03 12:04:56 [ReadPump] ✅ mic_approved 已广播给房间 f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:01 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:05:01 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1ec34531-4001-46b1-b896-0a26b932553a","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:01 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'mic_on'
2026/01/03 12:05:01 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 12:05:01 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:01 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:01 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=4
2026/01/03 12:05:01 [broadcastToRoom] 已释放 RLock，recipients=3 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:01 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 3 个客户端广播消息类型: mic_on
2026/01/03 12:05:01 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:05:01 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1ec34531-4001-46b1-b896-0a26b932553a","user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","offer":{"sdp":"v=0\r\no=- 6439719892292690419 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 24ca09d0-29b6-4eb5-98a5-0cefeea8bfb9\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:vdx6\r\na=ice-pwd:j4TSfQJkrcnFDd3tBLDtLX2A\r\na=ice-options:trickle\r\na=fingerprint:sha-256 6D:D9:A9:0A:47:27:82:E8:DE:88:34:30:AA:4E:3B:4F:CC:14:23:D4:EB:72:59:75:A3:4F:2F:C8:C0:EF:7E:36\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:24ca09d0-29b6-4eb5-98a5-0cefeea8bfb9 f7cdc124-4d70-4ce6-94f2-6ed7c47e3c17\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:3072685328 cname:0F/GGfnBHUrkXApq\r\na=ssrc:3072685328 msid:24ca09d0-29b6-4eb5-98a5-0cefeea8bfb9 f7cdc124-4d70-4ce6-94f2-6ed7c47e3c17\r\n","type":"offer"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:01 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_offer'
2026/01/03 12:05:01 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:05:01 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1ec34531-4001-46b1-b896-0a26b932553a","candidate":{"candidate":"candidate:1094099979 1 udp 2122194687 192.168.1.13 50535 typ host generation 0 ufrag vdx6 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"vdx6"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:01 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/03 12:05:01 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:05:01 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1ec34531-4001-46b1-b896-0a26b932553a","candidate":{"candidate":"candidate:3987227967 1 udp 2122262783 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 49172 typ host generation 0 ufrag vdx6 network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"vdx6"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:01 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/03 12:05:02 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:05:02 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1ec34531-4001-46b1-b896-0a26b932553a","candidate":{"candidate":"candidate:1073301139 1 tcp 1518214911 192.168.1.13 9 typ host tcptype active generation 0 ufrag vdx6 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"vdx6"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:02 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/03 12:05:02 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:05:02 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1ec34531-4001-46b1-b896-0a26b932553a","candidate":{"candidate":"candidate:2473043879 1 tcp 1518283007 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 9 typ host tcptype active generation 0 ufrag vdx6 network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"vdx6"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:02 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/03 12:05:02 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:05:02 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1ec34531-4001-46b1-b896-0a26b932553a","candidate":{"candidate":"candidate:30201506 1 udp 1685987071 117.129.35.233 22482 typ srflx raddr 192.168.1.13 rport 50535 generation 0 ufrag vdx6 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"vdx6"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:02 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'webrtc_ice'
2026/01/03 12:05:02 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:05:02 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"1ec34531-4001-46b1-b896-0a26b932553a","offer":{"sdp":"v=0\r\no=- 8095342940919053376 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS a9b8b672-277c-4de3-b313-002aecd87f95\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:F+52\r\na=ice-pwd:i7fPM0LQC+ElcVtJpOxULluu\r\na=ice-options:trickle\r\na=fingerprint:sha-256 E8:07:1E:8C:EE:87:38:D4:42:69:55:C1:91:21:88:A7:DE:C7:8B:61:23:CD:11:91:F1:C0:F1:5A:33:C7:91:FF\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:a9b8b672-277c-4de3-b313-002aecd87f95 ede34f4b-f28c-4fb4-a86d-9c3c4754c99d\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:574194053 cname:FVI22DC9htvFVRil\r\na=ssrc:574194053 msid:a9b8b672-277c-4de3-b313-002aecd87f95 ede34f4b-f28c-4fb4-a86d-9c3c4754c99d\r\n","type":"offer"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:02 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'webrtc_offer'
2026/01/03 12:05:02 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:05:02 [ReadPump] 消息内容: {"type":"webrtc_offer","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","user_id":"1ec34531-4001-46b1-b896-0a26b932553a","offer":{"sdp":"v=0\r\no=- 6386165277172264312 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS a9b8b672-277c-4de3-b313-002aecd87f95\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:+2OL\r\na=ice-pwd:XpIK/+Zi0XUcmpMYFbR0rJPN\r\na=ice-options:trickle\r\na=fingerprint:sha-256 E2:07:28:03:64:D0:60:E1:30:0E:11:1E:8F:41:F3:80:8D:A6:83:DD:0F:9C:40:AD:99:F9:AD:47:AF:D9:B9:F7\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\na=msid:a9b8b672-277c-4de3-b313-002aecd87f95 ede34f4b-f28c-4fb4-a86d-9c3c4754c99d\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:63 red/48000/2\r\na=fmtp:63 111/111\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:110 telephone-event/48000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:94562468 cname:TnrcMe+gyrO54BCj\r\na=ssrc:94562468 msid:a9b8b672-277c-4de3-b313-002aecd87f95 ede34f4b-f28c-4fb4-a86d-9c3c4754c99d\r\n","type":"offer"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:02 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'webrtc_offer'
2026/01/03 12:05:02 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:05:02 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:796768607 1 udp 2122194687 192.168.1.13 52435 typ host generation 0 ufrag F+52 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"F+52"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:02 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'webrtc_ice'
2026/01/03 12:05:02 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:05:02 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:241554187 1 udp 2122262783 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 64003 typ host generation 0 ufrag F+52 network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"F+52"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:02 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'webrtc_ice'
2026/01/03 12:05:02 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:05:02 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2025473737 1 udp 2122194687 192.168.1.13 50396 typ host generation 0 ufrag +2OL network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"+2OL"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:02 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'webrtc_ice'
2026/01/03 12:05:02 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:05:02 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3559172093 1 udp 2122262783 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 65313 typ host generation 0 ufrag +2OL network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"+2OL"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:02 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'webrtc_ice'
2026/01/03 12:05:02 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:05:02 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:3520556491 1 tcp 1518214911 192.168.1.13 9 typ host tcptype active generation 0 ufrag F+52 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"F+52"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:02 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'webrtc_ice'
2026/01/03 12:05:02 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:05:02 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:4040099743 1 tcp 1518283007 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 9 typ host tcptype active generation 0 ufrag F+52 network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"F+52"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:02 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'webrtc_ice'
2026/01/03 12:05:02 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:05:02 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:108373073 1 tcp 1518214911 192.168.1.13 9 typ host tcptype active generation 0 ufrag +2OL network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"+2OL"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:02 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'webrtc_ice'
2026/01/03 12:05:02 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:05:02 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2867545445 1 tcp 1518283007 2409:8a00:26c8:9760:c530:52b:d47a:8cf9 9 typ host tcptype active generation 0 ufrag +2OL network-id 2 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"+2OL"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:02 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'webrtc_ice'
2026/01/03 12:05:02 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:05:02 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:2151110753 1 udp 1685987071 117.129.35.233 22483 typ srflx raddr 192.168.1.13 rport 52435 generation 0 ufrag F+52 network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"F+52"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:02 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'webrtc_ice'
2026/01/03 12:05:02 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:05:02 [ReadPump] 消息内容: {"type":"webrtc_ice","data":{"target_user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","candidate":{"candidate":"candidate:943731808 1 udp 1685987071 117.129.35.233 22484 typ srflx raddr 192.168.1.13 rport 50396 generation 0 ufrag +2OL network-id 1 network-cost 10","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"+2OL"},"room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:02 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'webrtc_ice'
2026/01/03 12:05:28 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:05:28 [ReadPump] 消息内容: {"type":"mic_mute","data":{"user_id":"1ec34531-4001-46b1-b896-0a26b932553a","room_id":"f76455cc-e02d-4848-aec6-66319643c22e","muted":true}}
2026/01/03 12:05:28 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'mic_mute'
2026/01/03 12:05:28 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_mute
2026/01/03 12:05:28 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:28 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:28 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=4
2026/01/03 12:05:28 [broadcastToRoom] 已释放 RLock，recipients=3 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:28 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 3 个客户端广播消息类型: mic_mute
2026/01/03 12:05:31 [ReadPump] ========== 收到用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的原始消息 ==========
2026/01/03 12:05:31 [ReadPump] 消息内容: {"type":"mic_mute","data":{"user_id":"1ec34531-4001-46b1-b896-0a26b932553a","room_id":"f76455cc-e02d-4848-aec6-66319643c22e","muted":false}}
2026/01/03 12:05:31 [ReadPump] 解析用户 1ec34531-4001-46b1-b896-0a26b932553a (小左) 的消息类型为 'mic_mute'
2026/01/03 12:05:31 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_mute
2026/01/03 12:05:31 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:31 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:31 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=4
2026/01/03 12:05:31 [broadcastToRoom] 已释放 RLock，recipients=3 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:31 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 3 个客户端广播消息类型: mic_mute
2026/01/03 12:05:40 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e): websocket: close 1001 (going away)
2026/01/03 12:05:40 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e, 连接指针: 0x14000cf5860
2026/01/03 12:05:40 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global): websocket: close 1001 (going away)
2026/01/03 12:05:40 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x14000cb0360
2026/01/03 12:05:40 [Unregister] 客户端注销 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2026/01/03 12:05:40 [Unregister] 客户端注销 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:40 [Unregister] 已从 GlobalByUserID 中移除用户 1ec34531-4001-46b1-b896-0a26b932553a (小左)
2026/01/03 12:05:40 [Unregister] 房间 f76455cc-e02d-4848-aec6-66319643c22e 清理客户端后，剩余成员数: 3, shouldDeleteRoom: false
2026/01/03 12:05:40 [Unregister] 房间 f76455cc-e02d-4848-aec6-66319643c22e 保留（还有 3 个在线成员）
2026/01/03 12:05:40 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=member_update
2026/01/03 12:05:40 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:40 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:40 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=3
2026/01/03 12:05:40 [broadcastToRoom] 已释放 RLock，recipients=3 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:40 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 3 个客户端广播消息类型: member_update
2026/01/03 12:05:40 [WritePump] 用户 1ec34531-4001-46b1-b896-0a26b932553a (小左): Hub 关闭了发送通道
2026/01/03 12:05:41 [WritePump] 用户 1ec34531-4001-46b1-b896-0a26b932553a (小左): 发送 ping 消息失败: websocket: close sent
2026/01/03 12:05:41 [WritePump] 用户 1ec34531-4001-46b1-b896-0a26b932553a (小左): 发送 ping 消息失败: websocket: close sent
2026/01/03 12:05:42 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:05:42 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:42 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 12:05:42 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 12:05:42 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:42 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:42 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=3
2026/01/03 12:05:42 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:42 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 2 个客户端广播消息类型: mic_on
2026/01/03 12:05:42 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:05:42 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"1b7b6081-9139-4e57-b16e-7f0885ae5e43","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:42 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 'mic_on'
2026/01/03 12:05:42 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 12:05:42 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:42 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:42 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=3
2026/01/03 12:05:42 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:42 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 2 个客户端广播消息类型: mic_on
2026/01/03 12:05:46 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e): websocket: close 1005 (no status)
2026/01/03 12:05:46 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e, 连接指针: 0x14000870000
2026/01/03 12:05:46 [RoomHub.Run] 收到 Broadcast 消息，类型: room_update, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:46 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=room_update
2026/01/03 12:05:46 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:46 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:46 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=3
2026/01/03 12:05:46 [broadcastToRoom] 已释放 RLock，recipients=3 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:46 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 3 个客户端广播消息类型: room_update
2026/01/03 12:05:46 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/03 12:05:46 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:46 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/03 12:05:46 [Unregister] 房间 f76455cc-e02d-4848-aec6-66319643c22e 清理客户端后，剩余成员数: 2, shouldDeleteRoom: false
2026/01/03 12:05:46 [Unregister] 房间 f76455cc-e02d-4848-aec6-66319643c22e 保留（还有 2 个在线成员）
2026/01/03 12:05:46 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=member_update
2026/01/03 12:05:46 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 获取写入器失败: websocket: close sent
2026/01/03 12:05:46 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:46 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:46 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=2
2026/01/03 12:05:46 [broadcastToRoom] 已释放 RLock，recipients=2 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:46 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 2 个客户端广播消息类型: member_update
2026/01/03 12:05:47 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 12:05:47 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:47 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_on'
2026/01/03 12:05:47 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 12:05:47 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:47 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:47 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=2
2026/01/03 12:05:47 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:47 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 1 个客户端广播消息类型: mic_on
2026/01/03 12:05:47 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/03 12:05:47 [ReadPump] 消息内容: {"type":"mic_on","data":{"user_id":"6f0cafb9-6cd4-44e0-b52b-105afd0f0faa","room_id":"f76455cc-e02d-4848-aec6-66319643c22e"}}
2026/01/03 12:05:47 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 'mic_on'
2026/01/03 12:05:47 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=mic_on
2026/01/03 12:05:47 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:47 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:47 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=2
2026/01/03 12:05:47 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:47 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 1 个客户端广播消息类型: mic_on
2026/01/03 12:05:54 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e): websocket: close 1005 (no status)
2026/01/03 12:05:54 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e, 连接指针: 0x14000cb0300
2026/01/03 12:05:54 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:54 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/03 12:05:54 [Unregister] 房间 f76455cc-e02d-4848-aec6-66319643c22e 清理客户端后，剩余成员数: 1, shouldDeleteRoom: false
2026/01/03 12:05:54 [Unregister] 房间 f76455cc-e02d-4848-aec6-66319643c22e 保留（还有 1 个在线成员）
2026/01/03 12:05:54 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=member_update
2026/01/03 12:05:54 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:54 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:54 [broadcastToRoom] 房间存在，开始复制 recipients | roomID=f76455cc-e02d-4848-aec6-66319643c22e roomSize=1
2026/01/03 12:05:54 [broadcastToRoom] 已释放 RLock，recipients=1 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:05:54 [broadcastToRoom] 📢 向房间 f76455cc-e02d-4848-aec6-66319643c22e 的 1 个客户端广播消息类型: member_update
2026/01/03 12:05:54 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): Hub 关闭了发送通道
2026/01/03 12:06:02 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e): websocket: close 1001 (going away)
2026/01/03 12:06:02 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e, 连接指针: 0x14000e06300
2026/01/03 12:06:02 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global): websocket: close 1001 (going away)
2026/01/03 12:06:02 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global, 连接指针: 0x14000cf50e0
2026/01/03 12:06:02 [Unregister] 客户端注销 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: global
2026/01/03 12:06:02 [Unregister] 客户端注销 - 用户ID: 1ec34531-4001-46b1-b896-0a26b932553a, 用户名: 小左, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:06:02 [Unregister] 房间 f76455cc-e02d-4848-aec6-66319643c22e 清理客户端后，剩余成员数: 0, shouldDeleteRoom: true
2026/01/03 12:06:02 [Unregister] 房间 f76455cc-e02d-4848-aec6-66319643c22e 已删除（没有在线成员）
2026/01/03 12:06:02 [WritePump] 用户 1ec34531-4001-46b1-b896-0a26b932553a (小左): Hub 关闭了发送通道
2026/01/03 12:06:02 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=member_update
2026/01/03 12:06:02 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:06:02 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:06:02 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:06:02 [WritePump] 用户 1ec34531-4001-46b1-b896-0a26b932553a (小左): 获取写入器失败: websocket: close sent
2026/01/03 12:06:03 [RoomHub.Run] 收到 Broadcast 消息，类型: room_deleted, 房间ID: f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:06:03 [broadcastToRoom] ENTER | roomID=f76455cc-e02d-4848-aec6-66319643c22e type=room_deleted
2026/01/03 12:06:03 [broadcastToRoom] 准备获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:06:03 [broadcastToRoom] 已获取 RLock | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:06:03 [broadcastToRoom] 🚫 房间不存在，无法广播 | roomID=f76455cc-e02d-4848-aec6-66319643c22e
2026/01/03 12:06:03 [RoomHub.Run] ✅ Broadcast 消息已处理完成
2026/01/03 12:06:06 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/03 12:06:06 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000fceb40
2026/01/03 12:06:06 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 12:06:08 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000870480
2026/01/03 12:06:08 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000870480
2026/01/03 12:06:08 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 12:06:08 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000870480
2026/01/03 12:06:08 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000acea0
2026/01/03 12:06:08 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000acea0
2026/01/03 12:06:08 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 12:06:08 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x14000870480, 新连接: 0x140000acea0
2026/01/03 12:06:08 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/03 12:06:08 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000acea0
2026/01/03 12:06:08 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/03 12:06:08 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000870480
2026/01/03 12:06:08 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 12:06:09 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008704e0
2026/01/03 12:06:09 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008704e0
2026/01/03 12:06:09 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 12:06:09 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140000acea0, 新连接: 0x140008704e0
2026/01/03 12:06:09 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/03 12:06:09 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008704e0
2026/01/03 12:06:09 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 12:06:09 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140008704e0, 新连接: 0x140006209c0
2026/01/03 12:06:09 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/03 12:06:09 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140006209c0
2026/01/03 12:06:09 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140006209c0
2026/01/03 12:06:09 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140006209c0
2026/01/03 12:06:09 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/03 12:06:09 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008704e0
2026/01/03 12:06:09 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/03 12:06:11 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:06:11 [ReadPump] 消息内容: {"type":"1v1_match_request","data":{}}
2026/01/03 12:06:11 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 '1v1_match_request'
2026/01/03 12:06:11 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 1v1 匹配请求，准备加入匹配队列
2026/01/03 12:06:11 [ReadPump] ✅ 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的匹配请求来自最新连接，发送到匹配队列
2026/01/03 12:06:11 收到匹配请求，用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 等待队列长度: 0, global在线数(去重): 1
2026/01/03 12:06:13 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000e7a660
2026/01/03 12:06:13 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000e7a660
2026/01/03 12:06:13 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2026/01/03 12:06:13 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000e7a660
2026/01/03 12:06:31 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/03 12:06:32 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1005 (no status)
2026/01/03 12:06:32 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000cf4a80
2026/01/03 12:06:48 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2026/01/03 12:07:02 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/03 12:07:03 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/03 12:07:07 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2026/01/03 12:09:27 [ReadPump] ========== 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的原始消息 ==========
2026/01/03 12:09:27 [ReadPump] 消息内容: {"type":"1v1_match_cancel","data":{}}
2026/01/03 12:09:27 [ReadPump] 解析用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的消息类型为 '1v1_match_cancel'
2026/01/03 12:09:27 [ReadPump] 收到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的 1v1 匹配取消请求
2026/01/03 12:09:58 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/03 12:09:58 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140006209c0
2026/01/03 12:10:39 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/03 13:38:31 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/03 13:38:31 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000acea0
2026/01/03 13:38:50 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 15:46:00 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000236ea0
2026/01/04 15:46:00 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000236ea0
2026/01/04 15:46:00 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/04 15:46:00 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x14000236ea0
2026/01/04 15:46:00 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000ac3c0
2026/01/04 15:46:00 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/04 15:46:00 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140000ac3c0
2026/01/04 15:46:00 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x14000236ea0, 新连接: 0x140000ac3c0
2026/01/04 15:46:00 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2026/01/04 15:46:00 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x140000ac3c0
2026/01/04 15:46:00 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 15:46:00 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000236ea0
2026/01/04 15:46:00 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/04 15:46:04 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000214fc0
2026/01/04 15:46:04 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000214fc0
2026/01/04 15:46:04 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/04 15:46:04 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x140000ac3c0, 新连接: 0x14000214fc0
2026/01/04 15:46:04 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2026/01/04 15:46:04 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x14000214fc0
2026/01/04 15:46:04 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000ac360
2026/01/04 15:46:04 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140000ac360
2026/01/04 15:46:04 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/04 15:46:04 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x14000214fc0, 新连接: 0x140000ac360
2026/01/04 15:46:04 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2026/01/04 15:46:04 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x140000ac360
2026/01/04 15:46:04 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 15:46:04 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000214fc0
2026/01/04 15:46:04 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/04 15:46:13 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 15:46:13 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 15:46:13 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000ac360
2026/01/04 15:46:13 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000ac3c0
2026/01/04 15:46:13 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/04 15:46:13 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/04 15:46:13 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/04 15:46:13 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/04 15:46:20 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000215380
2026/01/04 15:46:20 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000215380
2026/01/04 15:46:20 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/04 15:46:20 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x14000215380
2026/01/04 15:46:20 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 15:46:20 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000215380
2026/01/04 15:46:20 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/04 15:46:20 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/04 15:46:20 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/04 15:46:20 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x140000ad3e0
2026/01/04 15:46:20 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x140000ad3e0
2026/01/04 15:46:20 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/04 15:46:20 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x140000ad3e0
2026/01/04 15:46:30 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000215bc0
2026/01/04 15:46:30 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000215bc0
2026/01/04 15:46:30 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/04 15:46:30 [Register] 检测到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接，准备替换 - 旧连接: 0x140000ad3e0, 新连接: 0x14000215bc0
2026/01/04 15:46:30 [Register] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的旧连接
2026/01/04 15:46:30 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x14000215bc0
2026/01/04 15:46:30 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 15:46:30 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000215bc0
2026/01/04 15:46:30 [Unregister] 客户端注销 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/04 15:46:30 [Unregister] 已从 GlobalClients 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/04 15:46:30 [Unregister] 已从 GlobalByUserID 中移除用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东)
2026/01/04 15:46:30 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global, 连接指针: 0x14000596060
2026/01/04 15:46:30 [ReadPump] ✅ 开始监听用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 在房间 global 的消息，连接指针: 0x14000596060
2026/01/04 15:46:30 [Register] 新客户端注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 房间ID: global
2026/01/04 15:46:30 [Register] ✅ 全局连接已成功注册 - 用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 当前全局在线用户数: 1, 连接指针: 0x14000596060
2026/01/04 15:46:31 [ReadPump] ========== 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的原始消息 ==========
2026/01/04 15:46:31 [ReadPump] 消息内容: {"type":"1v1_match_request","data":{}}
2026/01/04 15:46:31 [ReadPump] 解析用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的消息类型为 '1v1_match_request'
2026/01/04 15:46:31 [ReadPump] 收到用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的 1v1 匹配请求，准备加入匹配队列
2026/01/04 15:46:31 [ReadPump] ✅ 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东) 的匹配请求来自最新连接，发送到匹配队列
2026/01/04 15:46:31 收到匹配请求，用户ID: 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa, 用户名: 小东, 等待队列长度: 0, global在线数(去重): 1
2026/01/04 15:46:36 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000accc0
2026/01/04 15:46:36 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000accc0
2026/01/04 15:46:36 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 15:46:36 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000accc0
2026/01/04 15:46:54 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2026/01/04 15:46:54 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2026/01/04 15:46:58 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2026/01/04 15:46:58 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2026/01/04 15:47:14 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2026/01/04 15:47:24 [WritePump] 用户 6f0cafb9-6cd4-44e0-b52b-105afd0f0faa (小东): 发送 ping 消息失败: websocket: close sent
2026/01/04 15:47:30 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:30:59 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:30:59 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400019cd20
2026/01/04 16:30:59 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400019cd20
2026/01/04 16:30:59 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400019cd20
2026/01/04 16:30:59 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:30:59 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x1400019cd20, 新连接: 0x14000302e40
2026/01/04 16:30:59 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/04 16:30:59 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000302e40
2026/01/04 16:30:59 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302e40
2026/01/04 16:30:59 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000302e40
2026/01/04 16:30:59 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 16:30:59 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400019cd20
2026/01/04 16:30:59 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:31:00 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 16:31:00 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302e40
2026/01/04 16:31:00 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:31:00 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:31:00 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:31:53 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:31:53 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:32:44 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302900
2026/01/04 16:32:44 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000302900
2026/01/04 16:32:44 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:32:44 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000302900
2026/01/04 16:32:44 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:32:44 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ac2a0
2026/01/04 16:32:44 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x14000302900, 新连接: 0x140000ac2a0
2026/01/04 16:32:44 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/04 16:32:44 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000ac2a0
2026/01/04 16:32:44 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000ac2a0
2026/01/04 16:32:44 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 16:32:44 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302900
2026/01/04 16:32:44 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:32:45 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 16:32:45 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ac2a0
2026/01/04 16:32:45 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:32:45 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:32:45 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:33:15 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ac960
2026/01/04 16:33:15 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000ac960
2026/01/04 16:33:15 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:33:15 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000ac960
2026/01/04 16:33:15 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000acf00
2026/01/04 16:33:15 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:33:15 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000acf00
2026/01/04 16:33:15 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140000ac960, 新连接: 0x140000acf00
2026/01/04 16:33:15 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/04 16:33:15 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000acf00
2026/01/04 16:33:15 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 16:33:15 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ac960
2026/01/04 16:33:15 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:33:19 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 16:33:19 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000acf00
2026/01/04 16:33:19 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:33:19 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:33:19 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:33:38 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:33:38 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:34:09 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:34:09 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:34:45 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400019d740
2026/01/04 16:34:45 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400019d740
2026/01/04 16:34:45 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:34:45 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400019d740
2026/01/04 16:34:45 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:53456: read: connection reset by peer
2026/01/04 16:34:45 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400019d740
2026/01/04 16:34:45 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:34:45 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:34:45 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:34:45 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c3200
2026/01/04 16:34:45 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005c3200
2026/01/04 16:34:45 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:34:45 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005c3200
2026/01/04 16:34:46 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 16:34:46 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c3200
2026/01/04 16:34:46 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:34:46 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:34:46 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:34:54 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000303740
2026/01/04 16:34:54 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000303740
2026/01/04 16:34:54 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:53567: read: connection reset by peer
2026/01/04 16:34:54 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000303740
2026/01/04 16:34:54 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:34:54 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000303740
2026/01/04 16:34:54 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:34:54 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:34:54 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:34:54 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:34:54 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005c20c0
2026/01/04 16:34:54 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c20c0
2026/01/04 16:34:54 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005c20c0
2026/01/04 16:34:54 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 16:34:54 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c20c0
2026/01/04 16:34:54 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:34:54 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:34:54 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:35:39 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:53456: use of closed network connection
2026/01/04 16:35:39 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:35:47 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:35:47 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000482720
2026/01/04 16:35:47 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000482720
2026/01/04 16:35:47 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000482720
2026/01/04 16:35:47 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 16:35:47 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000482720
2026/01/04 16:35:47 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:35:47 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:35:47 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:35:47 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:35:47 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000ad860
2026/01/04 16:35:47 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ad860
2026/01/04 16:35:47 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000ad860
2026/01/04 16:35:47 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 16:35:47 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ad860
2026/01/04 16:35:47 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:35:47 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:35:47 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:35:48 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:53567: use of closed network connection
2026/01/04 16:35:48 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:36:41 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:36:41 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:37:51 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302d20
2026/01/04 16:37:51 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:37:51 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000302d20
2026/01/04 16:37:51 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:37:51 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x14000302d20, 新连接: 0x1400007c7e0
2026/01/04 16:37:51 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/04 16:37:51 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400007c7e0
2026/01/04 16:37:51 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007c7e0
2026/01/04 16:37:51 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400007c7e0
2026/01/04 16:37:51 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000302d20
2026/01/04 16:37:51 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:55707: read: connection reset by peer
2026/01/04 16:37:51 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302d20
2026/01/04 16:37:51 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:37:52 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 16:37:52 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007c7e0
2026/01/04 16:37:52 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:37:52 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:37:52 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:37:56 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004826c0
2026/01/04 16:37:56 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140004826c0
2026/01/04 16:37:56 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:37:56 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140004826c0
2026/01/04 16:37:56 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 16:37:56 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004826c0
2026/01/04 16:37:56 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:37:56 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:37:56 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:37:56 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000acae0
2026/01/04 16:37:56 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:37:56 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000acae0
2026/01/04 16:37:56 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000acae0
2026/01/04 16:38:11 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 16:38:11 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000acae0
2026/01/04 16:38:11 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:38:11 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:38:11 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:38:45 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:38:45 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:55707: use of closed network connection
2026/01/04 16:38:50 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:38:50 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:40:07 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c21e0
2026/01/04 16:40:07 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005c21e0
2026/01/04 16:40:07 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:40:07 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005c21e0
2026/01/04 16:40:07 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 16:40:07 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c21e0
2026/01/04 16:40:07 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:40:07 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:40:07 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:40:07 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302f60
2026/01/04 16:40:07 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000302f60
2026/01/04 16:40:07 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:40:07 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000302f60
2026/01/04 16:41:01 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:42:58 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 16:42:58 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302f60
2026/01/04 16:42:58 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:42:58 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:42:58 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:42:58 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c2600
2026/01/04 16:42:58 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005c2600
2026/01/04 16:42:58 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:42:58 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005c2600
2026/01/04 16:42:58 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:42:58 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140005c2600, 新连接: 0x14000482900
2026/01/04 16:42:58 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/04 16:42:58 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000482900
2026/01/04 16:42:58 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000482900
2026/01/04 16:42:58 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000482900
2026/01/04 16:42:58 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:59383: read: connection reset by peer
2026/01/04 16:42:58 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000482900
2026/01/04 16:42:58 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:42:58 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:42:58 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:43:00 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 16:43:00 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c2600
2026/01/04 16:43:00 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:43:15 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140006107e0
2026/01/04 16:43:15 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140006107e0
2026/01/04 16:43:15 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:43:15 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140006107e0
2026/01/04 16:43:15 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 16:43:15 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140006107e0
2026/01/04 16:43:15 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:43:15 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:43:15 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:43:15 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:43:15 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000734000
2026/01/04 16:43:15 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000734000
2026/01/04 16:43:15 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000734000
2026/01/04 16:43:17 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 16:43:17 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000734000
2026/01/04 16:43:17 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:43:17 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:43:17 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:43:43 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:43:52 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:59383: use of closed network connection
2026/01/04 16:43:52 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:44:09 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:44:09 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:45:01 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ad7a0
2026/01/04 16:45:01 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000ad7a0
2026/01/04 16:45:01 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 16:45:01 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ad7a0
2026/01/04 16:45:01 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:45:01 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000ad7a0
2026/01/04 16:45:01 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:45:01 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:45:01 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:45:01 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:45:01 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140004a0060
2026/01/04 16:45:01 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004a0060
2026/01/04 16:45:01 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140004a0060
2026/01/04 16:45:02 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 16:45:02 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004a0060
2026/01/04 16:45:02 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:45:02 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:45:02 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:45:55 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:45:55 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:47:23 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004a03c0
2026/01/04 16:47:23 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140004a03c0
2026/01/04 16:47:23 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:47:23 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140004a03c0
2026/01/04 16:47:23 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 16:47:23 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004a03c0
2026/01/04 16:47:23 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:47:23 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:47:23 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:47:23 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:47:23 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140004825a0
2026/01/04 16:47:23 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004825a0
2026/01/04 16:47:23 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140004825a0
2026/01/04 16:47:24 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 16:47:24 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004825a0
2026/01/04 16:47:24 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:47:24 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:47:24 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:48:06 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140007344e0
2026/01/04 16:48:06 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140007344e0
2026/01/04 16:48:06 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:48:06 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140007344e0
2026/01/04 16:48:06 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 16:48:06 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140007344e0
2026/01/04 16:48:06 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:48:06 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:48:06 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:48:06 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:48:06 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005c23c0
2026/01/04 16:48:06 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c23c0
2026/01/04 16:48:06 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005c23c0
2026/01/04 16:48:07 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 16:48:07 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c23c0
2026/01/04 16:48:07 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:48:07 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:48:07 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:48:17 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:48:17 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:48:57 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302ae0
2026/01/04 16:48:57 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000302ae0
2026/01/04 16:48:57 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 16:48:57 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302ae0
2026/01/04 16:48:57 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:48:57 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000302ae0
2026/01/04 16:48:57 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:48:57 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:48:57 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:48:57 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302de0
2026/01/04 16:48:57 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000302de0
2026/01/04 16:48:57 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:48:57 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000302de0
2026/01/04 16:48:59 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 16:48:59 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302de0
2026/01/04 16:48:59 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:48:59 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:48:59 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:49:00 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:49:00 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:49:51 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:49:51 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:55:45 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000735800
2026/01/04 16:55:45 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000735800
2026/01/04 16:55:45 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:52764: read: connection reset by peer
2026/01/04 16:55:45 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000735800
2026/01/04 16:55:45 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:55:45 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000735800
2026/01/04 16:55:45 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:55:45 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:55:45 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:55:45 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:55:45 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000735860
2026/01/04 16:55:45 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000735860
2026/01/04 16:55:45 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000735860
2026/01/04 16:55:47 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 16:55:47 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000735860
2026/01/04 16:55:47 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:55:47 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:55:47 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:56:38 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:56:38 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000734720
2026/01/04 16:56:38 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000734720
2026/01/04 16:56:38 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000734720
2026/01/04 16:56:38 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:53392: read: connection reset by peer
2026/01/04 16:56:38 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000734720
2026/01/04 16:56:38 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:56:38 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:56:38 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:56:38 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:56:38 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000302c60
2026/01/04 16:56:38 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302c60
2026/01/04 16:56:38 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000302c60
2026/01/04 16:56:39 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:52764: use of closed network connection
2026/01/04 16:56:39 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 16:56:40 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 16:56:40 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302c60
2026/01/04 16:56:40 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 16:56:40 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:56:40 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 16:57:32 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:53392: use of closed network connection
2026/01/04 16:57:32 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:00:14 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c30e0
2026/01/04 17:00:14 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005c30e0
2026/01/04 17:00:14 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:00:14 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005c30e0
2026/01/04 17:00:14 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 17:00:14 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c30e0
2026/01/04 17:00:14 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:00:14 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:00:14 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:00:14 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:00:14 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400007c780
2026/01/04 17:00:14 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007c780
2026/01/04 17:00:14 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400007c780
2026/01/04 17:00:16 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:00:16 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007c780
2026/01/04 17:00:16 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:00:16 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:00:16 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:00:20 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008ac780
2026/01/04 17:00:20 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008ac780
2026/01/04 17:00:20 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 17:00:20 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008ac780
2026/01/04 17:00:20 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:00:20 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008ac780
2026/01/04 17:00:20 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:00:20 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:00:20 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:00:20 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004a0120
2026/01/04 17:00:20 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140004a0120
2026/01/04 17:00:20 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:00:20 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140004a0120
2026/01/04 17:00:51 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 17:00:51 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004a0120
2026/01/04 17:00:51 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:00:51 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:00:51 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:00:52 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000482360
2026/01/04 17:00:52 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000482360
2026/01/04 17:00:52 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:56395: read: connection reset by peer
2026/01/04 17:00:52 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000482360
2026/01/04 17:00:52 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:00:52 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000482360
2026/01/04 17:00:52 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:00:52 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:00:52 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:00:52 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:00:52 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000ad9e0
2026/01/04 17:00:52 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ad9e0
2026/01/04 17:00:52 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000ad9e0
2026/01/04 17:00:53 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:00:53 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ad9e0
2026/01/04 17:00:53 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:00:53 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:00:53 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:01:08 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:01:08 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:01:14 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:01:14 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:01:46 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:56395: use of closed network connection
2026/01/04 17:01:46 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:01:59 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000610720
2026/01/04 17:01:59 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000610720
2026/01/04 17:01:59 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 17:01:59 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000610720
2026/01/04 17:01:59 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:01:59 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000610720
2026/01/04 17:01:59 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:01:59 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:01:59 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:01:59 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000483020
2026/01/04 17:01:59 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000483020
2026/01/04 17:01:59 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:01:59 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000483020
2026/01/04 17:02:00 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:02:00 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000483020
2026/01/04 17:02:00 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:02:00 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:02:00 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:02:53 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:02:53 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:06:06 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:06:06 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140004a06c0
2026/01/04 17:06:06 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004a06c0
2026/01/04 17:06:06 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140004a06c0
2026/01/04 17:06:06 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 17:06:06 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004a06c0
2026/01/04 17:06:06 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:06:06 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:06:06 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:06:06 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:06:06 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000734c60
2026/01/04 17:06:06 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000734c60
2026/01/04 17:06:06 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000734c60
2026/01/04 17:06:40 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:06:40 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000734c60
2026/01/04 17:06:40 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:06:40 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:06:40 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:07:00 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:07:00 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:10:04 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008ac600
2026/01/04 17:10:04 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008ac600
2026/01/04 17:10:04 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:10:04 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008ac600
2026/01/04 17:10:04 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 17:10:04 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008ac600
2026/01/04 17:10:04 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:10:04 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:10:04 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:10:04 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:10:04 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005c2180
2026/01/04 17:10:04 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c2180
2026/01/04 17:10:04 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005c2180
2026/01/04 17:10:05 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:10:05 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c2180
2026/01/04 17:10:05 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:10:05 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:10:05 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:10:10 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c2540
2026/01/04 17:10:10 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005c2540
2026/01/04 17:10:10 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:10:10 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005c2540
2026/01/04 17:10:58 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:10:58 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:11:09 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:11:09 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c2540
2026/01/04 17:11:09 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:11:09 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:11:09 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:11:58 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:12:31 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:12:31 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005c2840
2026/01/04 17:12:31 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000482180
2026/01/04 17:12:31 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000482180
2026/01/04 17:12:31 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:64940: read: connection reset by peer
2026/01/04 17:12:31 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000482180
2026/01/04 17:12:31 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:12:31 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140005c2840, 新连接: 0x14000482180
2026/01/04 17:12:31 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/04 17:12:31 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000482180
2026/01/04 17:12:31 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:12:31 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:12:31 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:12:31 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c2840
2026/01/04 17:12:31 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005c2840
2026/01/04 17:12:32 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:12:32 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c2840
2026/01/04 17:12:32 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:12:33 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000734480
2026/01/04 17:12:33 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000734480
2026/01/04 17:12:33 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:12:33 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000734480
2026/01/04 17:12:33 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 17:12:33 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000734480
2026/01/04 17:12:33 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:12:33 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:12:33 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:12:33 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008ac420
2026/01/04 17:12:33 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008ac420
2026/01/04 17:12:33 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:12:33 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008ac420
2026/01/04 17:12:35 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:12:35 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008ac420
2026/01/04 17:12:35 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:12:35 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:12:35 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:13:25 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:13:25 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:64940: use of closed network connection
2026/01/04 17:13:27 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:13:27 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:14:38 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008ac900
2026/01/04 17:14:38 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008ac900
2026/01/04 17:14:38 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 17:14:38 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008ac900
2026/01/04 17:14:38 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:14:38 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008ac900
2026/01/04 17:14:38 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:14:38 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:14:38 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:14:38 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:14:38 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005c2a80
2026/01/04 17:14:38 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c2a80
2026/01/04 17:14:38 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005c2a80
2026/01/04 17:14:39 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:14:39 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c2a80
2026/01/04 17:14:39 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:14:39 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:14:39 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:14:49 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:14:49 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000acd20
2026/01/04 17:14:49 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000acd20
2026/01/04 17:14:49 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000acd20
2026/01/04 17:14:49 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 17:14:49 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000acd20
2026/01/04 17:14:49 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:14:49 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:14:49 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:14:49 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:14:49 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c3560
2026/01/04 17:14:49 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005c3560
2026/01/04 17:14:49 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005c3560
2026/01/04 17:14:49 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:14:49 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c3560
2026/01/04 17:14:49 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:14:49 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:14:49 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:15:32 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:15:32 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:15:40 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000610cc0
2026/01/04 17:15:40 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000610cc0
2026/01/04 17:15:40 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 17:15:40 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000610cc0
2026/01/04 17:15:40 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:15:40 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000610cc0
2026/01/04 17:15:40 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:15:40 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:15:40 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:15:40 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:15:40 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140003023c0
2026/01/04 17:15:40 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003023c0
2026/01/04 17:15:40 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140003023c0
2026/01/04 17:15:43 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:15:43 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:16:34 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:18:22 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 17:18:22 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003023c0
2026/01/04 17:18:22 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:18:22 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:18:22 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:18:22 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ad1a0
2026/01/04 17:18:22 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000ad1a0
2026/01/04 17:18:22 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 17:18:22 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000ad1a0
2026/01/04 17:18:22 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:18:22 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000ad1a0
2026/01/04 17:18:22 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:18:22 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:18:22 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:18:22 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:18:22 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140003024e0
2026/01/04 17:18:22 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003024e0
2026/01/04 17:18:22 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140003024e0
2026/01/04 17:18:22 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:18:25 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:18:25 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003024e0
2026/01/04 17:18:25 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:18:25 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:18:25 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:19:16 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:19:16 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:23:03 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004a1aa0
2026/01/04 17:23:03 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140004a1aa0
2026/01/04 17:23:03 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:57268: read: connection reset by peer
2026/01/04 17:23:03 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004a1aa0
2026/01/04 17:23:03 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:23:03 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140004a1aa0
2026/01/04 17:23:03 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:23:03 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:23:03 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:23:03 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302b40
2026/01/04 17:23:03 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:23:03 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000302b40
2026/01/04 17:23:03 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000302b40
2026/01/04 17:23:04 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:23:04 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302b40
2026/01/04 17:23:04 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:23:04 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:23:04 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:23:06 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000610480
2026/01/04 17:23:06 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000610480
2026/01/04 17:23:06 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 17:23:06 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000610480
2026/01/04 17:23:06 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:23:06 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000610480
2026/01/04 17:23:06 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:23:06 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:23:06 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:23:06 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003034a0
2026/01/04 17:23:06 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140003034a0
2026/01/04 17:23:06 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:23:06 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140003034a0
2026/01/04 17:23:07 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:23:07 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003034a0
2026/01/04 17:23:07 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:23:07 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:23:07 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:23:57 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:57268: use of closed network connection
2026/01/04 17:23:57 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:24:00 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:24:00 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:24:34 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c9b680
2026/01/04 17:24:34 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000c9b680
2026/01/04 17:24:34 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:58481: read: connection reset by peer
2026/01/04 17:24:34 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c9b680
2026/01/04 17:24:34 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:24:34 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000c9b680
2026/01/04 17:24:34 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:24:34 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:24:34 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:24:34 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:24:34 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000c36300
2026/01/04 17:24:34 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c36300
2026/01/04 17:24:34 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000c36300
2026/01/04 17:24:35 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:24:35 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c36300
2026/01/04 17:24:35 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:24:35 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:24:35 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:24:36 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c36480
2026/01/04 17:24:36 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000c36480
2026/01/04 17:24:36 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 17:24:36 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c36480
2026/01/04 17:24:36 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:24:36 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000c36480
2026/01/04 17:24:36 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:24:36 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:24:36 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:24:36 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c36c00
2026/01/04 17:24:36 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000c36c00
2026/01/04 17:24:36 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:24:36 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000c36c00
2026/01/04 17:24:36 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:24:36 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c36c00
2026/01/04 17:24:36 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:24:36 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:24:36 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:25:28 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:58481: use of closed network connection
2026/01/04 17:25:28 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:25:30 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:25:30 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:28:21 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008aca80
2026/01/04 17:28:21 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008aca80
2026/01/04 17:28:21 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 17:28:21 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008aca80
2026/01/04 17:28:21 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:28:21 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008aca80
2026/01/04 17:28:21 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:28:21 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:28:21 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:28:21 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c2420
2026/01/04 17:28:21 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005c2420
2026/01/04 17:28:21 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:28:21 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005c2420
2026/01/04 17:28:21 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:28:21 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c2420
2026/01/04 17:28:21 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:28:21 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:28:21 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:29:15 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:29:15 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:43:57 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008ac180
2026/01/04 17:43:57 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008ac180
2026/01/04 17:43:57 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:43:57 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008ac180
2026/01/04 17:43:57 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 17:43:57 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008ac180
2026/01/04 17:43:57 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:43:57 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:43:57 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:43:57 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000303380
2026/01/04 17:43:57 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000303380
2026/01/04 17:43:57 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:43:57 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000303380
2026/01/04 17:43:59 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 17:43:59 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000303380
2026/01/04 17:43:59 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 17:43:59 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:43:59 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 17:44:51 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 17:44:51 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 18:01:02 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:01:02 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008adb60
2026/01/04 18:01:02 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008adb60
2026/01/04 18:01:02 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008adb60
2026/01/04 18:01:02 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 18:01:02 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008adb60
2026/01/04 18:01:02 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:01:02 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:01:02 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:01:02 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008add40
2026/01/04 18:01:02 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:01:02 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008add40
2026/01/04 18:01:02 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008add40
2026/01/04 18:01:03 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 18:01:03 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008add40
2026/01/04 18:01:03 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:01:03 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:01:03 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:01:56 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 18:01:56 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 18:03:54 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c36540
2026/01/04 18:03:54 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000c36540
2026/01/04 18:03:54 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:03:54 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000c36540
2026/01/04 18:03:54 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:54180: read: connection reset by peer
2026/01/04 18:03:54 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c36540
2026/01/04 18:03:54 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:03:54 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:03:54 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:03:54 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c32c0
2026/01/04 18:03:54 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005c32c0
2026/01/04 18:03:54 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:03:54 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005c32c0
2026/01/04 18:03:55 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 18:03:55 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c32c0
2026/01/04 18:03:55 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:03:55 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:03:55 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:03:56 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c36420
2026/01/04 18:03:56 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000c36420
2026/01/04 18:03:56 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:03:56 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000c36420
2026/01/04 18:03:56 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 18:03:56 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c36420
2026/01/04 18:03:56 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:03:56 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:03:56 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:03:56 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c36fc0
2026/01/04 18:03:56 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000c36fc0
2026/01/04 18:03:56 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:03:56 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000c36fc0
2026/01/04 18:03:57 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 18:03:57 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c36fc0
2026/01/04 18:03:57 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:03:57 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:03:57 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:04:48 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:54180: use of closed network connection
2026/01/04 18:04:48 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 18:04:50 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 18:04:50 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 18:05:31 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c36d20
2026/01/04 18:05:31 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000c36d20
2026/01/04 18:05:31 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:05:31 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000c36d20
2026/01/04 18:05:31 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 18:05:31 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c36d20
2026/01/04 18:05:31 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:05:31 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:05:31 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:05:31 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c9a6c0
2026/01/04 18:05:31 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:05:31 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000c9a6c0
2026/01/04 18:05:31 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000c9a6c0
2026/01/04 18:05:32 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 18:05:32 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c9a6c0
2026/01/04 18:05:32 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:05:32 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:05:32 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:06:25 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 18:06:25 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 18:06:55 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:06:55 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000c36f60
2026/01/04 18:06:55 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c36f60
2026/01/04 18:06:55 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000c36f60
2026/01/04 18:06:55 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:56543: read: connection reset by peer
2026/01/04 18:06:55 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c36f60
2026/01/04 18:06:55 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:06:55 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:06:55 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:06:55 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c370e0
2026/01/04 18:06:55 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000c370e0
2026/01/04 18:06:55 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:06:55 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000c370e0
2026/01/04 18:06:57 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 18:06:57 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000c370e0
2026/01/04 18:06:57 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:06:57 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:06:57 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:07:49 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:56543: use of closed network connection
2026/01/04 18:07:49 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 18:10:17 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:10:17 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000b4c8a0
2026/01/04 18:10:17 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000b4c8a0
2026/01/04 18:10:17 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000b4c8a0
2026/01/04 18:10:17 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 18:10:17 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000b4c8a0
2026/01/04 18:10:17 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:10:17 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:10:17 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:10:17 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:10:17 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140004a1e60
2026/01/04 18:10:17 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004a1e60
2026/01/04 18:10:17 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140004a1e60
2026/01/04 18:10:18 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 18:10:18 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004a1e60
2026/01/04 18:10:18 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:10:18 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:10:18 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:10:24 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000610ae0
2026/01/04 18:10:24 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000610ae0
2026/01/04 18:10:24 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 18:10:24 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000610ae0
2026/01/04 18:10:24 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:10:24 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000610ae0
2026/01/04 18:10:24 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:10:24 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:10:24 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:10:24 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000610b40
2026/01/04 18:10:24 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000610b40
2026/01/04 18:10:24 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:10:24 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000610b40
2026/01/04 18:10:25 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 18:10:25 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000610b40
2026/01/04 18:10:25 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:10:25 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:10:25 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:11:11 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 18:11:11 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 18:11:18 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 18:11:18 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 18:11:52 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c2c00
2026/01/04 18:11:52 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005c2c00
2026/01/04 18:11:52 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:11:52 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:60169: read: connection reset by peer
2026/01/04 18:11:52 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c2c00
2026/01/04 18:11:52 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005c2c00
2026/01/04 18:11:52 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:11:52 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:11:52 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:11:52 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c35c0
2026/01/04 18:11:52 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140005c35c0
2026/01/04 18:11:52 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:11:52 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140005c35c0
2026/01/04 18:11:53 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 18:11:53 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140005c35c0
2026/01/04 18:11:53 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:11:53 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:11:53 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:12:46 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:60169: use of closed network connection
2026/01/04 18:12:46 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 18:17:37 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140001107e0
2026/01/04 18:17:37 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140001107e0
2026/01/04 18:17:37 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:17:37 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:64713: read: connection reset by peer
2026/01/04 18:17:37 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140001107e0
2026/01/04 18:17:37 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140001107e0
2026/01/04 18:17:37 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:17:37 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:17:37 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:17:37 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003b61e0
2026/01/04 18:17:37 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140003b61e0
2026/01/04 18:17:37 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:17:37 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140003b61e0
2026/01/04 18:17:37 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 18:17:37 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003b61e0
2026/01/04 18:17:37 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:17:37 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:17:37 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:17:38 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000110540
2026/01/04 18:17:38 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000110540
2026/01/04 18:17:38 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:17:38 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 18:17:38 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000110540
2026/01/04 18:17:38 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000110540
2026/01/04 18:17:38 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:17:38 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:17:38 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:17:38 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140001a1200
2026/01/04 18:17:38 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:17:38 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140001a1200
2026/01/04 18:17:38 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140001a1200
2026/01/04 18:17:38 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 18:17:38 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140001a1200
2026/01/04 18:17:38 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 18:17:38 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:17:38 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 18:18:31 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:64713: use of closed network connection
2026/01/04 18:18:31 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 18:18:32 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 18:18:32 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 22:32:51 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000110cc0
2026/01/04 22:32:51 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000110cc0
2026/01/04 22:32:51 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 22:32:51 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000110cc0
2026/01/04 22:32:51 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 22:32:51 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x14000110cc0, 新连接: 0x140000d7800
2026/01/04 22:32:51 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:50238: read: connection reset by peer
2026/01/04 22:32:51 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000110cc0
2026/01/04 22:32:51 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000d7800
2026/01/04 22:32:51 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000d7800
2026/01/04 22:32:51 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/04 22:32:51 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000d7800
2026/01/04 22:32:51 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 22:32:52 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 22:32:52 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000d7800
2026/01/04 22:32:52 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 22:32:52 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 22:32:52 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 22:32:54 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 22:32:54 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140001a09c0
2026/01/04 22:32:54 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140001a09c0
2026/01/04 22:32:54 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140001a09c0
2026/01/04 22:32:54 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 22:32:54 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140001a09c0
2026/01/04 22:32:54 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 22:32:54 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 22:32:54 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 22:32:54 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003b6ba0
2026/01/04 22:32:54 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140003b6ba0
2026/01/04 22:32:54 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 22:32:54 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140003b6ba0
2026/01/04 22:32:55 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 22:32:55 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003b6ba0
2026/01/04 22:32:55 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 22:32:55 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 22:32:55 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 22:33:45 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 22:33:45 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:50238: use of closed network connection
2026/01/04 22:33:48 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 22:33:48 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 23:14:20 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000400660
2026/01/04 23:14:20 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 23:14:20 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000400660
2026/01/04 23:14:20 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000400660
2026/01/04 23:14:20 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 23:14:20 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000400660
2026/01/04 23:14:20 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 23:14:20 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 23:14:20 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 23:14:20 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302240
2026/01/04 23:14:20 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000302240
2026/01/04 23:14:20 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 23:14:20 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000302240
2026/01/04 23:14:22 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 23:14:22 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000302240
2026/01/04 23:14:22 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 23:14:22 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 23:14:22 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 23:15:14 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 23:15:14 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 23:17:02 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000303da0
2026/01/04 23:17:02 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000303da0
2026/01/04 23:17:02 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:64330: read: connection reset by peer
2026/01/04 23:17:02 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000303da0
2026/01/04 23:17:02 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 23:17:02 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000303da0
2026/01/04 23:17:02 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 23:17:02 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 23:17:02 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 23:17:02 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 23:17:02 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140006ba0c0
2026/01/04 23:17:02 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140006ba0c0
2026/01/04 23:17:02 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140006ba0c0
2026/01/04 23:17:03 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 23:17:03 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140006ba0c0
2026/01/04 23:17:03 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 23:17:03 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 23:17:03 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 23:17:56 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:64330: use of closed network connection
2026/01/04 23:17:56 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 23:46:41 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000400d80
2026/01/04 23:46:41 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000400d80
2026/01/04 23:46:41 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 23:46:41 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000400d80
2026/01/04 23:46:41 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 23:46:41 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000400d80
2026/01/04 23:46:41 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 23:46:41 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 23:46:41 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 23:46:41 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000a0e0c0
2026/01/04 23:46:41 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 23:46:41 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000a0e0c0
2026/01/04 23:46:41 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000a0e0c0
2026/01/04 23:46:42 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 23:46:42 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000a0e0c0
2026/01/04 23:46:42 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 23:46:42 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 23:46:42 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 23:47:35 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 23:47:35 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 23:49:20 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003038c0
2026/01/04 23:49:20 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140003038c0
2026/01/04 23:49:20 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 23:49:20 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140003038c0
2026/01/04 23:49:20 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 23:49:20 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140003038c0, 新连接: 0x14000a0ee40
2026/01/04 23:49:20 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/04 23:49:20 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000a0ee40
2026/01/04 23:49:20 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/04 23:49:20 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003038c0
2026/01/04 23:49:20 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 23:49:20 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000a0ee40
2026/01/04 23:49:20 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000a0ee40
2026/01/04 23:49:21 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/04 23:49:21 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000a0ee40
2026/01/04 23:49:21 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/04 23:49:21 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 23:49:21 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/04 23:50:14 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/04 23:50:14 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 09:36:14 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 09:36:14 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400019f620
2026/01/05 09:36:14 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400019f620
2026/01/05 09:36:14 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400019f620
2026/01/05 09:36:14 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:50222: read: connection reset by peer
2026/01/05 09:36:14 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400019f620
2026/01/05 09:36:14 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 09:36:14 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 09:36:14 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 09:36:14 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 09:36:14 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400019fb60
2026/01/05 09:36:14 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400019fb60
2026/01/05 09:36:14 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400019fb60
2026/01/05 09:36:15 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 09:36:15 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400019fb60
2026/01/05 09:36:15 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 09:36:15 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 09:36:15 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 09:37:08 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:50222: use of closed network connection
2026/01/05 09:37:08 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 09:40:03 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000acc60
2026/01/05 09:40:03 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000acc60
2026/01/05 09:40:03 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 09:40:03 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 09:40:03 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000acc60
2026/01/05 09:40:03 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000acc60
2026/01/05 09:40:03 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 09:40:03 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 09:40:03 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 09:40:04 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400019fbc0
2026/01/05 09:40:04 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 09:40:04 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400019fbc0
2026/01/05 09:40:04 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400019fbc0
2026/01/05 09:40:07 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 09:40:07 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400019fbc0
2026/01/05 09:40:07 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 09:40:07 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 09:40:07 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 09:40:58 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 09:40:58 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 09:57:29 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000553860
2026/01/05 09:57:29 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000553860
2026/01/05 09:57:29 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 09:57:29 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000553860
2026/01/05 09:57:29 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:64672: read: connection reset by peer
2026/01/05 09:57:29 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000553860
2026/01/05 09:57:29 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 09:57:29 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 09:57:29 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 09:57:29 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000553ce0
2026/01/05 09:57:29 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000553ce0
2026/01/05 09:57:29 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 09:57:29 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000553ce0
2026/01/05 09:57:31 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 09:57:31 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000553ce0
2026/01/05 09:57:31 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 09:57:31 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 09:57:31 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 09:58:23 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:64672: use of closed network connection
2026/01/05 09:58:23 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 13:43:35 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 13:43:35 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140006971a0
2026/01/05 13:43:35 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140006971a0
2026/01/05 13:43:35 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140006971a0
2026/01/05 13:43:35 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:50762: read: connection reset by peer
2026/01/05 13:43:35 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140006971a0
2026/01/05 13:43:35 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 13:43:35 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 13:43:35 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 13:43:35 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 13:43:35 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140006976e0
2026/01/05 13:43:35 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140006976e0
2026/01/05 13:43:35 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140006976e0
2026/01/05 13:43:35 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 13:43:35 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140006976e0
2026/01/05 13:43:35 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 13:43:35 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 13:43:35 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 13:44:29 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:50762: use of closed network connection
2026/01/05 13:44:29 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 17:56:32 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 17:56:32 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008b86c0
2026/01/05 17:56:32 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008b86c0
2026/01/05 17:56:32 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008b86c0
2026/01/05 17:56:32 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 17:56:32 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008b86c0
2026/01/05 17:56:32 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 17:56:32 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 17:56:32 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 17:56:32 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 17:56:32 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008b92c0
2026/01/05 17:56:32 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008b92c0
2026/01/05 17:56:32 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008b92c0
2026/01/05 17:56:33 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 17:56:33 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008b92c0
2026/01/05 17:56:33 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 17:56:33 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 17:56:33 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 17:57:26 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 17:57:26 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 18:05:54 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:05:54 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400051ccc0
2026/01/05 18:05:54 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400051ccc0
2026/01/05 18:05:54 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400051ccc0
2026/01/05 18:05:55 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000400540
2026/01/05 18:05:55 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000400540
2026/01/05 18:05:55 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:62335: read: connection reset by peer
2026/01/05 18:05:55 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000400540
2026/01/05 18:05:55 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:05:55 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x1400051ccc0, 新连接: 0x14000400540
2026/01/05 18:05:55 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/05 18:05:55 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000400540
2026/01/05 18:05:55 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:05:55 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 18:05:55 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 18:05:56 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 18:05:56 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400051ccc0
2026/01/05 18:05:56 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:05:59 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000552ae0
2026/01/05 18:05:59 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000552ae0
2026/01/05 18:05:59 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 18:05:59 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000552ae0
2026/01/05 18:05:59 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:05:59 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000552ae0
2026/01/05 18:05:59 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:05:59 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 18:05:59 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 18:05:59 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000303800
2026/01/05 18:05:59 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000303800
2026/01/05 18:05:59 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:05:59 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000303800
2026/01/05 18:06:48 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 18:06:49 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:62335: use of closed network connection
2026/01/05 18:06:53 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 18:07:51 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 18:07:51 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000303800
2026/01/05 18:07:51 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:07:51 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 18:07:51 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 18:08:41 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 18:11:13 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140001cade0
2026/01/05 18:11:13 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140001cade0
2026/01/05 18:11:13 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:65466: read: connection reset by peer
2026/01/05 18:11:13 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140001cade0
2026/01/05 18:11:13 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:11:13 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140001cade0
2026/01/05 18:11:13 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:11:13 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 18:11:13 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 18:11:13 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140001cbb60
2026/01/05 18:11:13 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140001cbb60
2026/01/05 18:11:13 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:11:13 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140001cbb60
2026/01/05 18:11:14 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 18:11:14 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140001cbb60
2026/01/05 18:11:14 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:11:14 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 18:11:14 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 18:12:07 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:65466: use of closed network connection
2026/01/05 18:12:07 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 18:13:01 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000100720
2026/01/05 18:13:01 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000100720
2026/01/05 18:13:01 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:13:01 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000100720
2026/01/05 18:13:01 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000100cc0
2026/01/05 18:13:01 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000100cc0
2026/01/05 18:13:01 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 18:13:01 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000100cc0
2026/01/05 18:13:01 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:13:01 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x14000100720, 新连接: 0x14000100cc0
2026/01/05 18:13:01 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/05 18:13:01 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000100cc0
2026/01/05 18:13:01 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:13:01 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 18:13:01 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 18:13:02 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 18:13:02 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000100720
2026/01/05 18:13:02 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:20:56 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:20:56 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400007c5a0
2026/01/05 18:20:56 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007c5a0
2026/01/05 18:20:56 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400007c5a0
2026/01/05 18:20:56 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000486300
2026/01/05 18:20:56 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000486300
2026/01/05 18:20:56 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:20:56 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x1400007c5a0, 新连接: 0x14000486300
2026/01/05 18:20:56 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/05 18:20:56 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000486300
2026/01/05 18:20:56 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 18:20:56 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007c5a0
2026/01/05 18:20:56 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:20:59 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 18:20:59 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000486300
2026/01/05 18:20:59 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 18:20:59 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 18:20:59 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 18:21:50 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 18:21:50 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:22:04 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400019dec0
2026/01/05 19:22:04 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:22:04 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400019dec0
2026/01/05 19:22:04 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400019dec0
2026/01/05 19:22:04 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:22:04 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400019dec0
2026/01/05 19:22:04 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:22:04 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:22:04 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:22:04 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400058e0c0
2026/01/05 19:22:04 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400058e0c0
2026/01/05 19:22:04 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:22:04 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400058e0c0
2026/01/05 19:22:05 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:22:05 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400058e0c0
2026/01/05 19:22:05 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:22:05 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:22:05 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:22:45 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000388240
2026/01/05 19:22:45 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000388240
2026/01/05 19:22:45 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:58243: read: connection reset by peer
2026/01/05 19:22:45 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:22:45 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000388240
2026/01/05 19:22:45 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000388240
2026/01/05 19:22:45 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:22:45 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:22:45 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:22:45 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400058e300
2026/01/05 19:22:45 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400058e300
2026/01/05 19:22:45 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:22:45 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400058e300
2026/01/05 19:22:58 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:22:58 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:23:16 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:23:16 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400058e300
2026/01/05 19:23:16 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:23:16 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:23:16 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:23:16 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400019dd40
2026/01/05 19:23:16 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400019dd40
2026/01/05 19:23:16 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:58676: read: connection reset by peer
2026/01/05 19:23:16 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400019dd40
2026/01/05 19:23:16 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:23:16 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400019dd40
2026/01/05 19:23:16 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:23:16 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:23:16 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:23:16 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004866c0
2026/01/05 19:23:16 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140004866c0
2026/01/05 19:23:16 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:23:16 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140004866c0
2026/01/05 19:23:19 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:23:19 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004866c0
2026/01/05 19:23:19 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:23:19 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:23:19 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:23:39 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:58243: use of closed network connection
2026/01/05 19:23:39 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:24:10 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:58676: use of closed network connection
2026/01/05 19:24:10 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:33:04 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:33:04 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140007425a0
2026/01/05 19:33:04 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140007425a0
2026/01/05 19:33:04 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140007425a0
2026/01/05 19:33:04 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:49756: read: connection reset by peer
2026/01/05 19:33:04 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140007425a0
2026/01/05 19:33:04 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:33:04 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:33:04 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:33:04 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000486d80
2026/01/05 19:33:04 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000486d80
2026/01/05 19:33:04 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:33:04 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000486d80
2026/01/05 19:33:07 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:33:07 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000486d80
2026/01/05 19:33:07 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:33:07 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:33:07 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:33:58 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:49756: use of closed network connection
2026/01/05 19:33:58 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:34:08 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000900480
2026/01/05 19:34:08 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000900480
2026/01/05 19:34:08 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:34:08 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000900480
2026/01/05 19:34:08 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:34:08 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000900480
2026/01/05 19:34:08 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:34:08 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:34:08 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:34:08 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:34:08 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140007428a0
2026/01/05 19:34:08 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140007428a0
2026/01/05 19:34:08 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140007428a0
2026/01/05 19:34:10 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:34:10 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140007428a0
2026/01/05 19:34:10 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:34:10 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:34:10 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:34:18 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400058f9e0
2026/01/05 19:34:18 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400058f9e0
2026/01/05 19:34:18 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:34:18 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400058f9e0
2026/01/05 19:34:18 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:34:18 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400058f9e0
2026/01/05 19:34:18 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:34:18 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:34:18 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:34:18 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000a7e60
2026/01/05 19:34:18 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:34:18 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000a7e60
2026/01/05 19:34:18 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000a7e60
2026/01/05 19:34:19 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:34:19 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000a7e60
2026/01/05 19:34:19 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:34:19 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:34:19 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:35:02 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:35:02 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:35:12 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:35:12 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:35:31 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:35:31 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000388720
2026/01/05 19:35:31 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000388720
2026/01/05 19:35:31 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000388720
2026/01/05 19:35:31 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:51593: read: connection reset by peer
2026/01/05 19:35:31 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000388720
2026/01/05 19:35:31 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:35:31 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:35:31 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:35:31 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:35:31 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000742420
2026/01/05 19:35:31 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000742420
2026/01/05 19:35:31 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000742420
2026/01/05 19:35:32 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:35:32 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000742420
2026/01/05 19:35:32 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:35:32 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:35:32 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:35:50 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000388d80
2026/01/05 19:35:50 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000388d80
2026/01/05 19:35:50 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:51797: read: connection reset by peer
2026/01/05 19:35:50 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000388d80
2026/01/05 19:35:50 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:35:50 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000388d80
2026/01/05 19:35:50 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:35:50 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:35:50 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:35:50 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000742fc0
2026/01/05 19:35:50 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000742fc0
2026/01/05 19:35:50 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:35:50 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000742fc0
2026/01/05 19:35:51 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:35:51 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000742fc0
2026/01/05 19:35:51 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:35:51 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:35:51 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:36:25 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:51593: use of closed network connection
2026/01/05 19:36:25 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:36:44 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:51797: use of closed network connection
2026/01/05 19:36:44 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:41:02 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400058e8a0
2026/01/05 19:41:02 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400058e8a0
2026/01/05 19:41:02 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:41:02 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400058e8a0
2026/01/05 19:41:02 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:41:02 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400058e8a0
2026/01/05 19:41:02 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:41:02 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:41:02 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:41:02 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004869c0
2026/01/05 19:41:02 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140004869c0
2026/01/05 19:41:02 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:41:02 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140004869c0
2026/01/05 19:41:03 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:41:03 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004869c0
2026/01/05 19:41:03 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:41:03 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:41:03 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:41:18 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400051d980
2026/01/05 19:41:18 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400051d980
2026/01/05 19:41:18 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:41:18 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400051d980
2026/01/05 19:41:18 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:41:18 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x1400051d980, 新连接: 0x1400007c7e0
2026/01/05 19:41:18 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/05 19:41:18 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400007c7e0
2026/01/05 19:41:18 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007c7e0
2026/01/05 19:41:18 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400007c7e0
2026/01/05 19:41:18 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:55694: read: connection reset by peer
2026/01/05 19:41:18 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400007c7e0
2026/01/05 19:41:18 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:41:18 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:41:18 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:41:26 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:41:26 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400051d980
2026/01/05 19:41:26 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:41:30 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004861e0
2026/01/05 19:41:30 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140004861e0
2026/01/05 19:41:30 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:41:30 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140004861e0
2026/01/05 19:41:30 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:41:30 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140004861e0
2026/01/05 19:41:30 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:41:30 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:41:30 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:41:30 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000487260
2026/01/05 19:41:30 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000487260
2026/01/05 19:41:30 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:41:30 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000487260
2026/01/05 19:41:30 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:41:30 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000487260
2026/01/05 19:41:30 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:41:30 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:41:30 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:41:56 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:41:56 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:42:12 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:42:12 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:55694: use of closed network connection
2026/01/05 19:42:24 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:42:24 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:45:53 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:45:53 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000486a80
2026/01/05 19:45:53 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:45:53 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x14000486a80, 新连接: 0x14000486cc0
2026/01/05 19:45:53 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000486a80
2026/01/05 19:45:53 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000486cc0
2026/01/05 19:45:53 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/05 19:45:53 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000486cc0
2026/01/05 19:45:53 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000486a80
2026/01/05 19:45:53 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:45:53 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000486a80
2026/01/05 19:45:53 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000486cc0
2026/01/05 19:45:53 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:45:54 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:45:54 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000486cc0
2026/01/05 19:45:54 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:45:54 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:45:54 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:46:18 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:46:18 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000742000
2026/01/05 19:46:18 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000742000
2026/01/05 19:46:18 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000742000
2026/01/05 19:46:18 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:46:18 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000742000
2026/01/05 19:46:18 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:46:18 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:46:18 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:46:18 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:46:18 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000a6720
2026/01/05 19:46:18 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000a6720
2026/01/05 19:46:18 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000a6720
2026/01/05 19:46:18 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:46:18 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000a6720
2026/01/05 19:46:18 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:46:18 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:46:18 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:46:44 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:46:44 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140006e08a0
2026/01/05 19:46:44 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140006e08a0
2026/01/05 19:46:44 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140006e08a0
2026/01/05 19:46:44 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:46:44 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140006e08a0
2026/01/05 19:46:44 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:46:44 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:46:44 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:46:44 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:46:44 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000a7320
2026/01/05 19:46:44 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000a7320
2026/01/05 19:46:44 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000a7320
2026/01/05 19:46:45 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:46:45 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000a7320
2026/01/05 19:46:45 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:46:45 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:46:45 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:46:47 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:46:47 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:47:12 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:47:12 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:47:38 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:47:38 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:47:47 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400058eba0
2026/01/05 19:47:47 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:47:47 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400058eba0
2026/01/05 19:47:47 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400058eba0
2026/01/05 19:47:47 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:47:47 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400058eba0
2026/01/05 19:47:47 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:47:47 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:47:47 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:47:47 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:47:47 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008aeae0
2026/01/05 19:47:47 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008aeae0
2026/01/05 19:47:47 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008aeae0
2026/01/05 19:47:48 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:47:48 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008aeae0
2026/01/05 19:47:48 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:47:48 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:47:48 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:48:41 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:48:41 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:49:21 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008ae720
2026/01/05 19:49:21 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008ae720
2026/01/05 19:49:21 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:49:21 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008ae720
2026/01/05 19:49:21 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:49:21 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008ae720
2026/01/05 19:49:21 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:49:21 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:49:21 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:49:21 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008ae840
2026/01/05 19:49:21 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008ae840
2026/01/05 19:49:21 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:49:21 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008ae840
2026/01/05 19:49:21 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:49:21 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008ae840
2026/01/05 19:49:21 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:49:21 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:49:21 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:50:15 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:50:15 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:51:14 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:51:14 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000a6e40
2026/01/05 19:51:14 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000a6e40
2026/01/05 19:51:14 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000a6e40
2026/01/05 19:51:14 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:51:14 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000a6e40
2026/01/05 19:51:14 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:51:14 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:51:14 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:51:14 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400058f8c0
2026/01/05 19:51:14 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400058f8c0
2026/01/05 19:51:14 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:51:14 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400058f8c0
2026/01/05 19:51:15 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:51:15 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400058f8c0
2026/01/05 19:51:15 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:51:15 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:51:15 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:51:52 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000a7080
2026/01/05 19:51:52 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000a7080
2026/01/05 19:51:52 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:51:52 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000a7080
2026/01/05 19:51:52 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400051c720
2026/01/05 19:51:52 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400051c720
2026/01/05 19:51:52 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:51:52 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x140000a7080, 新连接: 0x1400051c720
2026/01/05 19:51:52 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:51:52 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/05 19:51:52 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400051c720
2026/01/05 19:51:52 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000a7080
2026/01/05 19:51:52 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:51:54 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:51:54 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400051c720
2026/01/05 19:51:54 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:51:54 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:51:54 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:52:08 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:52:08 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:52:23 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003887e0
2026/01/05 19:52:23 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140003887e0
2026/01/05 19:52:23 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:52:23 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140003887e0
2026/01/05 19:52:23 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:52:23 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003887e0
2026/01/05 19:52:23 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:52:23 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:52:23 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:52:23 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008afce0
2026/01/05 19:52:23 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008afce0
2026/01/05 19:52:23 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:52:23 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008afce0
2026/01/05 19:52:46 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:52:46 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:52:50 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:52:50 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008afce0
2026/01/05 19:52:50 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:52:50 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:52:50 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:52:58 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140009011a0
2026/01/05 19:52:58 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140009011a0
2026/01/05 19:52:58 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:52:58 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140009011a0
2026/01/05 19:52:58 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:52:58 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140009011a0
2026/01/05 19:52:58 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:52:58 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:52:58 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:52:58 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008afb60
2026/01/05 19:52:58 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:52:58 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008afb60
2026/01/05 19:52:58 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008afb60
2026/01/05 19:53:01 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:53:01 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008afb60
2026/01/05 19:53:01 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:01 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:01 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:01 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000487740
2026/01/05 19:53:01 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000487740
2026/01/05 19:53:01 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:53:01 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000487740
2026/01/05 19:53:01 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:01 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000487740
2026/01/05 19:53:01 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:01 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:01 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:01 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140006e1260
2026/01/05 19:53:01 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:01 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140006e1260
2026/01/05 19:53:01 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140006e1260
2026/01/05 19:53:05 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:53:05 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140006e1260
2026/01/05 19:53:05 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:05 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:05 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:17 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:53:17 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:53:34 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000a1e0c0
2026/01/05 19:53:34 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000a1e0c0
2026/01/05 19:53:34 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:34 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000a1e0c0
2026/01/05 19:53:34 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:53:34 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000a1e0c0
2026/01/05 19:53:34 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:34 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:34 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:34 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000742a80
2026/01/05 19:53:34 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000742a80
2026/01/05 19:53:34 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:34 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000742a80
2026/01/05 19:53:35 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:53:35 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000742a80
2026/01/05 19:53:35 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:35 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:35 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:47 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:47 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000900960
2026/01/05 19:53:47 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000900960
2026/01/05 19:53:47 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:64788: read: connection reset by peer
2026/01/05 19:53:47 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000900960
2026/01/05 19:53:47 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000900960
2026/01/05 19:53:47 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:47 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:47 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:47 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:47 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000a1eae0
2026/01/05 19:53:47 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000a1eae0
2026/01/05 19:53:47 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000a1eae0
2026/01/05 19:53:48 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:53:48 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000a1eae0
2026/01/05 19:53:48 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:48 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:48 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:52 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003898c0
2026/01/05 19:53:52 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140003898c0
2026/01/05 19:53:52 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:52 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:64849: read: connection reset by peer
2026/01/05 19:53:52 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140003898c0
2026/01/05 19:53:52 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140003898c0
2026/01/05 19:53:52 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:52 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:52 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:52 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:52 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140008af6e0
2026/01/05 19:53:52 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008af6e0
2026/01/05 19:53:52 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140008af6e0
2026/01/05 19:53:52 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:53:52 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:53:52 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:53:52 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140008af6e0
2026/01/05 19:53:52 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:53:52 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:52 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:53:55 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:53:55 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:54:28 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:54:28 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:54:41 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:64788: use of closed network connection
2026/01/05 19:54:41 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:54:46 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:64849: use of closed network connection
2026/01/05 19:54:46 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:55:00 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000900de0
2026/01/05 19:55:00 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000900de0
2026/01/05 19:55:00 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:55:00 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000900de0
2026/01/05 19:55:00 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000a1e180
2026/01/05 19:55:00 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:55:00 [Register] 检测到用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接，准备替换 - 旧连接: 0x14000900de0, 新连接: 0x14000a1e180
2026/01/05 19:55:00 [Register] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 的旧连接
2026/01/05 19:55:00 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000a1e180
2026/01/05 19:55:00 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000a1e180
2026/01/05 19:55:00 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:55:00 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000a1e180
2026/01/05 19:55:00 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:55:00 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:55:00 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:55:01 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:55:01 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000900de0
2026/01/05 19:55:01 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:55:42 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000742c60
2026/01/05 19:55:42 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x14000742c60
2026/01/05 19:55:42 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:55:42 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x14000742c60
2026/01/05 19:55:42 ℹ️ WebSocket 连接被客户端正常关闭 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1001 (going away)
2026/01/05 19:55:42 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x14000742c60
2026/01/05 19:55:42 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:55:42 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:55:42 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:55:42 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400058e900
2026/01/05 19:55:42 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400058e900
2026/01/05 19:55:42 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:55:42 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400058e900
2026/01/05 19:55:43 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:55:43 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400058e900
2026/01/05 19:55:43 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:55:43 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:55:43 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:55:54 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:55:54 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:56:36 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:56:36 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
2026/01/05 19:56:51 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000a7200
2026/01/05 19:56:51 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x140000a7200
2026/01/05 19:56:51 ❌ WebSocket 读取错误 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): read tcp [::1]:8081->[::1]:50553: read: connection reset by peer
2026/01/05 19:56:51 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x140000a7200
2026/01/05 19:56:51 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:56:51 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x140000a7200
2026/01/05 19:56:51 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:56:51 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:56:51 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:56:51 [ReadPump] ========== ReadPump 启动 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400051c8a0
2026/01/05 19:56:51 [ReadPump] ✅ 开始监听用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北) 在房间 global 的消息，连接指针: 0x1400051c8a0
2026/01/05 19:56:51 [Register] 新客户端注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:56:51 [Register] ✅ 全局连接已成功注册 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 当前全局在线用户数: 1, 连接指针: 0x1400051c8a0
2026/01/05 19:56:51 ℹ️ WebSocket 连接关闭但未收到状态码 (用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global): websocket: close 1005 (no status)
2026/01/05 19:56:51 [ReadPump] ========== ReadPump 退出 ========== 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global, 连接指针: 0x1400051c8a0
2026/01/05 19:56:51 [Unregister] 客户端注销 - 用户ID: 1b7b6081-9139-4e57-b16e-7f0885ae5e43, 用户名: 小北, 房间ID: global
2026/01/05 19:56:51 [Unregister] 已从 GlobalClients 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:56:51 [Unregister] 已从 GlobalByUserID 中移除用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北)
2026/01/05 19:57:45 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: write tcp [::1]:8081->[::1]:50553: use of closed network connection
2026/01/05 19:57:45 [WritePump] 用户 1b7b6081-9139-4e57-b16e-7f0885ae5e43 (小北): 发送 ping 消息失败: websocket: close sent
